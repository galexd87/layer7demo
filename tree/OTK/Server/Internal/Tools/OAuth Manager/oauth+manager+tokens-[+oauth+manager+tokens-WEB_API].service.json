{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fea0c",
  "guid": "ba6384e1-d873-46c5-9edb-d94ee67a5c8a",
  "name": "oauth/manager/tokens",
  "resolutionPath": "/oauth/manager/tokens",
  "serviceType": "WEB_API",
  "checksum": "748bc6bd53fdc43571c07c66b5dc22cdad9cc92c",
  "enabled": true,
  "folderPath": "/OTK/Server/Internal/Tools/OAuth Manager",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== *** THIS POLICY IS OVERWRITTEN DURING AN UPGRADE ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Be aware that custom configuration made in this policy is overwritten during a solution kit upgrade.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== However, the older version of the policy is kept in the history and can be referenced.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== After upgrade, manually merge customizations from the old version of the policy to the new version.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Implementation of a simple oauth manager that uses API calls only to access the client- and tokenstore\"/>\n        </L7p:CommentAssertion>\n        <L7p:CustomizeErrorResponse>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"HTML\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Content stringValueReference=\"inline\"><![CDATA[${website_top}\n                <div>\n                <h1>Error</h1>\n                <code>\n                ${error.msg}\n                </code>\n                </div>\n                <p>Please try again. If the error occurs again please click <a href=\"${this.app.url.login}\">here</a> to login again.</p>\n                <p>If the error still occurs please contact the system administrator.</p>\n                ${website_bottom}]]></L7p:Content>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"x-ca-err\"/>\n                    <L7p:Value stringValue=\"${error.code}\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n            <L7p:PolicyName stringValue=\"OTK Security Header Extension\"/>\n        </L7p:Include>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:AddHeader>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"HTTPS only\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Inform the browser to only accept SSL connections\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:HeaderName stringValue=\"Content-Security-Policy\"/>\n                <L7p:HeaderValue stringValue=\"default-src 'self'; script-src  ajax.googleapis.com 'unsafe-inline'; img-src * data:; style-src 'unsafe-inline'; font-src * data:;  object-src 'none';\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override OTK Security Header Extension\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden when user logs in or if a cookie is available\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"current.username\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden when user is looking up values of a different user\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"lookupUser\"/>\n        </L7p:SetVariable>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"054e5792-882a-4d7c-8294-5b2f6bee588b\"/>\n                <L7p:PolicyName stringValue=\"oauth manager website brand logo\"/>\n            </L7p:Include>\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"02dfa7fb-807f-4e55-a4d1-7a942b7fbc9f\"/>\n                <L7p:PolicyName stringValue=\"oauth manager config\"/>\n            </L7p:Include>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke3JlcXVlc3QudXJsLmhvc3R9Ojg0NDMke3JlcXVlc3QudXJsLnBhdGh9\"/>\n                <L7p:VariableToSet stringValue=\"this.app.url.login\"/>\n            </L7p:SetVariable>\n            <L7p:Regex>\n                <L7p:AutoTarget booleanValue=\"false\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"this.app.url.login\"/>\n                <L7p:Regex stringValue=\"/tokens$\"/>\n                <L7p:Replace booleanValue=\"true\"/>\n                <L7p:Replacement stringValue=\"\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:Regex>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"web content\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Configure the manager here\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"47f768f4-b478-472b-a1ee-10f4b6e76f99\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require SSL (with Client Certificate)\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireClientCert\"/>\n                        <L7p:value stringValue=\"false\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"require SSL\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override content-type with text/html\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"3d18cfd8-631f-48f1-b154-c11b85df2fb9\"/>\n                    <L7p:PolicyName stringValue=\"oauth manager validate cookie\"/>\n                </L7p:Include>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"21da0471-733a-47d1-a8e0-07384a10cc58\"/>\n                    <L7p:PolicyName stringValue=\"oauth manager set valid user\"/>\n                </L7p:Include>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${request.http.method}\"/>\n                        <L7p:Expression2 stringValue=\"GET\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"GET\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${synchToken}\"/>\n                        <L7p:Expression2 stringValue=\"${request.http.parameter.synchToken}\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:RightValue stringValue=\"${request.http.parameter.synchToken}\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                </wsp:OneOrMore>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:VariableToSet stringValue=\"state\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Session\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Use an existing session\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${current.username}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n            </L7p:Include>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"overwrite content-type\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// apply rate limit\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:CodeInjectionProtectionAssertion>\n                <L7p:IncludeBody booleanValue=\"true\"/>\n                <L7p:IncludeUrlPath booleanValue=\"true\"/>\n                <L7p:IncludeUrlQueryString booleanValue=\"true\"/>\n                <L7p:Protections codeInjectionProtectionTypeArray=\"included\">\n                    <L7p:item protectionType=\"htmlJavaScriptInjection\"/>\n                </L7p:Protections>\n                <L7p:Target target=\"REQUEST\"/>\n            </L7p:CodeInjectionProtectionAssertion>\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"103\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"givenErrorCode\"/>\n                        <L7p:value stringValue=\"103\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"overwrite content-type\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"PROTECT\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Validate form field params against xss or injection attacks\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHtpbmNsdWRlX2pxdWVyeV9zY3JpcHR9DQoNCnZhciBmaXJzdFBhZ2VPZmZzZXQgPSAwDQoNCmZ1bmN0aW9uIGxvYWRBamF4UGFnZShkZXN0aW5hdGlvbiwgc3RhdGUsIG9mZnNldCwgb2Zmc2V0VmFsdWUsIGZpbHRlclN0cmluZykgew0KDQoNCiAgICAvKiBNdXN0IHJlc2V0IHNlc3Npb24gc3RvcmFnZSAqLw0KICAgIGlmIChzdGF0ZSAhPT0gIm1hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uIikgew0KICAgICAgICBzZXNzaW9uU3RvcmFnZS5wYWdlID0gMA0KICAgICAgICBzZXNzaW9uU3RvcmFnZS5maXJzdFRva2VuRm9yUGFnZXMgPSAiW1wiXCJdIg0KICAgIH0NCg0KICAgICQucG9zdCgnJHt0aGlzLmFwcC51cmx9P3N0YXRlPScgKyBzdGF0ZSAgKyAoZmlsdGVyU3RyaW5nID8gJyYnICsgZmlsdGVyU3RyaW5nIDogJycpLCB7b2Zmc2V0OiBvZmZzZXQsIG9mZnNldFZhbHVlOiBvZmZzZXRWYWx1ZX0sZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgaWYoIChkYXRhICE9PSBudWxsKSAmJiAoZGF0YS50b1N0cmluZygpLmxhc3RJbmRleE9mKCc8dGQ+JykgPiAwKSApDQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZXN0aW5hdGlvbikuaW5uZXJIVE1MID0gZGF0YTsNCiAgICB9KTsNCiAgICANCn0NCg0KLyogdG9nZ2xlIGRpc2FibGVkIGNsYXNzICovDQpmdW5jdGlvbiB0b2dnbGVEaXNhYmxlZChjbGFzc05hbWUsIG1ha2VEaXNhYmxlZCkgew0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY2xhc3NOYW1lKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQogICAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW2ldOw0KICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBtYWtlRGlzYWJsZWQgPyBlbGVtZW50LmNsYXNzTmFtZSArICcgZGlzYWJsZWQnIDogZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgvIGRpc2FibGVkLywgJycpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQovKiBmaWx0ZXJpbmcgLyBwYWdpbmF0aW9uICovDQp2YXIgcmVzdWx0c1BlclBhZ2UgPSAxMDA7DQpmdW5jdGlvbiBsb2FkTmV4dEFqYXhQYWdlKGRlc3RpbmF0aW9uLCBzdGF0ZSwgY3VycmVudE9mZnNldCwgb2Zmc2V0VmFsdWUsIHRvdGFsUmVzdWx0cywgZmlsdGVyU3RyaW5nKSB7DQogICAgdmFyIG9mZnNldCA9IGN1cnJlbnRPZmZzZXQgKyByZXN1bHRzUGVyUGFnZTsNCiAgICBsb2FkQWpheFBhZ2UoZGVzdGluYXRpb24sIHN0YXRlLCBvZmZzZXQsIG9mZnNldFZhbHVlLCBmaWx0ZXJTdHJpbmcpOw0KfQ0KZnVuY3Rpb24gbG9hZFByZXZBamF4UGFnZShkZXN0aW5hdGlvbiwgc3RhdGUsIGN1cnJlbnRPZmZzZXQsIG9mZnNldFZhbHVlLCB0b3RhbFJlc3VsdHMsIGZpbHRlclN0cmluZykgew0KICAgIHZhciBvZmZzZXQgPSBjdXJyZW50T2Zmc2V0IC0gcmVzdWx0c1BlclBhZ2U7DQogICAgbG9hZEFqYXhQYWdlKGRlc3RpbmF0aW9uLCBzdGF0ZSwgb2Zmc2V0LCBvZmZzZXQsIGZpbHRlclN0cmluZyk7DQp9DQoNCmZ1bmN0aW9uIGxvYWROZXh0QWpheFBhZ2VDYXNzYW5kcmEoZGVzdGluYXRpb24sIHN0YXRlLCBjdXJyZW50T2Zmc2V0LCBvZmZzZXRWYWx1ZSwgdG90YWxSZXN1bHRzLCBmaWx0ZXJTdHJpbmcpIHsNCiAgICB2YXIgb2Zmc2V0ID0gTnVtYmVyKGN1cnJlbnRPZmZzZXQpICsgTnVtYmVyKHRvdGFsUmVzdWx0cyk7DQogICAgbG9hZEFqYXhQYWdlKGRlc3RpbmF0aW9uLCBzdGF0ZSwgb2Zmc2V0LCBvZmZzZXRWYWx1ZSwgZmlsdGVyU3RyaW5nKTsNCn0NCmZ1bmN0aW9uIGxvYWRQcmV2QWpheFBhZ2VDYXNzYW5kcmEoZGVzdGluYXRpb24sIHN0YXRlLCBjdXJyZW50T2Zmc2V0LCBvZmZzZXRWYWx1ZSwgdG90YWxSZXN1bHRzLCBmaWx0ZXJTdHJpbmcpIHsNCiAgICBpZiAob2Zmc2V0VmFsdWUgIT09ICIiKSB7DQogICAgICB2YXIgb2Zmc2V0ID0gY3VycmVudE9mZnNldCAtIHJlc3VsdHNQZXJQYWdlOw0KICAgIH0NCiAgICBsb2FkQWpheFBhZ2UoZGVzdGluYXRpb24sIHN0YXRlLCBvZmZzZXQsIG9mZnNldFZhbHVlLCBmaWx0ZXJTdHJpbmcpOw0KfQ0KDQoNCmZ1bmN0aW9uIGlzUGFnaW5hdGlvbkxpbmtFbmFibGVkKGxpbmspIHsNCiAgICB2YXIgbWluUm93VmFsdWUgPSAwOw0KICAgIHZhciByZXN1bHRUYWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YmxSZXN1bHQnKTsNCiAgICB2YXIgcmVzdWx0VGFibGVMZW5ndGggPSBwYXJzZUludCggcmVzdWx0VGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykubGVuZ3RoLCAxMCktMSB8fCAwIDsNCiAgICBpZiAocmVzdWx0VGFibGVMZW5ndGggPj0gMSkgew0KICAgICAgbWluUm93VmFsdWUgPSBwYXJzZUludChyZXN1bHRUYWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKVsxXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGQnKVswXS5pbm5lckhUTUwsIDEwKXx8MDsNCiAgICB9DQogICAgdmFyIGNsYXNzTmFtZSA9IGxpbmsuY2xhc3NOYW1lLnJlcGxhY2UoJyBkaXNhYmxlZCcsJycpOw0KICAgIHJldHVybiAoIChyZXN1bHRUYWJsZUxlbmd0aCA9PSAxMDApICYmIChjbGFzc05hbWUgPT0gJ25leHQtcGFnZS1saW5rJykgKSB8fCAoIChjbGFzc05hbWUgPT0gJ3ByZXYtcGFnZS1saW5rJykgJiYgbWluUm93VmFsdWUgPiAxMDAgKTsNCn0NCg0KLyogcGFnaW5hdGlvbiBvbiB0b2tlbnMgKi8NCmZ1bmN0aW9uIGxvYWROZXh0VG9rZW5QYWdlKGxpbmssIGRlc3RpbmF0aW9uLCBjdXJyZW50T2Zmc2V0LCBvZmZzZXRWYWx1ZSwgdG90YWxSZXN1bHRzKSB7DQogICAgaWYgKGlzUGFnaW5hdGlvbkxpbmtFbmFibGVkKGxpbmspKSBsb2FkTmV4dEFqYXhQYWdlKGRlc3RpbmF0aW9uLCAnbWFuYWdlT3duZXJzQ2xpZW50c1BhZ2luYXRpb24nLCBjdXJyZW50T2Zmc2V0LCBvZmZzZXRWYWx1ZSwgdG90YWxSZXN1bHRzLCBidWlsZFRva2VuRmlsdGVyU3RyaW5nKCkpOw0KfQ0KZnVuY3Rpb24gbG9hZFByZXZUb2tlblBhZ2UobGluaywgZGVzdGluYXRpb24sIGN1cnJlbnRPZmZzZXQsIG9mZnNldFZhbHVlLCB0b3RhbFJlc3VsdHMpIHsNCiAgICBpZiAoIWlzTmFOKG9mZnNldFZhbHVlKSAmJiBpc1BhZ2luYXRpb25MaW5rRW5hYmxlZChsaW5rKSkgbG9hZFByZXZBamF4UGFnZShkZXN0aW5hdGlvbiwgJ21hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uJywgY3VycmVudE9mZnNldCwgb2Zmc2V0VmFsdWUsIHRvdGFsUmVzdWx0cywgYnVpbGRUb2tlbkZpbHRlclN0cmluZygpKTsNCn0NCg0KDQpmdW5jdGlvbiBsb2FkUHJldlRva2VuUGFnZUNhc3NhbmRyYShsaW5rLCBkZXN0aW5hdGlvbiwgY3VycmVudE9mZnNldCwgb2Zmc2V0VmFsdWUsIHRvdGFsUmVzdWx0cykgew0KICAgIGxpbmsucmVtb3ZlQXR0cmlidXRlKCJvbmNsaWNrIik7IC8vIFByZXZlbnQgcmFwaWQtZmlyZSBjbGlja3MgZnJvbSBicmVha2luZyB0aGUgcGFnaW5nIHNhdmVzDQoNCiAgICAvLyBHZXQgcmlkIG9mIHBhZ2luYXRpb24gb25jbGljayBldmVudHMgaW4gY2FzZSBvZiBzcGFtbWluZw0KICAgIC8vIFdpbGwgbm90IG5lZWQgdG8gcmVlbmFibGUgcHJldmlvdXMgYnV0dG9uIGluIGFueSBzaXR1YXRpb24gc2luY2UgdGhlIG5ldyBwYWdlIHdpbGwgb3ZlcnJpZGUgaXQNCiAgICBuZXh0QnV0dG9ucyA9ICQoJy5uZXh0LXBhZ2UtbGluaycpDQogICAgdmFyIG5leHRCdXR0b25PbkNsaWNrID0gbmV4dEJ1dHRvbnNbMF0uZ2V0QXR0cmlidXRlKCJvbmNsaWNrIik7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZXh0QnV0dG9ucy5sZW5ndGg7IGkrKykgeyBuZXh0QnV0dG9uc1tpXS5yZW1vdmVBdHRyaWJ1dGUoIm9uY2xpY2siKTsgfQ0KICAgIHByZXZCdXR0b25zID0gJCgnLnByZXYtcGFnZS1saW5rJykNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZXZCdXR0b25zLmxlbmd0aDsgaSsrKSB7IHByZXZCdXR0b25zW2ldLnJlbW92ZUF0dHJpYnV0ZSgib25jbGljayIpOyB9DQogICAgDQogICAgaWYgKGN1cnJlbnRPZmZzZXQgPT09IGZpcnN0UGFnZU9mZnNldCkgew0KICAgICAgIC8vIFNldCBiYWNrIG5leHQgYnV0dG9uIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHBhZ2UuDQogICAgICAgLy8gRG9uJ3QgbmVlZCB0byByZWVuYWJsZSBwcmV2aW91cyBidXR0b24gc2luY2UgdGhlcmUncyBub3RoaW5nIHRvIGdvIGJhY2sgdG8NCiAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5leHRCdXR0b25zLmxlbmd0aDsgaSsrKSB7IG5leHRCdXR0b25zW2ldLnNldEF0dHJpYnV0ZSgib25jbGljayIsIG5leHRCdXR0b25PbkNsaWNrKTsgfQ0KICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyBFeGNlcHRpb25hbCBlZGdlLWNhc2Ugd2hlcmUgcmVzdWx0c1BlclBhZ2UgaXMgYSBmYWN0b3Igb2YgdGhlIGFic29sdXRlIHRvdGFsIG51bWJlciBvZiBjbGllbnRzDQogICAgLy8gRHVlIHRvIENhc3NhbmRyYSdzIGluYWJpbGl0eSB0byB0ZWxsIGlmIHRoZSBuZXh0IHJlc3VsdCBzZXQgd2lsbCBiZSBlbXB0eQ0KICAgIC8vIENoZWNrIGlmIHNlZSBpZiB0aGUgbmV4dCBidXR0b25zIGhhdmUgYWxyZWFkeSBiZWVuIGRpc2FibGVkIHdoaWNoIG1lYW5zIGFuIGVtcHR5IHJlc3VsdCBzZXQgd2FzIHJldHVybmVkDQogICAgLy8gVGhhdCBtZWFucyB0aGF0IHRoZSBjdXJyZW50IHBhZ2UgbnVtYmVyIGlzIDEgaGlnaGVyIHRoYW4gaXQgc2hvdWxkIGJlLCBzbyBzdWJ0cmFjdCAxIGZyb20gaXQNCiAgICBpZiAodG90YWxSZXN1bHRzID09PSByZXN1bHRzUGVyUGFnZSAmJiBuZXh0QnV0dG9uT25DbGljayA9PT0gbnVsbCkgew0KICAgICAgc2Vzc2lvblN0b3JhZ2UucGFnZSA9IE51bWJlcihzZXNzaW9uU3RvcmFnZS5wYWdlKSAtIDE7DQogICAgfQ0KICAgIA0KICAgIHNlc3Npb25TdG9yYWdlLnBhZ2UgPSBOdW1iZXIoc2Vzc2lvblN0b3JhZ2UucGFnZSkgLSAxOw0KICAgIHZhciBvZmZzZXRzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5maXJzdFRva2VuRm9yUGFnZXMpOw0KICAgIGlmIChpc1BhZ2luYXRpb25MaW5rRW5hYmxlZChsaW5rKSkgbG9hZFByZXZBamF4UGFnZUNhc3NhbmRyYShkZXN0aW5hdGlvbiwgJ21hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uJywgY3VycmVudE9mZnNldCwgb2Zmc2V0c1tOdW1iZXIoc2Vzc2lvblN0b3JhZ2UucGFnZSldLCB0b3RhbFJlc3VsdHMsIGJ1aWxkVG9rZW5GaWx0ZXJTdHJpbmcoKSk7DQp9DQoNCmZ1bmN0aW9uIGxvYWROZXh0VG9rZW5QYWdlQ2Fzc2FuZHJhKGxpbmssIGRlc3RpbmF0aW9uLCBjdXJyZW50T2Zmc2V0LCBvZmZzZXRWYWx1ZSwgdG90YWxSZXN1bHRzKSB7DQogICAgbGluay5yZW1vdmVBdHRyaWJ1dGUoIm9uY2xpY2siKTsgLy8gUHJldmVudCByYXBpZC1maXJlIGNsaWNrcyBmcm9tIGJyZWFraW5nIHRoZSBwYWdpbmcgc2F2ZXMNCg0KICAgIC8vIEdldCByaWQgb2YgcGFnaW5hdGlvbiBvbmNsaWNrIGV2ZW50cyBpbiBjYXNlIG9mIHNwYW1taW5nDQogICAgLy8gV2lsbCBub3QgbmVlZCB0byByZWVuYWJsZSB0aGUgbmV4dCBidXR0b24gaW4gYW55IHNpdHVhdGlvbiBzaW5jZSB0aGUgbmV3IHBhZ2Ugd2lsbCBvdmVycmlkZSBpdA0KICAgIHByZXZCdXR0b25zID0gJCgnLnByZXYtcGFnZS1saW5rJykNCiAgICB2YXIgcHJldkJ1dHRvbk9uQ2xpY2sgPSBwcmV2QnV0dG9uc1swXS5nZXRBdHRyaWJ1dGUoIm9uY2xpY2siKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZXZCdXR0b25zLmxlbmd0aDsgaSsrKSB7IHByZXZCdXR0b25zW2ldLnJlbW92ZUF0dHJpYnV0ZSgib25jbGljayIpOyB9DQogICAgbmV4dEJ1dHRvbnMgPSAkKCcubmV4dC1wYWdlLWxpbmsnKQ0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV4dEJ1dHRvbnMubGVuZ3RoOyBpKyspIHsgbmV4dEJ1dHRvbnNbaV0ucmVtb3ZlQXR0cmlidXRlKCJvbmNsaWNrIik7IH0NCiAgICANCiAgICBpZiAodG90YWxSZXN1bHRzICE9PSByZXN1bHRzUGVyUGFnZSkgew0KICAgICAgLy8gU2V0IGJhY2sgcHJldiBidXR0b24gaWYgdGhpcyBpcyB0aGUgbGFzdCBwYWdlLg0KICAgICAgLy8gRG9uJ3QgbmVlZCB0byByZWVuYWJsZSBuZXh0IGJ1dHRvbiBzaW5jZSB0aGVyZSdzIG5vdGhpbmcgZnVydGhlciBhaGVhZA0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmV2QnV0dG9ucy5sZW5ndGg7IGkrKykgeyBwcmV2QnV0dG9uc1tpXS5zZXRBdHRyaWJ1dGUoIm9uY2xpY2siLCBwcmV2QnV0dG9uT25DbGljayk7IH0NCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgDQogICAgaWYgKHR5cGVvZihzZXNzaW9uU3RvcmFnZS5maXJzdFRva2VuRm9yUGFnZXMpID09PSAndW5kZWZpbmVkJykgew0KICAgICAgdmFyIGZpcnN0VmFsdWVzID0gWyIiXTsNCiAgICAgIHNlc3Npb25TdG9yYWdlLmZpcnN0VG9rZW5Gb3JQYWdlcyA9IEpTT04uc3RyaW5naWZ5KGZpcnN0VmFsdWVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIGZpcnN0VmFsdWVzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5maXJzdFRva2VuRm9yUGFnZXMpOw0KICAgIH0NCg0KICAgIGlmICh0eXBlb2Yoc2Vzc2lvblN0b3JhZ2UucGFnZSkgPT09ICd1bmRlZmluZWQnKSB7IHNlc3Npb25TdG9yYWdlLnBhZ2UgPSAxOyB9DQogICAgZWxzZSB7IHNlc3Npb25TdG9yYWdlLnBhZ2UgPSBOdW1iZXIoc2Vzc2lvblN0b3JhZ2UucGFnZSkgKyAxOyB9DQogICAgDQogICAgaWYgKHR5cGVvZihmaXJzdFZhbHVlc1tOdW1iZXIoc2Vzc2lvblN0b3JhZ2UucGFnZSldKSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgIGZpcnN0VmFsdWVzLnB1c2gob2Zmc2V0VmFsdWUpOw0KICAgICAgc2Vzc2lvblN0b3JhZ2UuZmlyc3RUb2tlbkZvclBhZ2VzID0gSlNPTi5zdHJpbmdpZnkoZmlyc3RWYWx1ZXMpOw0KICAgIH0NCg0KICAgIGlmIChpc1BhZ2luYXRpb25MaW5rRW5hYmxlZChsaW5rKSkgbG9hZE5leHRBamF4UGFnZUNhc3NhbmRyYShkZXN0aW5hdGlvbiwgJ21hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uJywgY3VycmVudE9mZnNldCwgb2Zmc2V0VmFsdWUsIHRvdGFsUmVzdWx0cywgYnVpbGRUb2tlbkZpbHRlclN0cmluZygpKTsNCiAgICANCiAgICAvLyBFZGdlY2FzZSA6IGlmIHRoaXMgaXMgdGhlIGxhc3QgcGFnZSBhbmQgcmVzdWx0cyBpcyBkaXZpc2libGUgYnkgcmVzdWx0c1BlclBhZ2UsIHdlIGhhdmUgdG8gc2V0IGJhY2sgdG8gcHJldmlvdXMgYnV0dG9uIGNsaWNrDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmV2QnV0dG9ucy5sZW5ndGg7IGkrKykgeyBwcmV2QnV0dG9uc1tpXS5zZXRBdHRyaWJ1dGUoIm9uY2xpY2siLCBwcmV2QnV0dG9uT25DbGljayk7IH0NCn0NCg0KDQoNCi8qIGFjdGlvbiBjb25maXJtYXRpb24gKi8NCmZ1bmN0aW9uIGNvbmZpcm1SZXZva2UocmV2T3duZXIsIHJldkNsaWVudCkgew0KICAgIHJldHVybiBjb25maXJtKCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmV2b2tlIGFjY2VzcyBmb3IgJyIrcmV2Q2xpZW50KyInIGdyYW50ZWQgYnkgJyIrcmV2T3duZXIrIic/Iik7DQp9DQpmdW5jdGlvbiBjb25maXJtU3RhdHVzQ2hhbmdlKHJldlRva2VuKSB7DQogICAgcmV0dXJuIGNvbmZpcm0oIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjaGFuZ2UgdGhlIHN0YXR1cyBmb3IgdGhlIHRva2VuICciK3JldlRva2VuKyInPyIpOw0KfQ0KDQovKiB0b2dnbGluZyBibG9ja3MgYW5kIGRyb3Bkb3ducyAqLw0KZnVuY3Rpb24gYWN0aXZhdGVUb2dnbGVCbG9ja3MoKSB7DQogICAgaWYgKHR5cGVvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsID09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgdmFyIHRvZ2dsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9nZ2xlJyk7DQogICAgICAgIGZvciAodmFyIGkgPSB0b2dnbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQogICAgICAgICAgICB2YXIgdG9nZ2xlID0gdG9nZ2xlc1tpXTsNCiAgICAgICAgICAgIHZhciBsaW5rID0gdG9nZ2xlLnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2dnbGUtbGluaycpWzBdOw0KICAgICAgICAgICAgbGluay50b2dnbGUgPSB0b2dnbGU7DQogICAgICAgICAgICBsaW5rLm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgdmFyIHRvZ2dsZSA9IHRoaXMudG9nZ2xlOw0KICAgICAgICAgICAgICAgIGlmICh0b2dnbGUuY2xhc3NOYW1lLnNlYXJjaCgnb3BlbicpID4gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlLmNsYXNzTmFtZSA9IHRvZ2dsZS5jbGFzc05hbWUucmVwbGFjZSgvIG9wZW4vLCAnJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0b2dnbGUuY2xhc3NOYW1lICs9ICcgb3Blbic7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KPC9zY3JpcHQ+\"/>\n                <L7p:VariableToSet stringValue=\"js\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KICAgIDx0aXRsZT4ke3RoaXMuYXBwLm5hbWV9PC90aXRsZT4NCiAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIvPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9OCxJRT05LElFPTEwLElFPTExLGNocm9tZT0xIiAvPg0KICAgICR7Y3NzfQ0KICAgICR7anN9DQo8L2hlYWQ+DQoNCjxib2R5Pg0KICAgIDxkaXY+DQogICAgICAgIDxkaXYgY2xhc3M9Im5hdmJhciI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXItZmx1aWQiPg0KICAgICAgICAgICAgICAgICR7YnJhbmRMb2dvfQ0KICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaXRlIiBocmVmPSIke3RoaXMuYXBwLnVybC5sb2dpbn0/c3RhdGU9aW5pdCI+JHt0aGlzLmFwcC5uYW1lfTwvYT4NCjwhLS1MT0dHRURfSU5fVVNFUl9ESVYtLT4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4NCjwhLS1MT0dHRURfSU5fTkFWX0RJVi0tPg==\"/>\n                <L7p:VariableToSet stringValue=\"website_top\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icm93LWZsdWlkIHBvcnRhbC1mb290ZXIiPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYW4xMiI+DQogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJwb3J0YWwtY29weXJpZ2h0Ij7CqSAyMDIwIEJyb2FkY29tLiBBbGwgUmlnaHRzIFJlc2VydmVkLiBUaGUgdGVybSAnQnJvYWRjb20nIHJlZmVycyB0byBCcm9hZGNvbSBJbmMuIGFuZC9vciBpdHMgc3Vic2lkaWFyaWVzLjwvcD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgICAgIGFjdGl2YXRlVG9nZ2xlQmxvY2tzKCk7DQogICAgPC9zY3JpcHQ+DQo8L2JvZHk+DQo8L2h0bWw+\"/>\n                <L7p:VariableToSet stringValue=\"website_bottom\"/>\n            </L7p:SetVariable>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"PHVsIGNsYXNzPSJ1c2VyLW1lbnUgcHVsbC1yaWdodCI+DQogICAgPGxpIGNsYXNzPSJ0b2dnbGUgZHJvcGRvd24iPg0KICAgICAgICA8c3BhbiBjbGFzcz0idG9nZ2xlLWxpbmsiPg0KICAgICAgICAgICAgJHtjdXJyZW50LnVzZXJuYW1lfSA8YiBjbGFzcz0iY2FyZXQiPjwvYj4NCiAgICAgICAgPC9zcGFuPg0KICAgICAgICA8dWwgY2xhc3M9InRvZ2dsZS1ibG9jayI+DQogICAgICAgICAgICA8bGk+PGZvcm0gYWN0aW9uPSIuLi9tYW5hZ2VyP3N0YXRlPWxvZ291dCIgbWV0aG9kPSJQT1NUIiBlbmN0eXBlPSJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiIGlkPSJsb2dvdXRGb3JtIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJzeW5jaFRva2VuIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSIke3N5bmNoVG9rZW59IiAvPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1tZWRpdW0iIGlkPSJsb2dvdXRCdXR0b24iIHR5cGU9InN1Ym1pdCIgdmFsdWU9ImxvZ291dCI+TG9nb3V0PC9idXR0b24+DQogICAgICAgICAgICAgICAgPC9mb3JtPg0KCQkgIDwvbGk+DQogICAgICAgIDwvdWw+DQogICAgPC9saT4NCjwvdWw+\"/>\n                        <L7p:VariableToSet stringValue=\"loggedInDiv\"/>\n                    </L7p:SetVariable>\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"website_top\"/>\n                        <L7p:Regex stringValue=\"&lt;!--LOGGED_IN_USER_DIV-->\"/>\n                        <L7p:Replace booleanValue=\"true\"/>\n                        <L7p:Replacement stringValue=\"${loggedInDiv}\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icm93LWZsdWlkIj4NCiAgICA8ZGl2IGlkPSJuYXYiPg0KICAgICAgICA8dWwgY2xhc3M9ImlubGluZSI+DQogICAgICAgICAgICA8bGkgaWQ9Im5hdi1ob21lIj48YSBocmVmPSIuLi9tYW5hZ2VyP3N0YXRlPWluaXQiPjxpIGNsYXNzPSJpY29uLXBvcnRhbC1ob21lIj48L2k+PGJyIC8+SG9tZTwvYT48L2xpPg0KICAgICAgICAgICAgPGxpIGlkPSJuYXYtY2xpZW50cyI+PGEgaHJlZj0iY2xpZW50cz9zdGF0ZT1tYW5hZ2VDbGllbnRzJmxvb2t1cFVzZXI9JHtsb29rdXBVc2VyfSI+PGkgY2xhc3M9Imljb24tcG9ydGFsLXVzZXJzIj48L2k+PGJyIC8+Q2xpZW50czwvYT48L2xpPg0KICAgICAgICAgICAgPGxpIGlkPSJuYXYtdG9rZW5zIj48YSBocmVmPSJ0b2tlbnM/c3RhdGU9bWFuYWdlT3duZXJzQ2xpZW50cyZsb29rdXBVc2VyPSR7bG9va3VwVXNlcn0mb2Zmc2V0PTAiPjxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcHBsaWNhdGlvbnMiPjwvaT48YnIgLz5Ub2tlbnM8L2E+PC9saT4NCiAgICAgICAgPC91bD4NCiAgICAgICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgICAgICAgICAgdmFyIHN0YXRlQXJyYXkgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL3N0YXRlPShbXiZdKykvKTsNCiAgICAgICAgICAgIHZhciBjdXJyZW50TWVudUl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2LWhvbWUnKTsNCiAgICAgICAgICAgIGlmIChzdGF0ZUFycmF5ICYmIHN0YXRlQXJyYXkubGVuZ3RoICYmIHN0YXRlQXJyYXkubGVuZ3RoID49IDIpIHsNCiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBzdGF0ZUFycmF5WzFdOw0KICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlQ2xpZW50cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFnZUNsaWVudHNGaWx0ZXInOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdyZWdpc3Rlcic6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlZ2lzdGVyZWQnOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVDbGllbnQnOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdlZGl0Q2xpZW50JzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlQ2xpZW50JzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xpZW50S2V5cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Jldm9rZUtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FkZEtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2tleUFkZGVkJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZWRpdEtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2tleUVkaXRlZCc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVUb2tlbnMnOg0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1lbnVJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdi1jbGllbnRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlT3duZXJzQ2xpZW50cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlVG9rZW5zRmlsdGVyJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmV2b2tlJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAndG9nZ2xlU3RhdHVzJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNZW51SXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtdG9rZW5zJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICAgICAgICAgICAgIA0KICAgICAgICAgICAgY3VycmVudE1lbnVJdGVtLmNsYXNzTmFtZSA9ICdhY3RpdmUnOw0KICAgICAgICA8L3NjcmlwdD4NCiAgICA8L2Rpdj4NCjwvZGl2Pg==\"/>\n                        <L7p:VariableToSet stringValue=\"loggedInNavDiv\"/>\n                    </L7p:SetVariable>\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"website_top\"/>\n                        <L7p:Regex stringValue=\"&lt;!--LOGGED_IN_NAV_DIV-->\"/>\n                        <L7p:Replace booleanValue=\"true\"/>\n                        <L7p:Replacement stringValue=\"${loggedInNavDiv}\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                </wsp:All>\n            </wsp:OneOrMore>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"web content\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Set js and website_top/website_bottom content here\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Create the filters for looking up tokens\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"PGgyPkZpbHRlciBzZWFyY2ggcmVzdWx0czwvaDI+DQogICAgICAgIDxmb3JtIG9uc3VibWl0PSJzZWFyY2hUb2tlbnMoJ21hbmFnZVRva2Vuc1Jlc3VsdCcpOyByZXR1cm4gZmFsc2U7Ij4NCiAgICAgICAgICAgIDx0YWJsZSBpZD0iZmlsdGVyc0NsaWVudHNUYWJsZSIgY2xhc3M9InRhYmxlLWZvcm0iPg0KICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPSJ3aWR0aDogMTcwcHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImZpbHRlclJlc291cmNlT3duZXIiPlJlc291cmNlIE93bmVyPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iZmlsdGVyUmVzb3VyY2VPd25lciIgdHlwZT0idGV4dCIgbmFtZT0ibG9va3VwVXNlciIgd2lkdGg9IjEwMCIgdmFsdWU9IiR7bG9va3VwVXNlcn0iPg0KICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9IndpZHRoOiAxNzBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iZmlsdGVyUmVmcmVzaFRva2VuIj5SZWZyZXNoIFRva2VuPC9sYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iZmlsdGVyUmVmcmVzaFRva2VuIiB0eXBlPSJ0ZXh0IiBuYW1lPSJmaWx0ZXJSZWZyZXNoVG9rZW4iIHdpZHRoPSIxMDAiPg0KICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9IndpZHRoOiAxNzBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iZmlsdGVyQWNjZXNzVG9rZW4iPkFjY2VzcyBUb2tlbjwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9ImZpbHRlckFjY2Vzc1Rva2VuIiB0eXBlPSJ0ZXh0IiBuYW1lPSJmaWx0ZXJBY2Nlc3NUb2tlbiIgd2lkdGg9IjEwMCI+DQogICAgICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0id2lkdGg6IDExMHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJmaWx0ZXJTdGF0dXMiPlN0YXR1czwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJmaWx0ZXJTdGF0dXMiIG5hbWU9ImZpbHRlclN0YXR1cyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRU5BQkxFRCIgc2VsZWN0ZWQ9InNlbGVjdGVkIj5FTkFCTEVEPC9vcHRpb24+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRElTQUJMRUQiPkRJU0FCTEVEPC9vcHRpb24+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkPjxiciAvPjxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iU2VhcmNoIj5TZWFyY2g8L2J1dHRvbj48L3RkPg0KICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICA8L3RhYmxlPg0KICAgICAgICA8L2Zvcm0+DQo8YnIgLz4NCg0KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KZnVuY3Rpb24gYnVpbGRUb2tlbkZpbHRlclN0cmluZygpIHsNCiAgICB2YXIgbG9va3VwVXNlciA9IGVuY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyUmVzb3VyY2VPd25lcicpLnZhbHVlKTsNCiAgICB2YXIgcmVmcmVzaFRva2VuID0gZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJSZWZyZXNoVG9rZW4nKS52YWx1ZSk7DQogICAgdmFyIGFjY2Vzc1Rva2VuID0gZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJBY2Nlc3NUb2tlbicpLnZhbHVlKTsNCiAgICB2YXIgc3RhdHVzID0gZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJTdGF0dXMnKS52YWx1ZSk7DQogICAgcmV0dXJuICdsb29rdXBVc2VyPScgKyBsb29rdXBVc2VyICsgJyZmaWx0ZXJSZWZyZXNoVG9rZW49JyArIHJlZnJlc2hUb2tlbiArICcmZmlsdGVyQWNjZXNzVG9rZW49JyArIGFjY2Vzc1Rva2VuICsgJyZmaWx0ZXJTdGF0dXM9JyArIHN0YXR1cyArICcmc3luY2hUb2tlbj0ke3N5bmNoVG9rZW59JzsNCn0NCmZ1bmN0aW9uIHNlYXJjaFRva2VucyhkZXN0aW5hdGlvbikgew0KICAgIGxvYWRBamF4UGFnZShkZXN0aW5hdGlvbiwgJ21hbmFnZVRva2Vuc0ZpbHRlcicsIDAsICcnLCBidWlsZFRva2VuRmlsdGVyU3RyaW5nKCkpOw0KfQ0KZnVuY3Rpb24gc2V0VmFsaWRGaWx0ZXJzKCkgew0KICAgIHZhciBsb29rdXBVc2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlclJlc291cmNlT3duZXInKTsNCiAgICBsb29rdXBVc2VyLmRpc2FibGVkID0gISR7aXNBZG1pbn07DQp9DQpzZXRWYWxpZEZpbHRlcnMoKTsNCjwvc2NyaXB0Pg==\"/>\n            <L7p:VariableToSet stringValue=\"filtersTokens\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lm1haW5wYXJ0fSR7cmVxdWVzdC51cmx9\"/>\n                    <L7p:VariableToSet stringValue=\"requestUrl\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2be8eaf2-9b42-4173-ace9-3fdb471fb407\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"API XSS Protection\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allinput\"/>\n                            <L7p:value stringValue=\"${request.mainpart}${request.url}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:Regex>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Extra check for quotes/brackets\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:CaseInsensitive booleanValue=\"true\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"request.url\"/>\n                    <L7p:ProceedIfPatternMatches booleanValue=\"false\"/>\n                    <L7p:Regex stringValue=\"(%22|[&quot;]|%29|\\(|%28|\\))\"/>\n                    <L7p:RegexName stringValue=\"Validate URL input\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CommentAssertion>\n                    <L7p:Comment stringValue=\"website_top may have had malicious data inside, so reset it\"/>\n                </L7p:CommentAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KICAgIDx0aXRsZT4ke3RoaXMuYXBwLm5hbWV9PC90aXRsZT4NCiAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIvPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9OCxJRT05LElFPTEwLElFPTExLGNocm9tZT0xIiAvPg0KICAgICR7Y3NzfQ0KICAgICR7anN9DQo8L2hlYWQ+DQoNCjxib2R5Pg0KICAgIDxkaXY+DQogICAgICAgIDxkaXYgY2xhc3M9Im5hdmJhciI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXItZmx1aWQiPg0KICAgICAgICAgICAgICAgICR7YnJhbmRMb2dvfQ0KICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaXRlIiBocmVmPSIke3RoaXMuYXBwLnVybC5sb2dpbn0/c3RhdGU9aW5pdCI+JHt0aGlzLmFwcC5uYW1lfTwvYT4NCjwhLS1MT0dHRURfSU5fVVNFUl9ESVYtLT4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4NCjwhLS1MT0dHRURfSU5fTkFWX0RJVi0tPg==\"/>\n                    <L7p:VariableToSet stringValue=\"website_top\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"json response\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"return json error response\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"error.content\"/>\n                            <L7p:value stringValue=\"${error.msg}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"new.content\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"other\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"task\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:FalseAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"return false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"stop processing the whole policy\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                </L7p:FalseAssertion>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"XSS check point\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRva2VufQ==\"/>\n            <L7p:VariableToSet stringValue=\"token\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${isAdmin}\"/>\n                <L7p:Expression2 stringValue=\"true\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"true\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${token}\"/>\n                <L7p:Expression2 stringValue=\"true\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"true\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"75862a66-03a9-485f-9c10-b5bd47afbd4a\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Get (token)\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"client_key\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"queryOffset\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"resource_owner\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"return_json\"/>\n                            <L7p:value stringValue=\"false\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"rtoken\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"token\"/>\n                            <L7p:value stringValue=\"${token}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"token_status\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:ResponseXpathAssertion>\n                    <L7p:VariablePrefix stringValue=\"xpathResourceOwner\"/>\n                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"/ns:values/ns:value/ns:resource_owner/text()\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ns\"/>\n                                <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                        <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                    </L7p:XpathExpression>\n                </L7p:ResponseXpathAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${current.username}\"/>\n                    <L7p:Expression2 stringValue=\"${xpathResourceOwner.result}\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"${xpathResourceOwner.result}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"non-admin must match token's resource_owner\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${error.code}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"MDAw\"/>\n                        <L7p:VariableToSet stringValue=\"error.code\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error.code\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error code message\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                            <L7p:VariableToSet stringValue=\"error.msg\"/>\n                        </L7p:SetVariable>\n                    </wsp:OneOrMore>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error.msg\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                    <L7p:VariableToSet stringValue=\"error.msg\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:AuditDetailAssertion>\n                    <L7p:Detail stringValue=\"error.code: '${error.code}', error.msg: ${error.msg}\"/>\n                </L7p:AuditDetailAssertion>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"create an error response\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"verify admin, or non-admin matches owner of token they're modifying\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"========================\"/>\n            </L7p:CommentAssertion>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"=== As of here: management tasks ==\"/>\n            </L7p:CommentAssertion>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"========================\"/>\n            </L7p:CommentAssertion>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"=== Tokens overview ==\"/>\n            </L7p:CommentAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"manageOwnersClients\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"manageOwnersClients\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${offset}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"int\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"GE\"/>\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"75862a66-03a9-485f-9c10-b5bd47afbd4a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Get (token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"${offsetValue}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${lookupUser}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterRefreshToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterAccessToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterStatus}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                            <L7p:ContentType stringValue=\"text/xml; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"findDates\"/>\n                        </L7p:SetVariable>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathOffset\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/@offset\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathCount\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"count(/ns:values/ns:value)\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHt4cGF0aENvdW50LnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"count\"/>\n                        </L7p:SetVariable>\n                        <L7p:XslTransformation>\n                            <L7p:Direction intValue=\"-1\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:ResourceInfo staticResourceInfo=\"included\">\n                                <L7p:Document stringValueReference=\"inline\"><![CDATA[<xsl:stylesheet version=\"1.0\" xmlns:ns=\"http://ns.l7tech.com/2012/11/otk-tokenstore\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n                <xsl:output method=\"html\"/>\n                <xsl:param name=\"this.app.url\"/>\n                <xsl:param name=\"offset\"/>\n                <xsl:param name=\"synchToken\"/>\n                \n                <xsl:template match=\"/ns:values\">\n                <table border=\"1\" class=\"table-striped table-hover\" id=\"tblResult\" style=\"padding:2px; empty-cells: show;\">\n                <tr style=\"background-color: rgb(216,216,216);\">\n                <xsl:choose>\n                <xsl:when test=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                \n                <th>index</th>\n                <xsl:for-each select=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                <th>\n                <xsl:value-of select=\"name()\"/>\n                </th>\n                </xsl:for-each>\n                <th colspan=\"2\">action</th>\n                </xsl:when>\n                  <xsl:otherwise>\n                    <td>\n                        <xsl:text>No records found</xsl:text>\n                     </td>\n                  </xsl:otherwise>\n                </xsl:choose>\n                </tr>\n                <xsl:for-each select=\"ns:value[node()]\">\n                <xsl:variable name=\"tempToken\" select=\"descendant::node()[local-name()='token']\"/>\n                <xsl:variable name=\"tempClient\" select=\"descendant::node()[local-name()='client_key']\"/>\n                <xsl:variable name=\"tempOwner\" select=\"descendant::node()[local-name()='resource_owner']\"/>\n                <xsl:variable name=\"tempStatus\" select=\"descendant::node()[local-name()='status']\"/>\n                <tr>\n                <td>\n                <xsl:value-of select=\"@index+number($offset)\"/>\n                </td>\n                <xsl:for-each select=\"descendant::node()[not(name()='')]\">\n                <td>\n                <xsl:value-of select=\"text()\"/>\n                </td>\n                </xsl:for-each>\n                <td>\n                <form action=\"{$this.app.url}?state=revoke\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmRevoke('{$tempOwner}', '{$tempClient}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"Revoke\">Revoke</button>\n                </form>\n                </td>\n                <td>\n                <form action=\"{$this.app.url}?state=toggleStatus\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmStatusChange('{$tempToken}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <xsl:choose>\n                <xsl:when test=\"$tempStatus = 'ENABLED'\">\n                <input name=\"newStatus\" type=\"hidden\" value=\"DISABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"DISABLE\">DISABLE</button>\n                </xsl:when>\n                <xsl:otherwise>\n                <input name=\"newStatus\" type=\"hidden\" value=\"ENABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"ENABLE\">ENABLE</button>\n                </xsl:otherwise>\n                </xsl:choose>\n                </form>\n                </td>\n                </tr>\n                </xsl:for-each>\n                </table>\n                </xsl:template>\n\n                </xsl:stylesheet>]]></L7p:Document>\n                            </L7p:ResourceInfo>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:TransformName stringValue=\"\"/>\n                            <L7p:XsltVersion stringValue=\"1.0\"/>\n                        </L7p:XslTransformation>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                            <L7p:VariableToSet stringValue=\"toBeReturned\"/>\n                        </L7p:SetVariable>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"3ae5d6fb-94ac-4fb3-a798-b76258b0b265\"/>\n                            <L7p:PolicyName stringValue=\"oauth manager dates tokens\"/>\n                        </L7p:Include>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${count}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"int\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"GT\"/>\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${dbsystem}\"/>\n                                    <L7p:Expression2 stringValue=\"cassandra\"/>\n                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"cassandra\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icGFnaW5hdGlvbiI+DQogICAgPHNwYW4gY2xhc3M9InByZXYtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkUHJldlRva2VuUGFnZUNhc3NhbmRyYSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIDxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcnJvdy1sZWZ0Ij48L2k+IFByZXYNCiAgICA8L3NwYW4+DQogICAgPHNwYW4gY2xhc3M9Im5leHQtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkTmV4dFRva2VuUGFnZUNhc3NhbmRyYSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIE5leHQgPGkgY2xhc3M9Imljb24tcG9ydGFsLWFycm93LXJpZ2h0Ij48L2k+DQogICAgPC9zcGFuPg0KPC9kaXY+\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"cassandra\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icGFnaW5hdGlvbiI+DQogICAgPHNwYW4gY2xhc3M9InByZXYtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkUHJldlRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIDxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcnJvdy1sZWZ0Ij48L2k+IFByZXYNCiAgICA8L3NwYW4+DQogICAgPHNwYW4gY2xhc3M9Im5leHQtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkTmV4dFRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIE5leHQgPGkgY2xhc3M9Imljb24tcG9ydGFsLWFycm93LXJpZ2h0Ij48L2k+DQogICAgPC9zcGFuPg0KPC9kaXY+\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"cassandra or jdbc?\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"\"/>\n                                <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0KPHNjcmlwdD4KLyogTXVzdCByZXNldCBzZXNzaW9uIHN0b3JhZ2Ugc28gcHJldmlvdXMgcGFnaW5nIHZhbHVlcyBhcmUgbm90IGF0dGVtcHRlZCBpbiBjYXNlIG9mIGNoYW5nZXMgKi8Kc2Vzc2lvblN0b3JhZ2UucGFnZSA9IDAKc2Vzc2lvblN0b3JhZ2UuZmlyc3RUb2tlbkZvclBhZ2VzID0gIltcIlwiXSIKPC9zY3JpcHQ+CjxkaXY+CjxoMT5NYW5hZ2UgVG9rZW5zPC9oMT4KPHA+VGhpcyBpcyBhbiBvdmVydmlldyBvZiBhbGwgdXNlcnMgd2l0aCBncmFudGVkIGNsaWVudCBhcHBsaWNhdGlvbnM8L3A+CiR7ZmlsdGVyc1Rva2Vuc30KPGRpdiBpZD0ibWFuYWdlVG9rZW5zUmVzdWx0Ij4KJHtwYWdpbmF0aW9uQnV0dG9uc30KJHt0b0JlUmV0dXJuZWR9CiR7cGFnaW5hdGlvbkJ1dHRvbnN9CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KaWYgKCR7eHBhdGhDb3VudC5yZXN1bHR9ID4gcmVzdWx0c1BlclBhZ2UpIHsKICAgIHRvZ2dsZURpc2FibGVkKCduZXh0LXBhZ2UtbGluaycsIGZhbHNlKTsKfQo8L3NjcmlwdD4KPC9kaXY+CjwvZGl2Pgoke3dlYnNpdGVfYm90dG9tfQ==\"/>\n                            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <L7p:HardcodedResponse>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxzY3JpcHQ+Ci8qIE11c3QgcmVzZXQgc2Vzc2lvbiBzdG9yYWdlIHNvIHByZXZpb3VzIHBhZ2luZyB2YWx1ZXMgYXJlIG5vdCBhdHRlbXB0ZWQgaW4gY2FzZSBvZiBjaGFuZ2VzICovCnNlc3Npb25TdG9yYWdlLnBhZ2UgPSAwCnNlc3Npb25TdG9yYWdlLmZpcnN0VG9rZW5Gb3JQYWdlcyA9ICJbXCJcIl0iCjwvc2NyaXB0Pgo8aDE+TWFuYWdlIFRva2VuczwvaDE+DQo8cD5UaGlzIGlzIGFuIG92ZXJ2aWV3IG9mIGFsbCBjbGllbnRzIGdyYW50ZWQgYnkgYSByZXNvdXJjZV9vd25lcjwvcD4NCiR7d2Vic2l0ZV9ib3R0b219\"/>\n                        <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    </L7p:HardcodedResponse>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"List long living tokens\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"manageTokensFilter\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"manageTokensFilter\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"75862a66-03a9-485f-9c10-b5bd47afbd4a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Get (token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"${offsetValue}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${lookupUser}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterRefreshToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterAccessToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterStatus}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                            <L7p:ContentType stringValue=\"text/xml; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"findDates\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${offset}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"MA==\"/>\n                                <L7p:VariableToSet stringValue=\"offset\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathOffset\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/@offset\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathCount\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"count(/ns:values/ns:value)+number($offset)\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHt4cGF0aENvdW50LnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"count\"/>\n                        </L7p:SetVariable>\n                        <L7p:XslTransformation>\n                            <L7p:Direction intValue=\"-1\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:ResourceInfo staticResourceInfo=\"included\">\n                                <L7p:Document stringValueReference=\"inline\"><![CDATA[<xsl:stylesheet version=\"1.0\" xmlns:ns=\"http://ns.l7tech.com/2012/11/otk-tokenstore\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n\n                <xsl:output method=\"html\"/>\n\n                <xsl:param name=\"this.app.url\"/>\n                <xsl:param name=\"offset\"/>\n                <xsl:param name=\"synchToken\"/>\n                \n                <xsl:template match=\"/ns:values\">\n                <table border=\"1\" class=\"table-striped table-hover\" id=\"tblResult\" style=\"padding:2px; empty-cells: show;\">\n                <tr style=\"background-color: rgb(216,216,216);\">\n                <xsl:choose>\n                <xsl:when test=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                \n                <th>index</th>\n                <xsl:for-each select=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                <th>\n                <xsl:value-of select=\"name()\"/>\n                </th>\n                </xsl:for-each>\n                <th colspan=\"2\">action</th>\n                </xsl:when>\n                  <xsl:otherwise>\n                    <td>\n                        <xsl:text>No records found</xsl:text>\n                     </td>\n                  </xsl:otherwise>\n                </xsl:choose>\n                \n                </tr>\n                <xsl:for-each select=\"ns:value[node()]\">\n                <xsl:variable name=\"tempToken\" select=\"descendant::node()[local-name()='token']\"/>\n                <xsl:variable name=\"tempClient\" select=\"descendant::node()[local-name()='client_key']\"/>\n                <xsl:variable name=\"tempOwner\" select=\"descendant::node()[local-name()='resource_owner']\"/>\n                <xsl:variable name=\"tempStatus\" select=\"descendant::node()[local-name()='status']\"/>\n                <tr>\n                <td>\n                <xsl:value-of select=\"@index+number($offset)\"/>\n                </td>\n                <xsl:for-each select=\"descendant::node()[not(name()='')]\">\n                <td>\n                <xsl:value-of select=\"text()\"/>\n                </td>\n                </xsl:for-each>\n                <td>\n                <form action=\"{$this.app.url}?state=revoke\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmRevoke('{$tempOwner}', '{$tempClient}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"Revoke\">Revoke</button>\n                </form>\n                </td>\n                <td>\n                <form action=\"{$this.app.url}?state=toggleStatus\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmStatusChange('{$tempToken}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <xsl:choose>\n                <xsl:when test=\"$tempStatus = 'ENABLED'\">\n                <input name=\"newStatus\" type=\"hidden\" value=\"DISABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"DISABLE\">DISABLE</button>\n                </xsl:when>\n                <xsl:otherwise>\n                <input name=\"newStatus\" type=\"hidden\" value=\"ENABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"ENABLE\">ENABLE</button>\n                </xsl:otherwise>\n                </xsl:choose>\n                </form>\n                </td>\n                </tr>\n                </xsl:for-each>\n                </table>\n                </xsl:template>\n\n                </xsl:stylesheet>]]></L7p:Document>\n                            </L7p:ResourceInfo>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:TransformName stringValue=\"\"/>\n                            <L7p:XsltVersion stringValue=\"1.0\"/>\n                        </L7p:XslTransformation>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                            <L7p:VariableToSet stringValue=\"toBeReturned\"/>\n                        </L7p:SetVariable>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"3ae5d6fb-94ac-4fb3-a798-b76258b0b265\"/>\n                            <L7p:PolicyName stringValue=\"oauth manager dates tokens\"/>\n                        </L7p:Include>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${count}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"int\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"GT\"/>\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icGFnaW5hdGlvbiI+DQogICAgPHNwYW4gY2xhc3M9InByZXYtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkUHJldlRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIDxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcnJvdy1sZWZ0Ij48L2k+IFByZXYNCiAgICA8L3NwYW4+DQogICAgPHNwYW4gY2xhc3M9Im5leHQtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkTmV4dFRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIE5leHQgPGkgY2xhc3M9Imljb24tcG9ydGFsLWFycm93LXJpZ2h0Ij48L2k+DQogICAgPC9zcGFuPg0KPC9kaXY+\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                </L7p:SetVariable>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"==CHECK\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Count - only set navigation buttons (prev/next) if count > 0.  For empty result set, no pagination buttons are needed.\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"\"/>\n                                <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"PGRpdiBpZD0ibWFuYWdlVG9rZW5zUmVzdWx0Ij4NCiR7cGFnaW5hdGlvbkJ1dHRvbnN9CiR7dG9CZVJldHVybmVkfQ0KJHtwYWdpbmF0aW9uQnV0dG9uc30KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KaWYgKCR7eHBhdGhDb3VudC5yZXN1bHR9ID4gcmVzdWx0c1BlclBhZ2UpIHsNCiAgICB0b2dnbGVEaXNhYmxlZCgnbmV4dC1wYWdlLWxpbmsnLCBmYWxzZSk7DQp9DQo8L3NjcmlwdD4NCjwvZGl2Pg==\"/>\n                            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <L7p:HardcodedResponse>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    </L7p:HardcodedResponse>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Filter\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Branch after hitting the 'Search' button\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"manageOwnersClientsPagination\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"manageOwnersClientsPagination\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${offset}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"int\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"75862a66-03a9-485f-9c10-b5bd47afbd4a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Get (token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"${offsetValue}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${lookupUser}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterRefreshToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterAccessToken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.filterStatus}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                            <L7p:ContentType stringValue=\"text/xml; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"findDates\"/>\n                        </L7p:SetVariable>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathOffset\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/@offset\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathCount\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"count(/ns:values/ns:value)\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHt4cGF0aENvdW50LnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"count\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${count}\"/>\n                                    <L7p:Expression2 stringValue=\"0.0\"/>\n                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"0.0\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// edge-case, no results, do nothing\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"xpathCount\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"count(/ns:values/ns:value)+number($offset)\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                </L7p:ResponseXpathAssertion>\n                                <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"xpathTokens\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:values/ns:value/ns:token\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                </L7p:ResponseXpathAssertion>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${count}\"/>\n                                    <L7p:Expression2 stringValue=\"1.0\"/>\n                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"1.0\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Regex>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:CaptureVar stringValue=\"lastToken\"/>\n\n                                    <L7p:IncludeEntireExpressionCapture booleanValue=\"false\"/>\n\n                                    <L7p:OtherTargetMessageVariable stringValue=\"xpathTokens.results\"/>\n                                    <L7p:Regex stringValue=\"([^,]+)\\]$\"/>\n                                    <L7p:Replacement stringValue=\"\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                    </L7p:Regex>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// if only 1 token returned\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:Regex>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:CaptureVar stringValue=\"lastToken\"/>\n\n                                    <L7p:IncludeEntireExpressionCapture booleanValue=\"false\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"xpathTokens.results\"/>\n                                    <L7p:Regex stringValue=\",\\s*([^,]+)\\]$\"/>\n                                    <L7p:Replacement stringValue=\"\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                    </L7p:Regex>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// get the last token\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                                <L7p:XslTransformation>\n                                    <L7p:Direction intValue=\"-1\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                                    <L7p:ResourceInfo staticResourceInfo=\"included\">\n                                    <L7p:Document stringValueReference=\"inline\"><![CDATA[<xsl:stylesheet version=\"1.0\" xmlns:ns=\"http://ns.l7tech.com/2012/11/otk-tokenstore\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n\n                <xsl:output method=\"html\"/>\n\n                <xsl:param name=\"this.app.url\"/>\n                <xsl:param name=\"offset\"/>\n                <xsl:param name=\"synchToken\"/>\n\n                <xsl:template match=\"/ns:values\">\n                <table border=\"1\" id=\"tblResult\" style=\"padding:2px; empty-cells: show;\">\n                <tr style=\"background-color: rgb(216,216,216);\">\n                <xsl:choose>\n                <xsl:when test=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                <th>index</th>\n                <xsl:for-each select=\"ns:value[1][node()]/descendant::node()[not(name()='')]\">\n                <th>\n                <xsl:value-of select=\"name()\"/>\n                </th>\n                </xsl:for-each>\n                <th colspan=\"2\">action</th>\n                </xsl:when>\n                  <xsl:otherwise>\n                    <td>\n                        <xsl:text>No records found</xsl:text>\n                     </td>\n                  </xsl:otherwise>\n                </xsl:choose>\n                </tr>\n                <xsl:for-each select=\"ns:value[node()]\">\n                <xsl:variable name=\"tempToken\" select=\"descendant::node()[local-name()='token']\"/>\n                <xsl:variable name=\"tempClient\" select=\"descendant::node()[local-name()='client_key']\"/>\n                <xsl:variable name=\"tempOwner\" select=\"descendant::node()[local-name()='resource_owner']\"/>\n                <xsl:variable name=\"tempStatus\" select=\"descendant::node()[local-name()='status']\"/>\n                <tr>\n                <td>\n                <xsl:value-of select=\"@index+number($offset)\"/>\n                </td>\n                <xsl:for-each select=\"descendant::node()[not(name()='')]\">\n                <td>\n                <xsl:value-of select=\"text()\"/>\n                </td>\n                </xsl:for-each>\n                <td>\n                <form action=\"{$this.app.url}?state=revoke\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmRevoke('{$tempOwner}', '{$tempClient}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"Revoke\">Revoke</button>\n                </form>\n                </td>\n                <td>\n                <form action=\"{$this.app.url}?state=toggleStatus\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\" onsubmit=\"return confirmStatusChange('{$tempToken}')\">\n                <input name=\"token\" type=\"hidden\" value=\"{$tempToken}\"/>\n                <input name=\"synchToken\" type=\"hidden\" value=\"{$synchToken}\"/>\n                <xsl:choose>\n                <xsl:when test=\"$tempStatus = 'ENABLED'\">\n                <input name=\"newStatus\" type=\"hidden\" value=\"DISABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"DISABLE\">DISABLE</button>\n                </xsl:when>\n                <xsl:otherwise>\n                <input name=\"newStatus\" type=\"hidden\" value=\"ENABLED\"/>\n                <button class=\"btn btn-primary btn-mini\" type=\"submit\" value=\"ENABLE\">ENABLE</button>\n                </xsl:otherwise>\n                </xsl:choose>\n                </form>\n                </td>\n                </tr>\n                </xsl:for-each>\n                </table>\n                </xsl:template>\n\n                </xsl:stylesheet>]]></L7p:Document>\n                                    </L7p:ResourceInfo>\n                                    <L7p:Target target=\"OTHER\"/>\n                                    <L7p:TransformName stringValue=\"\"/>\n                                    <L7p:XsltVersion stringValue=\"1.0\"/>\n                                </L7p:XslTransformation>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"toBeReturned\"/>\n                                </L7p:SetVariable>\n                                <L7p:Include>\n                                    <L7p:PolicyGuid stringValue=\"3ae5d6fb-94ac-4fb3-a798-b76258b0b265\"/>\n                                    <L7p:PolicyName stringValue=\"oauth manager dates tokens\"/>\n                                </L7p:Include>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${count}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"int\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"GT\"/>\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${dbsystem}\"/>\n                                    <L7p:Expression2 stringValue=\"cassandra\"/>\n\n                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n\n                                    <L7p:RightValue stringValue=\"cassandra\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:SetVariable>\n\n                                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icGFnaW5hdGlvbiI+DQogICAgPHNwYW4gY2xhc3M9InByZXYtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkUHJldlRva2VuUGFnZUNhc3NhbmRyYSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHtsYXN0VG9rZW59JywgJHtjb3VudH0pOyI+DQogICAgICAgIDxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcnJvdy1sZWZ0Ij48L2k+IFByZXYNCiAgICA8L3NwYW4+DQogICAgPHNwYW4gY2xhc3M9Im5leHQtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkTmV4dFRva2VuUGFnZUNhc3NhbmRyYSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHtsYXN0VG9rZW59JywgJHtjb3VudH0pOyI+DQogICAgICAgIE5leHQgPGkgY2xhc3M9Imljb24tcG9ydGFsLWFycm93LXJpZ2h0Ij48L2k+DQogICAgPC9zcGFuPg0KPC9kaXY+\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"cassandra\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icGFnaW5hdGlvbiI+DQogICAgPHNwYW4gY2xhc3M9InByZXYtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkUHJldlRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIDxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcnJvdy1sZWZ0Ij48L2k+IFByZXYNCiAgICA8L3NwYW4+DQogICAgPHNwYW4gY2xhc3M9Im5leHQtcGFnZS1saW5rIGRpc2FibGVkIiBvbmNsaWNrPSJsb2FkTmV4dFRva2VuUGFnZSh0aGlzLCAnbWFuYWdlVG9rZW5zUmVzdWx0JywgJHtvZmZzZXR9LCAnJHt4cGF0aE9mZnNldC5yZXN1bHR9JywgJHt4cGF0aENvdW50LnJlc3VsdH0pOyI+DQogICAgICAgIE5leHQgPGkgY2xhc3M9Imljb24tcG9ydGFsLWFycm93LXJpZ2h0Ij48L2k+DQogICAgPC9zcGFuPg0KPC9kaXY+\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"cassandra or jdbc?\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:OneOrMore>\n                                    </wsp:All>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"\"/>\n                                    <L7p:VariableToSet stringValue=\"paginationButtons\"/>\n                                    </L7p:SetVariable>\n                                </wsp:OneOrMore>\n                                <L7p:HardcodedResponse>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:Base64ResponseBody stringValue=\"JHtwYWdpbmF0aW9uQnV0dG9uc30KJHt0b0JlUmV0dXJuZWR9DQoke3BhZ2luYXRpb25CdXR0b25zfQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQppZiAoJHt4cGF0aENvdW50LnJlc3VsdH0gPiAke29mZnNldH0gKyByZXN1bHRzUGVyUGFnZSkgew0KICAgIHRvZ2dsZURpc2FibGVkKCduZXh0LXBhZ2UtbGluaycsIGZhbHNlKTsNCn0NCmlmICgke29mZnNldH0gPiAwKSB7DQogICAgdG9nZ2xlRGlzYWJsZWQoJ3ByZXYtcGFnZS1saW5rJywgZmFsc2UpOw0KfQ0KPC9zY3JpcHQ+\"/>\n                                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                                </L7p:HardcodedResponse>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Update\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Update the existing table only. Do NOT create the full page\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                        </wsp:OneOrMore>\n                    </wsp:All>\n                    <L7p:HardcodedResponse>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxoMT5NYW5hZ2UgVG9rZW5zPC9oMT4NCjxwPlRoaXMgaXMgYW4gb3ZlcnZpZXcgb2YgYWxsIGNsaWVudHMgZ3JhbnRlZCBieSBhIHJlc291cmNlX293bmVyPC9wPg0KJHt3ZWJzaXRlX2JvdHRvbX0=\"/>\n                        <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    </L7p:HardcodedResponse>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Pagination\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Branch after hitting 'Load prev - next page'\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"revoke\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"revoke\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"fe24b7c2-9d8b-4af3-aade-d808d98ae208\"/>\n                    <L7p:PolicyName stringValue=\"#OTK Manager Token Revocation List\"/>\n                </L7p:Include>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"9185d43a-c025-4783-b013-12982929a19c\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Revocation\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"client_key\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"resource_owner\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"rtoken\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"token\"/>\n                            <L7p:value stringValue=\"${token}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxkaXY+DQo8aDE+UmV2b2tlIFRva2VuPC9oMT4NCjxwPlRoZSB0b2tlbiAnJHt0b2tlbn0nIHdhcyBzdWNjZXNzZnVsbHkgZGVsZXRlZCE8L3A+DQo8L2Rpdj4NCiR7d2Vic2l0ZV9ib3R0b219\"/>\n                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                </L7p:HardcodedResponse>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Revoke token\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"toggleStatus\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"toggleStatus\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"ad2f1960-9715-4b42-b623-74f1cd50be23\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Manager Token Update (token status)\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"token\"/>\n                            <L7p:value stringValue=\"${token}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"token_status\"/>\n                            <L7p:value stringValue=\"${request.http.parameter.newStatus}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxkaXY+DQo8aDE+VXBkYXRlIFRva2VuPC9oMT4NCjxwPlRoZSB0b2tlbiAnJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRva2VufScgaGFzIHN1Y2Nlc3NmdWxseSBiZWVuIHVwZGF0ZWQgdG8gc3RhdHVzICcke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIubmV3U3RhdHVzfSchPC9wPg0KPC9kaXY+DQoke3dlYnNpdGVfYm90dG9tfQ==\"/>\n                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                </L7p:HardcodedResponse>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Update token status\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"===Unknown state or authentication error==\"/>\n            </L7p:CommentAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${error.code}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"MDAw\"/>\n                        <L7p:VariableToSet stringValue=\"error.code\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error.code\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error code message\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                            <L7p:VariableToSet stringValue=\"error.msg\"/>\n                        </L7p:SetVariable>\n                    </wsp:OneOrMore>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error.msg\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                    <L7p:VariableToSet stringValue=\"erro.msg\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:AuditDetailAssertion>\n                    <L7p:Detail stringValue=\"error.code: '${error.code}', error.msg: ${error.msg}\"/>\n                </L7p:AuditDetailAssertion>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"create an error response\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"tasks\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}