{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fea4e",
  "guid": "864e10ee-cc48-414e-b5b8-8f3b1a0d564a",
  "name": "oauth/manager",
  "resolutionPath": "/oauth/manager",
  "serviceType": "WEB_API",
  "checksum": "7660774b53fbf112a2f4a6b0350e50101a850ff9",
  "enabled": true,
  "folderPath": "/OTK/Server/Internal/Tools/OAuth Manager",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== *** THIS POLICY IS OVERWRITTEN DURING AN UPGRADE ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Be aware that custom configuration made in this policy is overwritten during a solution kit upgrade.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== However, the older version of the policy is kept in the history and can be referenced.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== After upgrade, manually merge customizations from the old version of the policy to the new version.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Implementation of a simple oauth manager that uses API calls to access the client- and tokenstore\"/>\n        </L7p:CommentAssertion>\n        <L7p:CustomizeErrorResponse>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"HTML\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Content stringValueReference=\"inline\"><![CDATA[${website_top}\n                <div>\n                <h1>Error</h1>\n                <code>\n                ${error.msg}\n                </code>\n                </div>\n                <p>Please try again. If the error occurs again please click <a href=\"${this.app.url.login}\">here</a> to login again.</p>\n                <p>If the error still occurs please contact the system administrator.</p>\n                ${website_bottom}]]></L7p:Content>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"x-ca-err\"/>\n                    <L7p:Value stringValue=\"${error.code}\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n            <L7p:PolicyName stringValue=\"OTK Security Header Extension\"/>\n        </L7p:Include>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:AddHeader>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"HTTPS only\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Inform the browser to only accept SSL connections\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:HeaderName stringValue=\"Content-Security-Policy\"/>\n                <L7p:HeaderValue stringValue=\"default-src 'self'; script-src  ajax.googleapis.com 'unsafe-inline'; img-src * data:; style-src 'unsafe-inline'; font-src * data:; object-src 'none';\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override OTK Security Header Extension\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden when user logs in or if a cookie is available\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"current.username\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overridden when user is looking up values of a different user\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"lookupUser\"/>\n        </L7p:SetVariable>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"054e5792-882a-4d7c-8294-5b2f6bee588b\"/>\n                <L7p:PolicyName stringValue=\"oauth manager website brand logo\"/>\n            </L7p:Include>\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"02dfa7fb-807f-4e55-a4d1-7a942b7fbc9f\"/>\n                <L7p:PolicyName stringValue=\"oauth manager config\"/>\n            </L7p:Include>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHtpbmNsdWRlX2pxdWVyeV9zY3JpcHR9DQoNCi8qIHRvZ2dsaW5nIGJsb2NrcyBhbmQgZHJvcGRvd25zICovDQpmdW5jdGlvbiBhY3RpdmF0ZVRvZ2dsZUJsb2NrcygpIHsNCiAgICBpZiAodHlwZW9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwgPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICB2YXIgdG9nZ2xlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2dnbGUnKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IHRvZ2dsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgICAgIHZhciB0b2dnbGUgPSB0b2dnbGVzW2ldOw0KICAgICAgICAgICAgdmFyIGxpbmsgPSB0b2dnbGUucXVlcnlTZWxlY3RvckFsbCgnLnRvZ2dsZS1saW5rJylbMF07DQogICAgICAgICAgICBsaW5rLnRvZ2dsZSA9IHRvZ2dsZTsNCiAgICAgICAgICAgIGxpbmsub25jbGljayA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICB2YXIgdG9nZ2xlID0gdGhpcy50b2dnbGU7DQogICAgICAgICAgICAgICAgaWYgKHRvZ2dsZS5jbGFzc05hbWUuc2VhcmNoKCdvcGVuJykgPiAtMSkgew0KICAgICAgICAgICAgICAgICAgICB0b2dnbGUuY2xhc3NOYW1lID0gdG9nZ2xlLmNsYXNzTmFtZS5yZXBsYWNlKC8gb3Blbi8sICcnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5jbGFzc05hbWUgKz0gJyBvcGVuJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQo8L3NjcmlwdD4=\"/>\n                <L7p:VariableToSet stringValue=\"js\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KICAgIDx0aXRsZT4ke3RoaXMuYXBwLm5hbWV9PC90aXRsZT4NCiAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIvPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9OCxJRT05LElFPTEwLElFPTExLGNocm9tZT0xIiAvPg0KICAgICR7Y3NzfQ0KICAgICR7anN9DQo8L2hlYWQ+DQoNCjxib2R5Pg0KICAgIDxkaXY+DQogICAgICAgIDxkaXYgY2xhc3M9Im5hdmJhciI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXItZmx1aWQiPg0KICAgICAgICAgICAgICAgICR7YnJhbmRMb2dvfQ0KICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaXRlIiBocmVmPSIke3RoaXMuYXBwLnVybH0/c3RhdGU9aW5pdCI+JHt0aGlzLmFwcC5uYW1lfTwvYT4NCjwhLS1MT0dHRURfSU5fVVNFUl9ESVYtLT4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4NCjwhLS1MT0dHRURfSU5fTkFWX0RJVi0tPg==\"/>\n                <L7p:VariableToSet stringValue=\"website_top\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icm93LWZsdWlkIHBvcnRhbC1mb290ZXIiPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYW4xMiI+DQogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJwb3J0YWwtY29weXJpZ2h0Ij7CqSAyMDIwIEJyb2FkY29tLiBBbGwgUmlnaHRzIFJlc2VydmVkLiBUaGUgdGVybSAnQnJvYWRjb20nIHJlZmVycyB0byBCcm9hZGNvbSBJbmMuIGFuZC9vciBpdHMgc3Vic2lkaWFyaWVzLjwvcD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgICAgIGFjdGl2YXRlVG9nZ2xlQmxvY2tzKCk7DQogICAgPC9zY3JpcHQ+DQo8L2JvZHk+DQo8L2h0bWw+\"/>\n                <L7p:VariableToSet stringValue=\"website_bottom\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxwPkFuIGVycm9yIG9jY3VyZWQuIFBsZWFzZSBsb2dpbiBhZ2FpbiBhbmQgb3IgY29udGFjdCB5b3VyIGFkbWluaXN0cmF0b3IuPC9wPg0KPHA+PGEgaHJlZj0iJHt0aGlzLmFwcC51cmx9Ij5Mb2dpbjwvYT48L3A+DQoke3dlYnNpdGVfYm90dG9tfQ==\"/>\n                <L7p:VariableToSet stringValue=\"website_error\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"web content\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Configure the manager here\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"47f768f4-b478-472b-a1ee-10f4b6e76f99\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require SSL (with Client Certificate)\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireClientCert\"/>\n                        <L7p:value stringValue=\"false\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"require SSL\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override content-type with text/html\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lm1haW5wYXJ0fSR7cmVxdWVzdC51cmx9\"/>\n                    <L7p:VariableToSet stringValue=\"requestUrl\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2be8eaf2-9b42-4173-ace9-3fdb471fb407\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"API XSS Protection\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allinput\"/>\n                            <L7p:value stringValue=\"${request.mainpart}${request.url}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:Regex>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Extra check for quotes/brackets\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:CaseInsensitive booleanValue=\"true\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"request.url\"/>\n                    <L7p:ProceedIfPatternMatches booleanValue=\"false\"/>\n                    <L7p:Regex stringValue=\"(%22|[&quot;]|%29|\\(|%28|\\))\"/>\n                    <L7p:RegexName stringValue=\"Validate URL input\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"json response\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"return json error response\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"error.content\"/>\n                            <L7p:value stringValue=\"${error.msg}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"new.content\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"other\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"task\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:FalseAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"return false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"stop processing the whole policy\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                </L7p:FalseAssertion>\n            </wsp:All>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${state}\"/>\n                <L7p:Expression2 stringValue=\"login\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"login\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"3d18cfd8-631f-48f1-b154-c11b85df2fb9\"/>\n                    <L7p:PolicyName stringValue=\"oauth manager validate cookie\"/>\n                </L7p:Include>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"21da0471-733a-47d1-a8e0-07384a10cc58\"/>\n                    <L7p:PolicyName stringValue=\"oauth manager set valid user\"/>\n                </L7p:Include>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PHVsIGNsYXNzPSJ1c2VyLW1lbnUgcHVsbC1yaWdodCI+DQogICAgPGxpIGNsYXNzPSJ0b2dnbGUgZHJvcGRvd24iPg0KICAgICAgICA8c3BhbiBjbGFzcz0idG9nZ2xlLWxpbmsiPg0KICAgICAgICAgICAgJHtjdXJyZW50LnVzZXJuYW1lfSA8YiBjbGFzcz0iY2FyZXQiPjwvYj4NCiAgICAgICAgPC9zcGFuPg0KICAgICAgICA8dWwgY2xhc3M9InRvZ2dsZS1ibG9jayI+DQogICAgICAgICAgICA8bGk+PGZvcm0gYWN0aW9uPSIke3RoaXMuYXBwLnVybH0/c3RhdGU9bG9nb3V0IiBtZXRob2Q9IlBPU1QiIGVuY3R5cGU9ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIgaWQ9ImxvZ291dEZvcm0iPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IG5hbWU9InN5bmNoVG9rZW4iIHR5cGU9ImhpZGRlbiIgdmFsdWU9IiR7c3luY2hUb2tlbn0iIC8+DQogICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW1lZGl1bSIgaWQ9ImxvZ291dEJ1dHRvbiIgdHlwZT0ic3VibWl0IiB2YWx1ZT0ibG9nb3V0Ij5Mb2dvdXQ8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L2Zvcm0+DQoJCQk8L2xpPg0KICAgICAgICA8L3VsPg0KICAgIDwvbGk+DQo8L3VsPg==\"/>\n                    <L7p:VariableToSet stringValue=\"loggedinDiv\"/>\n                </L7p:SetVariable>\n                <L7p:Regex>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"website_top\"/>\n                    <L7p:Regex stringValue=\"&lt;!--LOGGED_IN_USER_DIV-->\"/>\n                    <L7p:Replace booleanValue=\"true\"/>\n                    <L7p:Replacement stringValue=\"${loggedinDiv}\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0icm93LWZsdWlkIj4NCiAgICA8ZGl2IGlkPSJuYXYiPg0KICAgICAgICA8dWwgY2xhc3M9ImlubGluZSI+DQogICAgICAgICAgICA8bGkgaWQ9Im5hdi1ob21lIj48YSBocmVmPSI/c3RhdGU9aW5pdCI+PGkgY2xhc3M9Imljb24tcG9ydGFsLWhvbWUiPjwvaT48YnIgLz5Ib21lPC9hPjwvbGk+DQogICAgICAgICAgICA8bGkgaWQ9Im5hdi1jbGllbnRzIj48YSBocmVmPSJtYW5hZ2VyL2NsaWVudHM/c3RhdGU9bWFuYWdlQ2xpZW50cyZsb29rdXBVc2VyPSR7bG9va3VwVXNlcn0iPjxpIGNsYXNzPSJpY29uLXBvcnRhbC11c2VycyI+PC9pPjxiciAvPkNsaWVudHM8L2E+PC9saT4NCiAgICAgICAgICAgIDxsaSBpZD0ibmF2LXRva2VucyI+PGEgaHJlZj0ibWFuYWdlci90b2tlbnM/c3RhdGU9bWFuYWdlT3duZXJzQ2xpZW50cyZsb29rdXBVc2VyPSR7bG9va3VwVXNlcn0iPjxpIGNsYXNzPSJpY29uLXBvcnRhbC1hcHBsaWNhdGlvbnMiPjwvaT48YnIgLz5Ub2tlbnM8L2E+PC9saT4NCiAgICAgICAgPC91bD4NCiAgICAgICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgICAgICAgICAgdmFyIHN0YXRlQXJyYXkgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL3N0YXRlPShbXiZdKykvKTsNCiAgICAgICAgICAgIHZhciBjdXJyZW50TWVudUl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2LWhvbWUnKTsNCiAgICAgICAgICAgIGlmIChzdGF0ZUFycmF5ICYmIHN0YXRlQXJyYXkubGVuZ3RoICYmIHN0YXRlQXJyYXkubGVuZ3RoID49IDIpIHsNCiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBzdGF0ZUFycmF5WzFdOw0KICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlQ2xpZW50cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFnZUNsaWVudHNGaWx0ZXInOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdyZWdpc3Rlcic6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlZ2lzdGVyZWQnOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVDbGllbnQnOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICdlZGl0Q2xpZW50JzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlQ2xpZW50JzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xpZW50S2V5cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Jldm9rZUtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FkZEtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2tleUFkZGVkJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZWRpdEtleSc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2tleUVkaXRlZCc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVUb2tlbnMnOg0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1lbnVJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdi1jbGllbnRzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlT3duZXJzQ2xpZW50cyc6DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbmFnZU93bmVyc0NsaWVudHNQYWdpbmF0aW9uJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWFuYWdlVG9rZW5zRmlsdGVyJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmV2b2tlJzoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAndG9nZ2xlU3RhdHVzJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNZW51SXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtdG9rZW5zJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ICAgICAgICAgICAgIA0KICAgICAgICAgICAgY3VycmVudE1lbnVJdGVtLmNsYXNzTmFtZSA9ICdhY3RpdmUnOw0KICAgICAgICA8L3NjcmlwdD4NCiAgICA8L2Rpdj4NCjwvZGl2Pg==\"/>\n                    <L7p:VariableToSet stringValue=\"loggedInNavDiv\"/>\n                </L7p:SetVariable>\n                <L7p:Regex>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"website_top\"/>\n                    <L7p:Regex stringValue=\"&lt;!--LOGGED_IN_NAV_DIV-->\"/>\n                    <L7p:Replace booleanValue=\"true\"/>\n                    <L7p:Replacement stringValue=\"${loggedinNavDiv}\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PHVzZXJzZXNzaW9uPg0KIDx1c2VyPjwhW0NEQVRBWyR7Y3VycmVudC51c2VybmFtZX1dXT48L3VzZXI+DQogPHJvbGU+PCFbQ0RBVEFbJHtjdXJyZW50LnVzZXIucm9sZX1dXT48L3JvbGU+DQogPGxvb2t1cFVzZXI+PCFbQ0RBVEFbJHtsb29rdXBVc2VyfV1dPjwvbG9va3VwVXNlcj4NCiA8c3luY2hUb2tlbj48IVtDREFUQVske3hwYXRoU3luY2hUb2tlbi5yZXN1bHR9XV0+PC9zeW5jaFRva2VuPg0KPC91c2Vyc2Vzc2lvbj4=\"/>\n                    <L7p:VariableToSet stringValue=\"userSession\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"${cacheName}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${sessionID}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${userSession}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:VariableToSet stringValue=\"state\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Session\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Use an existing session\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${current.username}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n            </L7p:Include>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"overwrite content-type\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// apply rate limit\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"=== As of here: session handling tasks\"/>\n            </L7p:CommentAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"login\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"login\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"27196c5d-a37a-4ee3-a24a-01615c2e1bb1\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK User Authentication\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"acrValuesRequested\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"authHeader\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"authIdToken\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"authSession\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"clientId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cookie\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cookiename\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"maxAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"oauth_token\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"oauth_verifier\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"password\"/>\n                            <L7p:value stringValue=\"${request.http.parameter.password}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"prompt\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"provider\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"state\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"username\"/>\n                            <L7p:value stringValue=\"${request.http.parameter.username}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                    <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                </L7p:Include>\n                <L7p:UUIDGenerator>\n                    <L7p:MaximumQuantity intValue=\"2\"/>\n                    <L7p:Quantity stringValue=\"2\"/>\n                    <L7p:TargetVariable stringValue=\"sessionID\"/>\n                </L7p:UUIDGenerator>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PHVzZXJzZXNzaW9uPg0KIDx1c2VyPjwhW0NEQVRBWyR7Y3VycmVudC51c2VybmFtZX1dXT48L3VzZXI+DQogPHJvbGU+PCFbQ0RBVEFbJHtjdXJyZW50LnVzZXIucm9sZX1dXT48L3JvbGU+DQogPGxvb2t1cFVzZXI+PCFbQ0RBVEFbJHtsb29rdXBVc2VyfV1dPjwvbG9va3VwVXNlcj4NCiA8c3luY2hUb2tlbj48IVtDREFUQVske3Nlc3Npb25JRFsxXX1dXT48L3N5bmNoVG9rZW4+DQo8L3VzZXJzZXNzaW9uPg==\"/>\n                    <L7p:VariableToSet stringValue=\"userSession\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"${cacheName}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${sessionID[0]}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${userSession}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:DataType variableDataType=\"dateTime\"/>\n                    <L7p:DateOffsetExpression stringValue=\"${session.lifetime.s}\"/>\n                    <L7p:VariableToSet stringValue=\"expiration\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uSURbMF19fCR7ZXhwaXJhdGlvbi5zZWNvbmRzfXw=\"/>\n                    <L7p:VariableToSet stringValue=\"cookieContent\"/>\n                </L7p:SetVariable>\n                <L7p:GenerateSecurityHash>\n                    <L7p:Base64Data stringValue=\"JHtjb29raWVDb250ZW50fQ==\"/>\n                    <L7p:KeyText stringValue=\"${cookieKey}\"/>\n                    <L7p:LineBreak lineBreak=\"CR-LF\"/>\n                    <L7p:TargetOutputVariable stringValue=\"actualHash\"/>\n                </L7p:GenerateSecurityHash>\n                <L7p:Regex>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"actualHash\"/>\n                    <L7p:Regex stringValue=\"[ =+/]\"/>\n                    <L7p:Replace booleanValue=\"true\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjb29raWVDb250ZW50fSR7YWN0dWFsSGFzaH0=\"/>\n                    <L7p:VariableToSet stringValue=\"cookieContent\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"cookieContent\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"cookieContent\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"302\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    <L7p:ResponseStatus stringValue=\"302\"/>\n                </L7p:HardcodedResponse>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                    <L7p:HeaderValue stringValue=\"${cookieName}=${cookieContent}; Path=/; Secure; HttpOnly\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Location\"/>\n                    <L7p:HeaderValue stringValue=\"${this.app.url}?state=init\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Authenticate\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"logout\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"logout\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"${cacheName}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${sessionID}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"302\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    <L7p:ResponseStatus stringValue=\"302\"/>\n                </L7p:HardcodedResponse>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                    <L7p:HeaderValue stringValue=\"${cookieName}=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Path=/; Secure; HttpOnly\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Location\"/>\n                    <L7p:HeaderValue stringValue=\"${this.app.url}\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Pragma\"/>\n                    <L7p:HeaderValue stringValue=\"no-store\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                    <L7p:HeaderValue stringValue=\"no-cache\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Logout\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${state}\"/>\n                    <L7p:Expression2 stringValue=\"init\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"init\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxoMT5PQXV0aCBNYW5hZ2VyPC9oMT4NCjxwPlRoaXMgbWFuYWdlbWVudCBhcHBsaWNhdGlvbiBpcyBhIHNpbXBsZSB0b29sIHRvIG1hbmFnZSBjbGllbnQgYXBwbGljYXRpb25zIGFuZCBncmFudGVkIHJlc291cmNlIG93bmVyL2NsaWVudCBjb21iaW5hdGlvbnM8L3A+DQoke3dlYnNpdGVfYm90dG9tfQ==\"/>\n                    <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                </L7p:HardcodedResponse>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Init\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${sessionID}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheAge\"/>\n                                <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheId\"/>\n                                <L7p:value stringValue=\"${cacheName}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheKey\"/>\n                                <L7p:value stringValue=\"${sessionID}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheMaxSize\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${state}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:HardcodedResponse>\n                            <L7p:Base64ResponseBody stringValue=\"JHt3ZWJzaXRlX3RvcH0NCjxmb3JtIGFjdGlvbj0iJHt0aGlzLmFwcC51cmx9IiBtZXRob2Q9IlBPU1QiIGNsYXNzPSJmb3JtLWJvZHkgZm9ybS1sb2dpbiI+DQogIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIiB2YWx1ZT0ibG9naW4iLz4NCiAgICAgICAgICAgIDxsZWdlbmQ+RW50ZXIgWW91ciBVc2VybmFtZSAmYW1wOyBQYXNzd29yZDwvbGVnZW5kPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+DQogICAgICAgICAgICAgIDxsYWJlbD5Vc2VybmFtZSAqPC9sYWJlbD4NCiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzZXJuYW1lIiBhdXRvY29tcGxldGU9Im9mZiIgY2xhc3M9ImlucHV0LWJsb2NrIj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+DQogICAgICAgICAgICAgIDxsYWJlbD5QYXNzd29yZCAqPC9sYWJlbD4NCiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzd29yZCIgYXV0b2NvbXBsZXRlPSJvZmYiIGNsYXNzPSJpbnB1dC1ibG9jayI+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdy1mbHVpZCI+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYW4xMiI+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgcHVsbC1yaWdodCI+TG9naW48L2J1dHRvbj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCjwvZm9ybT4NCiR7d2Vic2l0ZV9ib3R0b219\"/>\n                            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                <L7p:VariableToSet stringValue=\"error.code\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error code message\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                                    <L7p:VariableToSet stringValue=\"error.msg\"/>\n                                </L7p:SetVariable>\n                            </wsp:OneOrMore>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.msg\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                            <L7p:VariableToSet stringValue=\"erro.msg\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                            <L7p:VariableToSet stringValue=\"content-type\"/>\n                        </L7p:SetVariable>\n                        <L7p:AuditDetailAssertion>\n                            <L7p:Detail stringValue=\"error.code: '${error.code}', error.msg: ${error.msg}\"/>\n                        </L7p:AuditDetailAssertion>\n                        <L7p:FalseAssertion/>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"create an error response\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                    <L7p:HeaderValue stringValue=\"${cookieName}=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Path=/; Secure; HttpOnly\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:Enabled booleanValue=\"false\"/>\n                    <L7p:HeaderName stringValue=\"Pragma\"/>\n                    <L7p:HeaderValue stringValue=\"no-store\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:Enabled booleanValue=\"false\"/>\n                    <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                    <L7p:HeaderValue stringValue=\"no-cache\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Initial call\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"tasks\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}