{
  "goid": "eab1480dec35beb44d21577d5773aa35",
  "guid": "b7cf6a44-386c-40f8-ba22-24fbe5ce1926",
  "name": "v2GenerateAuthHeaderForClient",
  "policyType": "FRAGMENT",
  "checksum": "be0ff1520fe786f92a458503ab2cfcad04dc6d76",
  "folderPath": "/OTK/Server/Internal/Tools/OAuth 2.0 Test Clients/configuration",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Generates Authorization Header\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Inputs: token, target_url, target_http_method\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Outputs: authorization_header\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"bGF5ZXI3\"/>\n            <L7p:VariableToSet stringValue=\"ext\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Regex>\n                <L7p:AutoTarget booleanValue=\"false\"/>\n                <L7p:CaptureVar stringValue=\"at\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                <L7p:Regex stringValue=\"\\&quot;access_token\\&quot;\\s*\\:\\s*\\&quot;([^&quot;]*)\\&quot;\"/>\n                <L7p:RegexName stringValue=\"isolate the access token itself\"/>\n                <L7p:Replacement stringValue=\"\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:Regex>\n            <L7p:Regex>\n                <L7p:AutoTarget booleanValue=\"false\"/>\n                <L7p:CaptureVar stringValue=\"at\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                <L7p:Regex stringValue=\"access_token\\=([^&amp;]*)\"/>\n                <L7p:RegexName stringValue=\"isolate the access token itself - for implicit grant_type\"/>\n                <L7p:Replacement stringValue=\"\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:Regex>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHthdFsxXX0=\"/>\n            <L7p:VariableToSet stringValue=\"access_token\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Regex>\n                <L7p:AutoTarget booleanValue=\"false\"/>\n                <L7p:CaptureVar stringValue=\"token_type\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                <L7p:Regex stringValue=\"\\&quot;token_type\\&quot;\\s*\\:\\s*\\&quot;([^&quot;]*)\\&quot;\"/>\n                <L7p:RegexName stringValue=\"isolate token type\"/>\n                <L7p:Replacement stringValue=\"\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:Regex>\n            <L7p:Regex>\n                <L7p:AutoTarget booleanValue=\"false\"/>\n                <L7p:CaptureVar stringValue=\"token_type\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                <L7p:Regex stringValue=\"token_type\\=([^&amp;]*)\"/>\n                <L7p:RegexName stringValue=\"isolate token type - for implicit grant_type\"/>\n                <L7p:Replacement stringValue=\"\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:Regex>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${token_type[1]}\"/>\n                    <L7p:Expression2 stringValue=\"Bearer\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"Bearer\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"QmVhcmVyICR7YWNjZXNzX3Rva2VufQ==\"/>\n                    <L7p:VariableToSet stringValue=\"authorization_header\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"token_type=Bearer\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${token_type[1]}\"/>\n                    <L7p:Expression2 stringValue=\"mac\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"mac\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtnYXRld2F5LnRpbWUuc2Vjb25kc30=\"/>\n                    <L7p:VariableToSet stringValue=\"timestamp_sec\"/>\n                </L7p:SetVariable>\n                <L7p:UUIDGenerator>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Generate nonce\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:TargetVariable stringValue=\"nonce\"/>\n                </L7p:UUIDGenerator>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHt0YXJnZXRfaHR0cF9tZXRob2R9\"/>\n                    <L7p:VariableToSet stringValue=\"http_method\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHt0YXJnZXRfdXJsfQ==\"/>\n                    <L7p:VariableToSet stringValue=\"url\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:CaptureVar stringValue=\"mk\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                        <L7p:Regex stringValue=\"\\&quot;mac_key\\&quot;\\s*\\:\\s*\\&quot;([^&quot;]*)\\&quot;\"/>\n                        <L7p:RegexName stringValue=\"isolate mac key\"/>\n                        <L7p:Replacement stringValue=\"\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:CaptureVar stringValue=\"mk\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                        <L7p:Regex stringValue=\"mac_key\\=([^&amp;]*)\"/>\n                        <L7p:RegexName stringValue=\"isolate mac key - for implicit grant_type\"/>\n                        <L7p:Replacement stringValue=\"\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                </wsp:OneOrMore>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtta1sxXX0=\"/>\n                    <L7p:VariableToSet stringValue=\"mac_key\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:CaptureVar stringValue=\"ma\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                        <L7p:Regex stringValue=\"\\&quot;mac_algorithm\\&quot;\\s*\\:\\s*\\&quot;([^&quot;]*)\\&quot;\"/>\n                        <L7p:RegexName stringValue=\"isolate mac algorithm\"/>\n                        <L7p:Replacement stringValue=\"\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                    <L7p:Regex>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:CaptureVar stringValue=\"ma\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"token\"/>\n                        <L7p:Regex stringValue=\"mac_algorithm\\=([^&amp;]*)\"/>\n                        <L7p:RegexName stringValue=\"isolate mac algorithm - for implicit grant_type\"/>\n                        <L7p:Replacement stringValue=\"\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                </wsp:OneOrMore>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHttYVsxXX0=\"/>\n                    <L7p:VariableToSet stringValue=\"mac_algorithm\"/>\n                </L7p:SetVariable>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"31b00c3c-a333-4e44-8e00-6bfd51b974a8\"/>\n                </L7p:Include>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${ext}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"TUFDIGlkPSIke2FjY2Vzc190b2tlbn0iLCB0cz0iJHt0aW1lc3RhbXBfc2VjfSIsIG5vbmNlPSIke25vbmNlfSIsIGV4dD0iJHtleHR9IiwgbWFjPSIke21hY30i\"/>\n                            <L7p:VariableToSet stringValue=\"authorization_header\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${ext}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"TUFDIGlkPSIke2FjY2Vzc190b2tlbn0iLCB0cz0iJHt0aW1lc3RhbXBfc2VjfSIsIG5vbmNlPSIke25vbmNlfSIsIG1hYz0iJHttYWN9Ig==\"/>\n                            <L7p:VariableToSet stringValue=\"authorization_header\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Build Authorization Header\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"token_type=mac\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:VariableToSet stringValue=\"authorization_header\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Invalid token_type\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n        </wsp:OneOrMore>\n        <L7p:ExportVariables>\n            <L7p:ExportedVars stringArrayValue=\"included\">\n                <L7p:item stringValue=\"authorization_header\"/>\n            </L7p:ExportedVars>\n        </L7p:ExportVariables>\n    </wsp:All>\n</wsp:Policy>"
  }
}