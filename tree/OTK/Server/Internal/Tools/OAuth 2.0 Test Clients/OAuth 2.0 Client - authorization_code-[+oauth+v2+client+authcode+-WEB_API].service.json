{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fe62e",
  "guid": "563c9d3b-6164-4efe-bdb9-49e45d9cdf4e",
  "name": "OAuth 2.0 Client - authorization_code",
  "resolutionPath": "/oauth/v2/client/authcode*",
  "serviceType": "WEB_API",
  "checksum": "cdaea331a650ea1edf098fb55957052227a314e3",
  "enabled": true,
  "folderPath": "/OTK/Server/Internal/Tools/OAuth 2.0 Test Clients",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This is a test client for an OAuth 2 implementation using the authorization code grant type\"/>\n        </L7p:CommentAssertion>\n        <L7p:CustomizeErrorResponse>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"HTML\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Return HTML error response\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Content stringValueReference=\"inline\"><![CDATA[${htmlTemplateTop}\n\n<div id=\"content\">\n\n  <IFRAME id=myiframe src=\"\" style='display:none' frameborder=\"0\" scrolling=\"auto\">\n  </IFRAME>\n\n  <h1>Grant type: Authorization code</h1>\n  <div style=\"margin-bottom: 2em; border-bottom: 1px solid #ccc;\">\n    <h2>Current Access Token:</h2>\n    ${clearSessionForm}\n    <pre>\n${error.msg}\n    </pre>\n  </div>\n  <div style=\"margin-bottom: 2em;\">\n    <h2>Initiate new OAuth handshake</h2>\n    <form action=\"${location_authserver}\">\n      <input type=\"hidden\" name=\"response_type\"\n value=\"code\"/>\n      <input type=\"hidden\" name=\"client_id\" value=\"${oauth2_client_id}\"/>\n      <input type=\"hidden\" name=\"redirect_uri\"\n value=\"${redirect_uri}\"/>\n      <input type=\"hidden\" name=\"scope\"\n value=\"${oauth2_scope}\"/>\n      <input type=\"hidden\" name=\"state\"\n value=\"state_test\"/>\n      <button type=\"submit\" class=\"btn btn-primary btn-mini\" value=\"Initiate\">Initiate</button>\n    </form>\n\n  </div>\n  <div style=\"margin-bottom: 2em;\">\n    <h2>Refresh Current Access Token</h2>\n    <form action=\"${request.url.protocol}://${request.url.host}:${request.url.port}${request.url.path}\">\n      <input type=\"hidden\" name=\"action\"\n value=\"refresh\"/>\n      <button type=\"submit\" class=\"btn btn-primary btn-mini\" value=\"Refresh\">Refresh</button>\n    </form>\n  </div>\n  <div style=\"margin-bottom: 2em;\">\n    <h2>Call API Using Current Access Token</h2>\n    <form action=\"${request.url.protocol}://${request.url.host}:${request.url.port}${request.url.path}\">\n      <input type=\"hidden\" name=\"action\"\n value=\"callapi\"/>\n      <input type=\"hidden\" name=\"state\"\n value=\"state_test\"/>\n      Target: <input type=\"text\" name=\"target\" size=80 value=\"${location_resourceendpoint}\"/>\n      <button type=\"submit\" class=\"btn btn-primary btn-mini\" value=\"Call API\">Call API</button>\n    </form>\n    <pre>\n${apioutput}\n    </pre>\n  </div>\n</div>\n\n${htmlTemplateBottom}]]></L7p:Content>\n            <L7p:ContentType stringValue=\"text/html;charset=UTF-8\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"x-ca-err\"/>\n                    <L7p:Value stringValue=\"${error.code}\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:SslAssertion/>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n            <L7p:PolicyName stringValue=\"OTK Security Header Extension\"/>\n        </L7p:Include>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:AddHeader>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"HTTPS only\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Inform the browser to only accept SSL connections\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:HeaderName stringValue=\"Content-Security-Policy\"/>\n                <L7p:HeaderValue stringValue=\"default-src 'self'; script-src 'unsafe-inline'; img-src * data:; style-src 'unsafe-inline'; font-src * data:; require-trusted-types-for 'script'; object-src 'none';\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override OTK Security Header Extension\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"51740c0b-11c5-455e-92a0-a1f915264eb0\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client Context Variables\"/>\n        </L7p:Encapsulated>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"apioutput\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"YXV0aGNvZGU=\"/>\n            <L7p:VariableToSet stringValue=\"client_page\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"cacheKey\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjdGlvbn0=\"/>\n            <L7p:VariableToSet stringValue=\"action\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNvZGV9\"/>\n            <L7p:VariableToSet stringValue=\"code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmVycm9yfQ==\"/>\n            <L7p:VariableToSet stringValue=\"error\"/>\n        </L7p:SetVariable>\n        <L7p:Encapsulated>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"return false if the XSS tag is found\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2be8eaf2-9b42-4173-ace9-3fdb471fb407\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"API XSS Protection\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"allinput\"/>\n                    <L7p:value stringValue=\"${request.mainpart}${request.url}\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CookieCredentialSource>\n                    <L7p:CookieName stringValue=\"l7otk2client\"/>\n                </L7p:CookieCredentialSource>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${cookie.l7otk2client}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjb29raWUubDdvdGsyY2xpZW50fQ==\"/>\n                    <L7p:VariableToSet stringValue=\"cacheKey\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"check cookie\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:TrueAssertion>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"none\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n            </L7p:TrueAssertion>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"get current token session id\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKey}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:ResponseXpathAssertion>\n                    <L7p:VariablePrefix stringValue=\"sessionValue\"/>\n                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ns\"/>\n                                <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                        <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                    </L7p:XpathExpression>\n                </L7p:ResponseXpathAssertion>\n                <L7p:ResponseXpathAssertion>\n                    <L7p:VariablePrefix stringValue=\"sessionLocation\"/>\n                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"/ns:found/ns:location/text()\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ns\"/>\n                                <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                        <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                    </L7p:XpathExpression>\n                </L7p:ResponseXpathAssertion>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"sessionValue.result\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"decoded\"/>\n                    <L7p:TransformType transformType=\"URL_DECODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtkZWNvZGVkfQ0KDQpUaGUgYWNjZXNzIHRva2VuIHdhcyByZXRyaWV2ZWQgZnJvbSAke3Nlc3Npb25Mb2NhdGlvbi5yZXN1bHR9Lg==\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiPg0KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiIgdmFsdWU9ImNsZWFyU2Vzc2lvbiIvPg0KICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiI+Q2xlYXIgU2Vzc2lvbjwvYnV0dG9uPg0KPC9mb3JtPg0KPGJyIC8+\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:TrueAssertion>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"not found or no cacheKey\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n            </L7p:TrueAssertion>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${clearSessionForm}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Negate booleanValue=\"true\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Negated booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AddHeader>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"clear cookie\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                <L7p:HeaderValue stringValue=\"l7otk2client=; Expires=Thu, 01-Jan-1970 00:00:01 GMT; Path=/; Secure; HttpOnly\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"callapi\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"callapi\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3Rva2VufQ==\"/>\n                    <L7p:VariableToSet stringValue=\"token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0=\"/>\n                    <L7p:VariableToSet stringValue=\"target_url\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"R0VU\"/>\n                    <L7p:VariableToSet stringValue=\"target_http_method\"/>\n                </L7p:SetVariable>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"b7cf6a44-386c-40f8-ba22-24fbe5ce1926\"/>\n                    <L7p:PolicyName stringValue=\"v2GenerateAuthHeaderForClient\"/>\n                </L7p:Include>\n                <L7p:HttpRoutingAssertion>\n                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                    <L7p:HttpMethod httpMethod=\"GET\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${target_url}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"${authorization_header}\"/>\n                                <L7p:Name stringValue=\"authorization\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\"/>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0=\"/>\n                    <L7p:VariableToSet stringValue=\"apioutput\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Call API\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${code}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_resource\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_resource\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Z3JhbnRfdHlwZT1hdXRob3JpemF0aW9uX2NvZGUmY29kZT0ke2NvZGV9JnJlZGlyZWN0X3VyaT0ke3JlZGlyZWN0X3VyaX0mY2xpZW50X2lkPSR7b2F1dGgyX2NsaWVudF9pZH0mY2xpZW50X3NlY3JldD0ke29hdXRoMl9jbGllbnRfc2VjcmV0fSZyZXNvdXJjZT0ke29hdXRoMl9yZXNvdXJjZX0=\"/>\n                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"postMsg\"/>\n                </L7p:SetVariable>\n                <L7p:HttpRoutingAssertion>\n                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                    <L7p:HttpMethod httpMethod=\"POST\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${location_tokenserver}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"application/xml\"/>\n                                <L7p:Name stringValue=\"accept\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestMsgSrc stringValue=\"postMsg\"/>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\"/>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkIGJ5IGNsaWVudCB2aWEgYSBjYWxsYmFjayB0byB0aGUgDQphdXRob3JpemF0aW9uIHNlcnZlciBiYXNlZCBvbiB0aGUgYXV0aG9yaXphdGlvbiBjb2RlIHZhbHVlIA0KcmV0dXJuZWQgKCR7Y29kZX0pIG9uIHRoZSByZWRpcmVjdGlvbg0KYmFjayBmcm9tIHRoZSBhdXRob3JpemF0aW9uIHNlcnZlci4=\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0=\"/>\n                    <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                </L7p:SetVariable>\n                <L7p:UUIDGenerator>\n                    <L7p:TargetVariable stringValue=\"tokenSessionId\"/>\n                </L7p:UUIDGenerator>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${tokenSessionId[0]}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${sessionValue}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiPg0KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiIgdmFsdWU9ImNsZWFyU2Vzc2lvbiIvPg0KICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiI+Q2xlYXIgU2Vzc2lvbjwvYnV0dG9uPg0KPC9mb3JtPg0KPGJyIC8+\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PSR7dG9rZW5TZXNzaW9uSWRbMF19OyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Handshake callback\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"clearSession\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"clearSession\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${cacheKey}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKey}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Tm8gY3VycmVudCB0b2tlbi4=\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"initialize\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// delete cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PTsgRXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVDsgUGF0aD0vOyBTZWN1cmU7IEh0dHBPbmx5\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Clear session\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${error}\"/>\n                    <L7p:Expression2 stringValue=\"access_denied\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"access_denied\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${error}\"/>\n                            <L7p:Expression2 stringValue=\"access_denied\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"access_denied\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"QWNjZXNzIHdhcyBkZW5pZWQu\"/>\n                            <L7p:VariableToSet stringValue=\"errorMessage\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Denied\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${error}\"/>\n                            <L7p:Expression2 stringValue=\"invalid_request\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"invalid_request\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"VGhlIHJlcXVlc3Qgd2FzIGludmFsaWQuIFBsZWFzZSB0cnkgYWdhaW4u\"/>\n                            <L7p:VariableToSet stringValue=\"errorMessage\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Invalid\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${error}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"QW4gZXJyb3IgaGFzIG9jY3VycmVkOiAke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuZXJyb3J9\"/>\n                            <L7p:VariableToSet stringValue=\"errorMessage\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Unknown error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"ew0KICAiYWNjZXNzX3Rva2VuIjoiIiwNCiAgInRva2VuX3R5cGUiOiIiLA0KICAiZXhwaXJlc19pbiI6LA0KICAicmVmcmVzaF90b2tlbiI6IiIsDQogICJzY29wZSI6IiINCn0=\"/>\n                    <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"ew0KICAiYWNjZXNzX3Rva2VuIjoiIiwNCiAgInRva2VuX3R5cGUiOiIiLA0KICAiZXhwaXJlc19pbiI6LA0KICAicmVmcmVzaF90b2tlbiI6IiIsDQogICJzY29wZSI6IiINCn0NCg0KJHtlcnJvck1lc3NhZ2V9\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:UUIDGenerator>\n                    <L7p:TargetVariable stringValue=\"tokenSessionId\"/>\n                </L7p:UUIDGenerator>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${tokenSessionId}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${sessionValue}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiPg0KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiIgdmFsdWU9ImNsZWFyU2Vzc2lvbiIvPg0KICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iQ2xlYXIgU2Vzc2lvbiI+Q2xlYXIgU2Vzc2lvbjwvYnV0dG9uPg0KPC9mb3JtPg0KPGJyIC8+\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PSR7dG9rZW5TZXNzaW9uSWRbMF19OyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Error\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"refresh\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"refresh\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Regex>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:CaptureVar stringValue=\"rt\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"current_token\"/>\n                    <L7p:Regex stringValue=\"\\&quot;refresh_token\\&quot;\\s*\\:\\s*\\&quot;([^&quot;]*)\\&quot;\"/>\n                    <L7p:RegexName stringValue=\"isolate the refresh token\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtydFsxXX0=\"/>\n                    <L7p:VariableToSet stringValue=\"refresh_token\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_resource\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_resource\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Z3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49JHtyZWZyZXNoX3Rva2VufSZzY29wZT0ke29hdXRoMl9zY29wZX0mcmVzb3VyY2U9JHtvYXV0aDJfcmVzb3VyY2V9\"/>\n                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"postMsg\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:HttpRoutingAssertion>\n                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                    <L7p:HttpMethod httpMethod=\"POST\"/>\n                    <L7p:Login stringValue=\"${oauth2_client_id}\"/>\n                    <L7p:Password stringValue=\"${oauth2_client_secret}\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${location_tokenserver}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"application/xml\"/>\n                                <L7p:Name stringValue=\"accept\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestMsgSrc stringValue=\"postMsg\"/>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"3MVG94DzwlYDSHS6GTCNPxF87RQ8HrxbojWk89by7fE_H4ch8TsfZcaIFz.jdne83WCVPiD_xA93_Y8j4iomk\"/>\n                                <L7p:Name stringValue=\"client_id\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"https://ssg61.l7tech.com:8443/salesforce/oauth/callback\"/>\n                                <L7p:Name stringValue=\"redirect_uri\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"4922422941220601472\"/>\n                                <L7p:Name stringValue=\"client_secret\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"authorization_code\"/>\n                                <L7p:Name stringValue=\"grant_type\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"${code}\"/>\n                                <L7p:Name stringValue=\"code\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmVmcmVzaGVkLg==\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0=\"/>\n                    <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKey}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${sessionValue}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PSR7Y2FjaGVLZXl9OyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Refresh\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:TrueAssertion/>\n        </wsp:OneOrMore>\n        <L7p:HardcodedResponse>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"200\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64ResponseBody stringValue=\"JHtodG1sVGVtcGxhdGVUb3B9DQoNCjxkaXYgaWQ9ImNvbnRlbnQiPg0KDQogIDxJRlJBTUUgaWQ9bXlpZnJhbWUgc3JjPSIiIHN0eWxlPSdkaXNwbGF5Om5vbmUnIGZyYW1lYm9yZGVyPSIwIiBzY3JvbGxpbmc9ImF1dG8iPg0KICA8L0lGUkFNRT4NCg0KICA8aDE+R3JhbnQgdHlwZTogQXV0aG9yaXphdGlvbiBjb2RlPC9oMT4NCiAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMmVtOyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NjYzsiPg0KICAgIDxoMj5DdXJyZW50IEFjY2VzcyBUb2tlbjo8L2gyPg0KICAgICR7Y2xlYXJTZXNzaW9uRm9ybX0NCiAgICA8cHJlPg0KJHtjdXJyZW50X3Rva2VufQ0KICAgIDwvcHJlPg0KICA8L2Rpdj4NCiAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMmVtOyI+DQogICAgPGgyPkluaXRpYXRlIG5ldyBPQXV0aCBoYW5kc2hha2U8L2gyPg0KICAgIDxmb3JtIGFjdGlvbj0iJHtsb2NhdGlvbl9hdXRoc2VydmVyfSI+DQogICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyZXNwb25zZV90eXBlIg0gdmFsdWU9ImNvZGUiLz4NCiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImNsaWVudF9pZCIgdmFsdWU9IiR7b2F1dGgyX2NsaWVudF9pZH0iLz4NCiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlZGlyZWN0X3VyaSINIHZhbHVlPSIke3JlZGlyZWN0X3VyaX0iLz4KICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2NvcGUiDSB2YWx1ZT0iJHtvYXV0aDJfc2NvcGV9Ii8+DQogICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJzdGF0ZSINIHZhbHVlPSJzdGF0ZV90ZXN0Ii8+DQogICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlc291cmNlIiAgdmFsdWU9IiR7b2F1dGgyX3Jlc291cmNlfSIvPgogICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSBidG4tbWluaSIgdmFsdWU9IkluaXRpYXRlIj5Jbml0aWF0ZTwvYnV0dG9uPg0KICAgIDwvZm9ybT4NCg0gIDwvZGl2Pg0KICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyZW07Ij4NCiAgICA8aDI+UmVmcmVzaCBDdXJyZW50IEFjY2VzcyBUb2tlbjwvaDI+DQogICAgPGZvcm0gYWN0aW9uPSIke3JlcXVlc3QudXJsLnByb3RvY29sfTovLyR7cmVxdWVzdC51cmwuaG9zdH06JHtyZXF1ZXN0LnVybC5wb3J0fSR7cmVxdWVzdC51cmwucGF0aH0iPg0KICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIg0gdmFsdWU9InJlZnJlc2giLz4NCiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlc291cmNlIiAgdmFsdWU9IiR7b2F1dGgyX3Jlc291cmNlfSIvPgogICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSBidG4tbWluaSIgdmFsdWU9IlJlZnJlc2giPlJlZnJlc2g8L2J1dHRvbj4NCiAgICA8L2Zvcm0+DQogIDwvZGl2Pg0KICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyZW07Ij4NCiAgICA8aDI+Q2FsbCBBUEkgVXNpbmcgQ3VycmVudCBBY2Nlc3MgVG9rZW48L2gyPg0KICAgIDxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9Ij4NCiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImFjdGlvbiINIHZhbHVlPSJjYWxsYXBpIi8+DQogICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJzdGF0ZSINIHZhbHVlPSJzdGF0ZV90ZXN0Ii8+CiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlc291cmNlIiAgdmFsdWU9IiR7b2F1dGgyX3Jlc291cmNlfSIvPgogICAgICBUYXJnZXQ6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ0YXJnZXQiIHNpemU9ODAgdmFsdWU9IiR7bG9jYXRpb25fcmVzb3VyY2VlbmRwb2ludH0iLz4NCiAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iQ2FsbCBBUEkiPkNhbGwgQVBJPC9idXR0b24+DQogICAgPC9mb3JtPg0KICAgIDxwcmU+DQoke2FwaW91dHB1dH0NCiAgICA8L3ByZT4NCiAgPC9kaXY+DQo8L2Rpdj4NCg0KJHtodG1sVGVtcGxhdGVCb3R0b219\"/>\n            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n        </L7p:HardcodedResponse>\n        <L7p:AddHeader>\n            <L7p:HeaderName stringValue=\"Pragma\"/>\n            <L7p:HeaderValue stringValue=\"no-cache\"/>\n            <L7p:Target target=\"RESPONSE\"/>\n        </L7p:AddHeader>\n        <L7p:AddHeader>\n            <L7p:HeaderName stringValue=\"Cache-Control\"/>\n            <L7p:HeaderValue stringValue=\"no-store\"/>\n            <L7p:Target target=\"RESPONSE\"/>\n        </L7p:AddHeader>\n        <L7p:AddHeader>\n            <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n            <L7p:HeaderValue stringValue=\"${setCookie}\"/>\n            <L7p:RemoveExisting booleanValue=\"true\"/>\n            <L7p:Target target=\"RESPONSE\"/>\n        </L7p:AddHeader>\n    </wsp:All>\n</wsp:Policy>"
  }
}