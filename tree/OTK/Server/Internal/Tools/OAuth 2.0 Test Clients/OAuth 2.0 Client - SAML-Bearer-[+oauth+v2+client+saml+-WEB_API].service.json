{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fe77a",
  "guid": "fb48d609-c496-49eb-b92e-920f2bb82b1c",
  "name": "OAuth 2.0 Client - SAML-Bearer",
  "resolutionPath": "/oauth/v2/client/saml*",
  "serviceType": "WEB_API",
  "checksum": "7c6e6ded0c333758cda98bff04971bbe84feb1a7",
  "enabled": true,
  "folderPath": "/OTK/Server/Internal/Tools/OAuth 2.0 Test Clients",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This is a test client for an OAuth 2 implementation using the saml grant type\"/>\n        </L7p:CommentAssertion>\n        <L7p:SslAssertion/>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n            <L7p:PolicyName stringValue=\"OTK Security Header Extension\"/>\n        </L7p:Include>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:AddHeader>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"HTTPS only\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Inform the browser to only accept SSL connections\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:HeaderName stringValue=\"Content-Security-Policy\"/>\n                <L7p:HeaderValue stringValue=\"default-src 'self'; script-src 'unsafe-inline'; img-src * data:; style-src 'unsafe-inline'; font-src * data:; require-trusted-types-for 'script'; object-src 'none';\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Override OTK Security Header Extension\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"51740c0b-11c5-455e-92a0-a1f915264eb0\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client Context Variables\"/>\n        </L7p:Encapsulated>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"apioutput\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"c2FtbA==\"/>\n            <L7p:VariableToSet stringValue=\"client_page\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"cacheKey\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"cacheKeySaml\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjdGlvbn0=\"/>\n            <L7p:VariableToSet stringValue=\"action\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"dXJuOmlldGY6cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6c2FtbDItYmVhcmVy\"/>\n            <L7p:VariableToSet stringValue=\"saml_grant_type\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLlNBTUxSZXNwb25zZX0=\"/>\n            <L7p:VariableToSet stringValue=\"SAMLResponse\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"Tm8gY3VycmVudCBzYW1s\"/>\n            <L7p:VariableToSet stringValue=\"current_saml\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"setCookie\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"setCookieSaml\"/>\n        </L7p:SetVariable>\n        <wsp:All wsp:Usage=\"Required\">\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:CookieCredentialSource>\n                        <L7p:CookieName stringValue=\"l7otk2client\"/>\n                    </L7p:CookieCredentialSource>\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${cookie.l7otk2client}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjb29raWUubDdvdGsyY2xpZW50fQ==\"/>\n                        <L7p:VariableToSet stringValue=\"cacheKey\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"check cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:TrueAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"none\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                </L7p:TrueAssertion>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"get current token session id\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheAge\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheId\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheKey\"/>\n                                <L7p:value stringValue=\"${cacheKey}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"sessionValue\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"sessionLocation\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:found/ns:location/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:EncodeDecode>\n                        <L7p:SourceVariableName stringValue=\"sessionValue.result\"/>\n                        <L7p:TargetDataType variableDataType=\"string\"/>\n                        <L7p:TargetVariableName stringValue=\"decoded\"/>\n                        <L7p:TransformType transformType=\"URL_DECODE\"/>\n                    </L7p:EncodeDecode>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtkZWNvZGVkfQ0KDQpUaGUgYWNjZXNzIHRva2VuIHdhcyByZXRyaWV2ZWQgZnJvbSAke3Nlc3Npb25Mb2NhdGlvbi5yZXN1bHR9Lg==\"/>\n                        <L7p:VariableToSet stringValue=\"current_token\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiIG1ldGhvZD0iUE9TVCI+DQogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQogICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJDbGVhciBTZXNzaW9uIj5DbGVhciBTZXNzaW9uPC9idXR0b24+DQo8L2Zvcm0+DQo8YnIgLz4=\"/>\n                        <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <L7p:TrueAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"not found or no cacheKey\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                </L7p:TrueAssertion>\n            </wsp:OneOrMore>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// find current token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CookieCredentialSource>\n                    <L7p:CookieName stringValue=\"l7otk2samlfromsts\"/>\n                </L7p:CookieCredentialSource>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${cookie.l7otk2samlfromsts}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjb29raWUubDdvdGsyc2FtbGZyb21zdHN9\"/>\n                    <L7p:VariableToSet stringValue=\"cacheKeySaml\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKeySaml}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:ResponseXpathAssertion>\n                    <L7p:VariablePrefix stringValue=\"samlValue\"/>\n                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ns\"/>\n                                <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                        <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                    </L7p:XpathExpression>\n                </L7p:ResponseXpathAssertion>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"samlValue.result\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"samlDecoded\"/>\n                    <L7p:TransformType transformType=\"URL_DECODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzYW1sRGVjb2RlZH0=\"/>\n                    <L7p:VariableToSet stringValue=\"current_saml\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiIG1ldGhvZD0iUE9TVCI+DQogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQogICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJDbGVhciBTZXNzaW9uIj5DbGVhciBTZXNzaW9uPC9idXR0b24+DQo8L2Zvcm0+DQo8YnIgLz4=\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"check cookie\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:TrueAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// find current SAML token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${clearSessionForm}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Negate booleanValue=\"true\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Negated booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"initialize\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// delete cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PTsgRXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVDsgUGF0aD0vOyBTZWN1cmU7IEh0dHBPbmx5\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"initialize\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// delete cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyc2FtbGZyb21zdHM9OyBFeHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UOyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookieSaml\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// clear token session form\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${SAMLResponse}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item stringLength=\"included\">\n                            <L7p:Max intValue=\"-1\"/>\n                            <L7p:Min intValue=\"1\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtTQU1MUmVzcG9uc2V9\"/>\n                    <L7p:VariableToSet stringValue=\"current_saml\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"current_saml\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"current_saml\"/>\n                    <L7p:TransformType transformType=\"BASE64_DECODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3NhbWx9\"/>\n                    <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                </L7p:SetVariable>\n                <L7p:UUIDGenerator>\n                    <L7p:TargetVariable stringValue=\"samlTokenSessionId\"/>\n                </L7p:UUIDGenerator>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzYW1sVG9rZW5TZXNzaW9uSWRbMF19\"/>\n                    <L7p:VariableToSet stringValue=\"cacheKeySaml\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKeySaml}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${sessionValue}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiIG1ldGhvZD0iUE9TVCI+DQogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQogICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJDbGVhciBTZXNzaW9uIj5DbGVhciBTZXNzaW9uPC9idXR0b24+DQo8L2Zvcm0+DQo8YnIgLz4=\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyc2FtbGZyb21zdHM9JHtjYWNoZUtleVNhbWx9OyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookieSaml\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:TrueAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// receive new SAML token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"callapi\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"callapi\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3Rva2VufQ==\"/>\n                    <L7p:VariableToSet stringValue=\"token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRhcmdldH0=\"/>\n                    <L7p:VariableToSet stringValue=\"target_url\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"R0VU\"/>\n                    <L7p:VariableToSet stringValue=\"target_http_method\"/>\n                </L7p:SetVariable>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"b7cf6a44-386c-40f8-ba22-24fbe5ce1926\"/>\n                    <L7p:PolicyName stringValue=\"v2GenerateAuthHeaderForClient\"/>\n                </L7p:Include>\n                <L7p:HttpRoutingAssertion>\n                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                    <L7p:HttpMethod httpMethod=\"GET\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${target_url}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"${authorization_header}\"/>\n                                <L7p:Name stringValue=\"authorization\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\"/>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0=\"/>\n                    <L7p:VariableToSet stringValue=\"apioutput\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Call API\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"handshake\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"handshake\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzYW1sX2dyYW50X3R5cGV9\"/>\n                    <L7p:VariableToSet stringValue=\"notencodedgranttype\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"notencodedgranttype\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"encodedgranttype\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"current_saml\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"encoded_saml\"/>\n                    <L7p:TransformType transformType=\"BASE64_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"encoded_saml\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"encoded_saml\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Z3JhbnRfdHlwZT0ke2VuY29kZWRncmFudHR5cGV9JmFzc2VydGlvbj0ke2VuY29kZWRfc2FtbH0mc2NvcGU9JHtvYXV0aDJfc2NvcGV9\"/>\n                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"postMsg\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_id\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"oauth2_client_secret\"/>\n                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:HttpRoutingAssertion>\n                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                    <L7p:HttpMethod httpMethod=\"POST\"/>\n                    <L7p:Login stringValue=\"${oauth2_client_id}\"/>\n                    <L7p:Password stringValue=\"${oauth2_client_secret}\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${location_tokenserver}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"application/xml\"/>\n                                <L7p:Name stringValue=\"accept\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestMsgSrc stringValue=\"postMsg\"/>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"3MVG94DzwlYDSHS6GTCNPxF87RQ8HrxbojWk89by7fE_H4ch8TsfZcaIFz.jdne83WCVPiD_xA93_Y8j4iomk\"/>\n                                <L7p:Name stringValue=\"client_id\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"https://ssg61.l7tech.com:8443/salesforce/oauth/callback\"/>\n                                <L7p:Name stringValue=\"redirect_uri\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"4922422941220601472\"/>\n                                <L7p:Name stringValue=\"client_secret\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"authorization_code\"/>\n                                <L7p:Name stringValue=\"grant_type\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:CustomizeValue stringValue=\"${code}\"/>\n                                <L7p:Name stringValue=\"code\"/>\n                                <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0NCg0KVGhlIGFjY2VzcyB0b2tlbiB3YXMgcmV0cmlldmVkIHZpYSBoYW5kc2hha2Uu\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZS5tYWlucGFydH0=\"/>\n                    <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                </L7p:SetVariable>\n                <L7p:UUIDGenerator>\n                    <L7p:TargetVariable stringValue=\"tokenSessionId\"/>\n                </L7p:UUIDGenerator>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHt0b2tlblNlc3Npb25JZFswXX0=\"/>\n                    <L7p:VariableToSet stringValue=\"cacheKey\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKey}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxEntries\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheMaxSize\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"dbAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"value\"/>\n                            <L7p:value stringValue=\"${sessionValue}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PGZvcm0gYWN0aW9uPSIiIG1ldGhvZD0iUE9TVCI+DQogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iY2xlYXJTZXNzaW9uIi8+DQogICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJDbGVhciBTZXNzaW9uIj5DbGVhciBTZXNzaW9uPC9idXR0b24+DQo8L2Zvcm0+DQo8YnIgLz4=\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PSR7Y2FjaGVLZXl9OyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Handshake\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"clearSession\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"clearSession\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Tm8gY3VycmVudCB0b2tlbi4=\"/>\n                    <L7p:VariableToSet stringValue=\"current_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Tm8gY3VycmVudCBzYW1s\"/>\n                    <L7p:VariableToSet stringValue=\"current_saml\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:VariableToSet stringValue=\"clearSessionForm\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"initialize\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// delete cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyY2xpZW50PTsgRXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVDsgUGF0aD0vOyBTZWN1cmU7IEh0dHBPbmx5\"/>\n                    <L7p:VariableToSet stringValue=\"setCookie\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"initialize\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// delete cookie\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"bDdvdGsyc2FtbGZyb21zdHM9OyBFeHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UOyBQYXRoPS87IFNlY3VyZTsgSHR0cE9ubHk=\"/>\n                    <L7p:VariableToSet stringValue=\"setCookieSaml\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// token\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKey}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// saml\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${cacheKeySaml}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Clear session\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:TrueAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// tasks\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${current_saml}\"/>\n                <L7p:Expression2 stringValue=\"No current saml\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"No current saml\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3NhbWx9\"/>\n                    <L7p:ContentType stringValue=\"text/xml; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"current_saml_summary\"/>\n                </L7p:SetVariable>\n                <L7p:XslTransformation>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Create summary of SAML assertion information\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Direction intValue=\"-1\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"current_saml_summary\"/>\n                    <L7p:ResourceInfo staticResourceInfo=\"included\">\n                        <L7p:Document stringValueReference=\"inline\"><![CDATA[<xsl:stylesheet version=\"1.0\"\n                    xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n                    <xsl:output method=\"html\"/>\n                    <xsl:template match=\"/\">\n                    <b>SAML Assertion Summary</b><br/>\n                    NameID: <xsl:value-of select=\"//*[local-name()='NameID']\"/><br/>\n                    SubjectConfimation: <xsl:value-of select=\"//*[local-name()='SubjectConfirmation']/@Method\"/><br/>\n                    NotBefore: <xsl:value-of select=\"//*[local-name()='Conditions']/@NotBefore\"/><br/>\n                    NotOnOrAfter: <xsl:value-of select=\"//*[local-name()='Conditions']/@NotOnOrAfter\"/><br/>\n                    AuthenticationContext: <xsl:value-of select=\"//*[local-name()='AuthnContext']\"/><br/>\n                    </xsl:template>\n                    </xsl:stylesheet>]]></L7p:Document>\n                    </L7p:ResourceInfo>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:TransformName stringValue=\"\"/>\n                </L7p:XslTransformation>\n                <L7p:Regex>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Escape &amp;lt; character in SAML assertion for HTML display\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"current_saml\"/>\n                    <L7p:Regex stringValue=\"&lt;/\"/>\n                    <L7p:Replace booleanValue=\"true\"/>\n                    <L7p:Replacement stringValue=\"&amp;lt;/\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:Regex>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Add line break and escape &amp;lt; character in SAML assertion for HTML display\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"current_saml\"/>\n                    <L7p:Regex stringValue=\"&lt;\"/>\n                    <L7p:Replace booleanValue=\"true\"/>\n                    <L7p:Replacement stringValue=\"&lt;br>&amp;lt;\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3NhbWxfc3VtbWFyeS5tYWlucGFydH0NCjxiciAvPg0KPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJ0b2dnbGUiIG9uY2xpY2s9InVuaGlkZSgnc2FtbF9hc3NlcnRpb24nKTtyZXR1cm47Ij5WaWV3L0hpZGUgU0FNTCBhc3NlcnRpb248L2J1dHRvbj4NCjxzY3JpcHQ+DQogZnVuY3Rpb24gdW5oaWRlKGRpdklEKSB7DQogCXZhciBpdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2SUQpOw0KIAlpZiAoaXRlbSkgew0KIAkJaWYgKGl0ZW0uY2xhc3NOYW1lPT0naGlkZGVuJykgew0KIAkJCWl0ZW0uY2xhc3NOYW1lPSd1bmhpZGRlbic7DQogCQkJaXRlbS5zdHlsZT0nZGlzcGxheTpibG9jazsnOw0KIAkJfSBlbHNlIHsNCiAJCSAJaXRlbS5jbGFzc05hbWU9J2hpZGRlbic7DQogCQkJaXRlbS5zdHlsZT0nZGlzcGxheTpub25lOyc7DQogCQl9DQogCX0NCiB9DQo8L3NjcmlwdD4NCjxkaXYgaWQ9InNhbWxfYXNzZXJ0aW9uIiBzdHlsZT0iZGlzcGxheTpub25lOyIgY2xhc3M9ImhpZGRlbiI+DQoJJHtjdXJyZW50X3NhbWx9DQo8L2Rpdj4=\"/>\n                    <L7p:VariableToSet stringValue=\"current_saml\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Build HTML template for SAML assertion display if exists\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:HardcodedResponse>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"200\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64ResponseBody stringValue=\"JHtodG1sVGVtcGxhdGVUb3B9DQoNCjxkaXYgaWQ9ImNvbnRlbnQiPg0KDQogIDxJRlJBTUUgaWQ9bXlpZnJhbWUgc3JjPSIiIHN0eWxlPSdkaXNwbGF5Om5vbmUnIGZyYW1lYm9yZGVyPSIwIiBzY3JvbGxpbmc9ImF1dG8iPg0KICA8L0lGUkFNRT4NCg0KICA8aDE+R3JhbnQgdHlwZTogU0FNTCAoJHtzYW1sX2dyYW50X3R5cGV9KTwvaDE+DQogIDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206IDJlbTsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNjY2M7Ij4NCiAgICA8aDI+Q3VycmVudCBBY2Nlc3MgVG9rZW46PC9oMj4NCiAgICAke2NsZWFyU2Vzc2lvbkZvcm19DQogICAgPHByZT4NCiR7Y3VycmVudF90b2tlbn0NCiAgICA8L3ByZT4NCiAgPC9kaXY+DQogIDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206IDJlbTsiPg0KICAgIDxoMj5Jbml0aWF0ZSBuZXcgU0FNTCBoYW5kc2hha2U8L2gyPg0KICAgIDxmb3JtIGFjdGlvbj0iJHtsb2NhdGlvbl9zYW1sX3Rva2VuX3NlcnZlcn0iIG1ldGhvZD0iUE9TVCI+DQogICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJyZWRpcmVjdF91cmkiIHZhbHVlPSIke3JlcXVlc3QudXJsLnByb3RvY29sfTovLyR7cmVxdWVzdC51cmwuaG9zdH06JHtyZXF1ZXN0LnVybC5wb3J0fSR7cmVxdWVzdC51cmwucGF0aH0iLz4KICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYXVkaWVuY2VfcmVjaXBpZW50X3Jlc3RyaWN0aW9uIiB2YWx1ZT0iJHthdWRpZW5jZV9yZWNpcGllbnRfcmVzdHJpY3Rpb259Ii8+IAogICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi1taW5pIiB2YWx1ZT0iSW5pdGlhdGUiPlJlcXVlc3QgYSBTQU1MIHRva2VuPC9idXR0b24+DQogICAgPC9mb3JtPg0KICAgIDxwPg0KJHtjdXJyZW50X3NhbWx9DQogICAgPC9wPg0KICA8L2Rpdj4NCiAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMmVtOyI+DQogICAgPGgyPkluaXRpYXRlIG5ldyBPQXV0aCBoYW5kc2hha2U8L2gyPg0KICAgIDxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9IiBtZXRob2Q9IlBPU1QiPg0KICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIg0gdmFsdWU9ImhhbmRzaGFrZSIvPg0KICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJJbml0aWF0ZSI+SW5pdGlhdGU8L2J1dHRvbj4NCiAgICA8L2Zvcm0+DQogIDwvZGl2Pg0KICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyZW07Ij4NCiAgICA8aDI+Q2FsbCBBUEkgVXNpbmcgQ3VycmVudCBBY2Nlc3MgVG9rZW48L2gyPg0KICAgIDxmb3JtIGFjdGlvbj0iJHtyZXF1ZXN0LnVybC5wcm90b2NvbH06Ly8ke3JlcXVlc3QudXJsLmhvc3R9OiR7cmVxdWVzdC51cmwucG9ydH0ke3JlcXVlc3QudXJsLnBhdGh9IiBtZXRob2Q9IlBPU1QiPg0KICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIg0gdmFsdWU9ImNhbGxhcGkiLz4NCiAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN0YXRlIg0gdmFsdWU9InN0YXRlX3Rlc3QiLz4NCiAgICAgIFRhcmdldDogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRhcmdldCIgc2l6ZT04MCB2YWx1ZT0iJHtsb2NhdGlvbl9yZXNvdXJjZWVuZHBvaW50fSIvPg0KICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLW1pbmkiIHZhbHVlPSJDYWxsIEFQSSI+Q2FsbCBBUEk8L2J1dHRvbj4NCiAgICA8L2Zvcm0+DQogICAgPHByZT4NCiR7YXBpb3V0cHV0fQ0KICAgIDwvcHJlPg0KICA8L2Rpdj4NCjwvZGl2Pg0KDQoke2h0bWxUZW1wbGF0ZUJvdHRvbX0=\"/>\n            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n        </L7p:HardcodedResponse>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${setCookie}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AddHeader>\n                <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                <L7p:HeaderValue stringValue=\"${setCookie}\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// token cookie\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${setCookieSaml}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AddHeader>\n                <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                <L7p:HeaderValue stringValue=\"${setCookieSaml}\"/>\n                <L7p:RemoveExisting booleanValue=\"true\"/>\n                <L7p:Target target=\"RESPONSE\"/>\n            </L7p:AddHeader>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// SAML cookie\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}