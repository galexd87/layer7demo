{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fdd38",
  "guid": "1fb0490d-7feb-40f1-aa61-39c8c800989e",
  "name": "auth/oauth/v2/token",
  "resolutionPath": "/auth/oauth/v2/token",
  "serviceType": "WEB_API",
  "checksum": "d8f3b806782074f852dc6098da3007bf4a6d10b0",
  "enabled": true,
  "folderPath": "/OTK/Server/DMZ/OAuth 2.0/TokenServer",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "PATCH",
    "DELETE",
    "HEAD",
    "OPTIONS",
    "OTHER"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== *** THIS POLICY IS OVERWRITTEN DURING AN UPGRADE ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Be aware that custom configuration made in this policy is overwritten during a solution kit upgrade.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== However, the older version of the policy is kept in the history and can be referenced.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== After upgrade, manually merge customizations from the old version of the policy to the new version.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This policy issues an access token\"/>\n        </L7p:CommentAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${gateway.otk.enable_auditing}\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"boolean\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"false\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AuditAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Audit the service policy execution\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:CustomizeErrorResponse>\n            <L7p:Content stringValue=\"${error.msg}\"/>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:Encapsulated>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"POST|OPTIONS\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// OPTIONS to enabled CORS\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b8822449-71ff-455b-8f10-39122e6c549b\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK HTTP Method Validation\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"method\"/>\n                    <L7p:value stringValue=\"POST|OPTIONS\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <L7p:CustomizeErrorResponse>\n            <L7p:Content stringValue=\"${error.msg}\"/>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"x-ca-err\"/>\n                    <L7p:Value stringValue=\"3003${error.code}\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:SslAssertion>\n                <L7p:RequireClientAuthentication booleanValue=\"true\"/>\n            </L7p:SslAssertion>\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"47f768f4-b478-472b-a1ee-10f4b6e76f99\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require SSL (with Client Certificate)\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireClientCert\"/>\n                        <L7p:value stringValue=\"false\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// optional\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"bac17a37-0b06-47fd-910c-4faced9489c3\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK CORS\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"{&quot;url_path_query&quot;:&quot;${request.url.path}${request.url.query}&quot;, &quot;http_method_allowed&quot;: &quot;${http_method_allowed}&quot;}\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireCORS\"/>\n                        <L7p:value stringValue=\"optional\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// error code produced in previous assertion\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"givenErrorCode\"/>\n                        <L7p:value stringValue=\"${error.code}\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"CORS\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Check for CORS\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${isPreflight}\"/>\n                    <L7p:MultivaluedComparison multivaluedComparison=\"FIRST\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"boolean\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"false\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2e6e2ef3-a36f-4548-a2c4-7b369b7ae184\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Variable Configuration\"/>\n                </L7p:Encapsulated>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0LnVybC5xdWVyeX0=\"/>\n                            <L7p:VariableToSet stringValue=\"query_params\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${allow_insecure_oauth_params}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Regex>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"query_params\"/>\n                                    <L7p:ProceedIfPatternMatches booleanValue=\"false\"/>\n                                    <L7p:Regex stringValue=\"([?&amp;]client_secret=)|([?&amp;]password=)|([?&amp;]subject_token=)|([?&amp;]actor_token=)|([?&amp;]code=)|([?&amp;]code_verifier=)|([?&amp;]device_code=)\"/>\n                                    <L7p:Replacement stringValue=\"\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                </L7p:Regex>\n                                <L7p:HtmlFormDataAssertion>\n                                    <L7p:AllowPost booleanValue=\"true\"/>\n                                    <L7p:FieldSpecs htmlFormFieldSpecArray=\"included\">\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"actor_token\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"actor_token_type\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"assertion\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"audience\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"client_assertion\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"client_assertion_type\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"client_id\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"client_secret\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"code\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"code_verifier\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:MinOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"grant_type\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"password\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"redirect_uri\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"requested_token_type\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"resource\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"true\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"scope\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"subject_token\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"subject_token_type\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"username\"/>\n                                    </L7p:item>\n                                    <L7p:item htmlFormFieldSpec=\"included\">\n                                    <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                    <L7p:DataType fieldDataType=\"any\"/>\n                                    <L7p:MaxOccurs intValue=\"1\"/>\n                                    <L7p:Name stringValue=\"device_code\"/>\n                                    </L7p:item>\n                                    </L7p:FieldSpecs>\n                                </L7p:HtmlFormDataAssertion>\n                            </wsp:All>\n                        </wsp:OneOrMore>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAuaGVhZGVydmFsdWVzLmRldmljZS1pZGVudGlmaWVyfEBAfSMjJHtyZXF1ZXN0Lmh0dHAuaGVhZGVydmFsdWVzLm1hZy1pZGVudGlmaWVyfEBAfSMjJHtyZXF1ZXN0Lmh0dHAuaGVhZGVydmFsdWVzLmF1dGhvcml6YXRpb258QEB9IyM=\"/>\n                            <L7p:ContentType stringValue=\"text/xml; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"requestHeaders\"/>\n                        </L7p:SetVariable>\n                        <L7p:Regex>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Presence of '@@' indicates duplicate parameters\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:AutoTarget booleanValue=\"false\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"requestHeaders\"/>\n                            <L7p:ProceedIfPatternMatches booleanValue=\"false\"/>\n                            <L7p:Regex stringValue=\"[@]{2}|[,]\"/>\n                            <L7p:Replacement stringValue=\"\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                        </L7p:Regex>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"success\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"103\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"parameters\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Check for duplicate parameters in the request\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"7e2b4f64-e226-4a03-980a-c4603163acc0\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK OVP Configuration\"/>\n                </L7p:Encapsulated>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"db047e91-52db-4176-a3eb-a43aa0c2c67c\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Storage Configuration\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"de62a190-b120-4ce3-a958-25a5e09cf949\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Validate Grant Type\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"grant_type\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.grant_type}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code provided by previous assertion\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"${error.code}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Check grant type\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLkF1dGhvcml6YXRpb259\"/>\n                        <L7p:VariableToSet stringValue=\"requestAuthHeader\"/>\n                    </L7p:SetVariable>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${requestAuthHeader}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:CaptureVar stringValue=\"authScheme\"/>\n                                <L7p:FindAll booleanValue=\"true\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"requestAuthHeader\"/>\n                                <L7p:Regex stringValue=\"(.*)\\s.*\"/>\n                                <L7p:Replacement stringValue=\"\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                        </wsp:All>\n                        <L7p:TrueAssertion/>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Add WWW-Authenticate response header\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Prepare Error Message\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// set token endpoint url\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"JHtvYXV0aDJfc2VydmVyX2hvc3RuYW1lfToke29hdXRoMl9zZXJ2ZXJfcG9ydH0ke29hdXRoMl90b2tlbl9wYXRofQ==\"/>\n                            <L7p:VariableToSet stringValue=\"token_endpoint\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${oauth2_server_url_prefix}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// set token endpoint url\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:Base64Expression stringValue=\"JHtvYXV0aDJfc2VydmVyX2hvc3RuYW1lfToke29hdXRoMl9zZXJ2ZXJfcG9ydH0vJHtvYXV0aDJfc2VydmVyX3VybF9wcmVmaXh9JHtvYXV0aDJfdG9rZW5fcGF0aH0=\"/>\n                                <L7p:VariableToSet stringValue=\"token_endpoint\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"//set token endpoint with url prefix\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8e27e918-986e-466f-86a4-169d4602cbb1\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client Authentication\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"allow_basic\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"allow_query\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"audience\"/>\n                                    <L7p:value stringValue=\"${token_endpoint}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_header\"/>\n                                    <L7p:value stringValue=\"${requestAuthHeader}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_param_client_assertion\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.client_assertion}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_param_client_assertion_type\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.client_assertion_type}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_param_id\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_param_secret\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.client_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_client_name\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_environment\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_expiration\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_scope\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"local_type\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"df04db76-9431-40b2-872f-dd0ab9727d19\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session Tracking\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"clientkey\"/>\n                                    <L7p:value stringValue=\"{&quot;client_custom&quot;: ${client_custom}, &quot;client_key_custom&quot;: ${client_key_custom}}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"current_input\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"customer\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mag\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"otk\"/>\n                                    <L7p:value stringValue=\"{&quot;client_type&quot;: &quot;${client_type}&quot;,&quot;grant_type&quot;: &quot;${grant_type}&quot;}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"portal\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${requestAuthHeader}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item regex=\"included\">\n                                    <L7p:Pattern stringValue=\"^\\b[Bb][Aa][Ss][Ii][Cc]\\b\\s.+\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"WWW-Authenticate\"/>\n                                    <L7p:HeaderValue stringValue=\"Basic error=&quot;Invalid or missing credentials&quot;\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"WWW-Authenticate\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"add header if necessary\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:TrueAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"add header or continue\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code provided by previous assertion\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Client\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Authenticate\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                    <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                </L7p:Include>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"mag-identifier\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLm1hZy1pZGVudGlmaWVyfQ==\"/>\n                            <L7p:VariableToSet stringValue=\"mag-identifier\"/>\n                        </L7p:SetVariable>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${mag-identifier}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"device-identifier\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLmRldmljZS1pZGVudGlmaWVyfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"mag-identifier\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"=== Mobile SSO\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"the mag-identifier. either to '...mag-identifier' or '...device-identifier' to support older SDK versions\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:CustomAssertion>\n                        <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFzcgAtY29tLmw3dGVjaC5wb2xpY3kuYXNzZXJ0aW9uLkFzc2VydGlvbiRDb21tZW50wRemdwvAdqYCAAFMAApwcm9wZXJ0aWVzdAAPTGphdmEvdXRpbC9NYXA7eHBzcgARamF2YS51dGlsLlRyZWVNYXAMwfY+LSVq5gMAAUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHBwdwQAAAABdAANUklHSFQuQ09NTUVOVHQAKS8vIGN1c3RvbSBhc3NlcnRpb24gSWdub3JlZCBmb3IgY29kZS1mbG93eAFzcgARamF2YS51dGlsLkhhc2hTZXS6RIWVlri3NAMAAHhwdwwAAAACP0AAAAAAAAFzcgAoY29tLmw3dGVjaC5wb2xpY3kuYXNzZXJ0aW9uLmV4dC5DYXRlZ29yeVqwnGWhRP41AgACSQAFbXlLZXlMAAZteU5hbWVxAH4ABHhwAAAAC3QAEEN1c3RvbUFzc2VydGlvbnN4cHNyADBjb20ubDd0ZWNoLmN1c3RvbS5hdXRoMnNjb3BlLlNjb3BlSXNzdWVBc3NlcnRpb24tYbsJUPQ+sAIAAkwAD3Njb3BlUmVnaXN0ZXJlZHEAfgAETAAOc2NvcGVSZXF1ZXN0ZWRxAH4ABHhwdAATJHtzY29wZS5yZWdpc3RlcmVkfXQAHyR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5zY29wZX10ADRlZjJhMzJkZjU4ZWRlNDVkMjQyYzlmYzkzNDA2YjdiZjA2MDc0NWNjYWQyZWJlNWYuamFydACvVmFsaWRhdGVzIHRoZSByZXF1ZXN0ZWQgU0NPUEUgYWdhaW5zdCBTQ09QRSdzIHRoYXQgd2VyZSByZWdpc3RlcmVkIGZvciB0aGUgY2xpZW50LiBJdCBvbmx5IGlzc3VlcyBTQ09QRSdzIHRoYXQgYXJlIGEgc3Vic2V0IG9mIHRoZSByZWdpc3RlcmVkIG9uZXMuIEl0IHdpbGwgZmFpbCBpZiBub25lIG1hdGNoLnQAEU9USyBTQ09QRSBJc3N1aW5ndAART1RLIFNDT1BFIElzc3Vpbmdw</L7p:base64SerializedValue>\n                    </L7p:CustomAssertion>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"115\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"${error.code}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Verify Scope\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"00627d8a-396c-4274-a6f5-2119def8f354\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK RESOURCE Issuing - Extended\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"resource.permitted\"/>\n                                <L7p:value stringValue=\"${resource.registered}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"resource.requested\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.resource}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"159\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"160\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Verify Resource\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"37d1d062-41a5-4dee-bc34-18ff2cc3b4dd\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Verify Grant Type\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"client_custom\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"client_key_custom\"/>\n                                <L7p:value stringValue=\"${client_key_custom}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"${client_key_custom}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"grant_type\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.grant_type}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"scopes\"/>\n                                <L7p:value stringValue=\"${scope.registered}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code provided by previous assertion\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"${error.code}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Verify grant type\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"ec70e0ed-a4ca-486d-926e-e0158935a5ff\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"MAG Verify Mag Identifier\"/>\n                    <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                </L7p:Encapsulated>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"ACCESS_TOKEN\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"6dbc70f9-bb40-4a69-a0ec-88fae4f35300\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Generate OAuth Token\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ac\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"art\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"at\"/>\n                                <L7p:value stringValue=\"true\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cid\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cidm\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"${session_output}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ock\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ot\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"rft\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"urt\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnZW5Ub2tlbn0=\"/>\n                        <L7p:VariableToSet stringValue=\"at_token\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnZW5FeHBpcmF0aW9ufQ==\"/>\n                        <L7p:VariableToSet stringValue=\"at_expiration\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnZW5TZWNyZXR9\"/>\n                        <L7p:VariableToSet stringValue=\"mac_secret\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtsaWZldGltZX0=\"/>\n                        <L7p:VariableToSet stringValue=\"at_lifetime\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Generate access_token\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"REFRESH_TOKEN\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"6dbc70f9-bb40-4a69-a0ec-88fae4f35300\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Generate OAuth Token\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ac\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"art\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"at\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cid\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cidm\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"${session_output}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ock\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ot\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"rft\"/>\n                                <L7p:value stringValue=\"true\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"urt\"/>\n                                <L7p:value stringValue=\"false\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnZW5Ub2tlbn0=\"/>\n                        <L7p:VariableToSet stringValue=\"rtoken\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnZW5FeHBpcmF0aW9ufQ==\"/>\n                        <L7p:VariableToSet stringValue=\"rexpiration\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtsaWZldGltZX0=\"/>\n                        <L7p:VariableToSet stringValue=\"rft_lifetime\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Generate refresh_token\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"bf601700-d7eb-47a3-b868-ff4a746d8a63\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Configured Grant Types\"/>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MA==\"/>\n                    <L7p:DataType variableDataType=\"int\"/>\n                    <L7p:VariableToSet stringValue=\"token_rank\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${dbsystem}\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operatorNull=\"null\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item dataType=\"included\">\n                                <L7p:Type variableDataType=\"string\"/>\n                            </L7p:item>\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:RightValue stringValue=\"oracle\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${gateway.otk.token_include_partition_key}\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operatorNull=\"null\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item dataType=\"included\">\n                                <L7p:Type variableDataType=\"boolean\"/>\n                            </L7p:item>\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:RightValue stringValue=\"false\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${grant_type_custom}\"/>\n                        <L7p:Expression2 stringValue=\"${grant_type}\"/>\n                        <L7p:Operator operator=\"CONTAINS\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Operator operator=\"CONTAINS\"/>\n                                <L7p:RightValue stringValue=\"${grant_type}\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                                    <L7p:Expression2 stringValue=\"${grant_type_client_credentials}\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_client_credentials}\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                                    <L7p:Expression2 stringValue=\"${grant_type_saml}\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_saml}\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                </wsp:OneOrMore>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHthdF9leHBpcmF0aW9ufQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"epochSeconds\"/>\n                                </L7p:SetVariable>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// use expiration as suffix for client credentials and saml grant\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtyZXhwaXJhdGlvbn0=\"/>\n                                <L7p:VariableToSet stringValue=\"epochSeconds\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:JavaScript>\n                                <L7p:ExecutionTimeout stringValue=\"\"/>\n                                <L7p:Name stringValue=\"\"/>\n                                <L7p:Script stringValueReference=\"inline\"><![CDATA[var epoch = context.getVariable(\"epochSeconds\")\nvar partition_interval = context.getVariable(\"gateway.otk.oracle.partition_interval\")\nvar exp_interval = Math.round(epoch/(partition_interval*60))\ncontext.setVariable(\"exp_interval\", exp_interval);]]></L7p:Script>\n                            </L7p:JavaScript>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHthdF90b2tlbn0tJHtleHBfaW50ZXJ2YWx9\"/>\n                                <L7p:VariableToSet stringValue=\"at_token\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// append token suffix for oracle dbsystem\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_client_credentials}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_client_credentials}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"83309f03-2dfe-4729-a12d-e68a1d41abc4\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=CLIENT_CREDENTIALS\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_type\"/>\n                                    <L7p:value stringValue=\"${client_type}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"eb5e4d62-555a-43a2-b3ad-d0f4050ca3b8\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: client_credentials\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_password}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_password}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"f50bce2a-e537-4543-9b09-d5c6de95b335\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=PASSWORD\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"password\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.password}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource.granted\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope.granted\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"username\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.username}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${mag-identifier}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:Regex>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"for database\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"only valid for mobile clients\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"scope.granted\"/>\n                                    <L7p:Regex stringValue=\"\\bopenid\\b[ ]|\\bopenid\\b|[ ]\\bopenid\\b\"/>\n                                    <L7p:Replace booleanValue=\"true\"/>\n                                    <L7p:Replacement stringValue=\"\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                </L7p:Regex>\n                                <L7p:Regex>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"for client response\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"only valid for mobile clients\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"clientResponse\"/>\n                                    <L7p:Regex stringValue=\"\\bopenid\\b[ ]|\\bopenid\\b|[ ]\\bopenid\\b\"/>\n                                    <L7p:Replace booleanValue=\"true\"/>\n                                    <L7p:Replacement stringValue=\"\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                </L7p:Regex>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"non-mobile\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"remove 'openid' from the list of graned SCOPE and do not execute Password_Extension\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:TrueAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"SCOPE\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"'openid' is not valid for non mobile clients\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"1cf60c6c-ecd3-43b5-a034-b5d7c78f3721\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"MSSO grant_type=PASSWORD_Extension\"/>\n                            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"authenticatedUser\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"azpActual\"/>\n                                    <L7p:value stringValue=\"${request.http.header.mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_secret\"/>\n                                    <L7p:value stringValue=\"${client_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"clientResponse\"/>\n                                    <L7p:value stringValue=\"${clientResponse}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"{&quot;client_custom&quot;: ${client_custom}, &quot;client_key_custom&quot;: ${client_key_custom}}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"magidentifier\"/>\n                                    <L7p:value stringValue=\"${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"salt\"/>\n                                    <L7p:value stringValue=\"${salt}${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope.granted\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"third_party_sso_token\"/>\n                                    <L7p:value stringValue=\"${third_party_sso_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"third_party_sso_token_type\"/>\n                                    <L7p:value stringValue=\"${third_party_sso_token_type}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Regex>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"//update token rank\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:AutoTarget booleanValue=\"false\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"session_output\"/>\n                            <L7p:Regex stringValue=\"&quot;token_rank&quot;: &quot;&quot;\"/>\n                            <L7p:Replace booleanValue=\"true\"/>\n                            <L7p:Replacement stringValue=\"&quot;token_rank&quot;: &quot;${token_rank}&quot;\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                        </L7p:Regex>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: password\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_authorization_code}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_authorization_code}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"29197059-a292-4203-b146-0476bfef71b7\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=AUTHORIZATION_CODE\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_secret\"/>\n                                    <L7p:value stringValue=\"${client_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"code\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.code}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"magidentifier\"/>\n                                    <L7p:value stringValue=\"${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mTLS_certificate_thumbprint\"/>\n                                    <L7p:value stringValue=\"${mTLS_certificate_thumbprint}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"redirect_uri\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.redirect_uri}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.resource}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"salt\"/>\n                                    <L7p:value stringValue=\"my_salt${client_id}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"f6b15d17-6562-4b70-a4e7-a940806e5d99\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK PKCE Validation\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"codeVerifier\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.code_verifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"session\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"5ee11e83-fe96-48ac-a165-d37d523e36ba\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"MSSO Device App Associate\"/>\n                            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: auth_code\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_jwt}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_jwt}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"d5afcff4-6f0b-46b3-b5a7-551277c16faa\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=JWT\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"access_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"accesst_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"assertion\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.assertion}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expected_grant_type\"/>\n                                    <L7p:value stringValue=\"${grant_type}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"magidentifier\"/>\n                                    <L7p:value stringValue=\"${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource.granted\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope.granted\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: jwt\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_refresh_token}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_refresh_token}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"3fa4307f-dd31-4cf6-88cd-3fd5e68341c8\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=REFRESH_TOKEN\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.resource}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration_new\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.refresh_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken_new\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope.requested\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"df04db76-9431-40b2-872f-dd0ab9727d19\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session Tracking\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"clientkey\"/>\n                                    <L7p:value stringValue=\"{&quot;client_custom&quot;: ${client_custom}, &quot;client_key_custom&quot;: ${client_key_custom}}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"current_input\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"customer\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mag\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"otk\"/>\n                                    <L7p:value stringValue=\"{&quot;client_type&quot;: &quot;${client_type}&quot;,&quot;grant_type&quot;: &quot;${grant_type}&quot;, &quot;original_grant_type&quot;: &quot;${original_grant_type}&quot;}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"portal\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"5ee11e83-fe96-48ac-a165-d37d523e36ba\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"MSSO Device App Associate\"/>\n                            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: refresh_token\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_saml}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_saml}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"04780115-0f25-4d18-8a01-3dc6266392ed\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=SAML\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"assertion\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.assertion}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"conditions\"/>\n                                    <L7p:value stringValue=\"${request.url.protocol}://${request.url.host}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"receipient\"/>\n                                    <L7p:value stringValue=\"${request.url.protocol}://${request.url.host}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource.granted\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"eb5e4d62-555a-43a2-b3ad-d0f4050ca3b8\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: saml\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_token_exchange}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_token_exchange}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"81d19fd1-98a3-45cf-8367-7b5f30b634c6\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=TOKEN_EXCHANGE\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"actor_token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.actor_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"actor_token_type\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.actor_token_type}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"audience\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.audience}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_custom\"/>\n                                    <L7p:value stringValue=\"${client_custom}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"conditions\"/>\n                                    <L7p:value stringValue=\"${request.url.protocol}://${request.url.host}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"receipient\"/>\n                                    <L7p:value stringValue=\"${request.url.protocol}://${request.url.host}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"requested_token_type\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.requested_token_type}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource.registered\"/>\n                                    <L7p:value stringValue=\"${resource.registered}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope.granted\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"session_output\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"subject_token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.subject_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"subject_token_type\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.subject_token_type}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: token_exchange\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_device_authorization_code}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_device_authorization_code}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"f83b5e92-cfaf-47f3-8b0b-4e4e6f91c07f\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=DEVICE_AUTHORIZATION_CODE\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_secret\"/>\n                                    <L7p:value stringValue=\"${client_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"device_code\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.device_code}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"magidentifier\"/>\n                                    <L7p:value stringValue=\"${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mTLS_certificate_thumbprint\"/>\n                                    <L7p:value stringValue=\"${mTLS_certificate_thumbprint}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"5ee11e83-fe96-48ac-a165-d37d523e36ba\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"MSSO Device App Associate\"/>\n                            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: device_code\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${grant_type}\"/>\n                            <L7p:Expression2 stringValue=\"${grant_type_ciba}\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"${grant_type_ciba}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"6b825ca8-14d7-46ee-a671-8dee4cacdc1e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK grant_type=CIBA\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_lifetime\"/>\n                                    <L7p:value stringValue=\"${at_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"at_token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"auth_req_id\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.auth_req_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_id\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_secret\"/>\n                                    <L7p:value stringValue=\"${client_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mac_secret\"/>\n                                    <L7p:value stringValue=\"${mac_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"magidentifier\"/>\n                                    <L7p:value stringValue=\"${mag-identifier}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"mTLS_certificate_thumbprint\"/>\n                                    <L7p:value stringValue=\"${mTLS_certificate_thumbprint}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"5ee11e83-fe96-48ac-a165-d37d523e36ba\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"MSSO Device App Associate\"/>\n                            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"23ffb2fe-daba-4395-93b5-91d5a4f23649\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Storage (access_token, refresh_token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client\"/>\n                                    <L7p:value stringValue=\"${client}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"${client_id}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"${client_name}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${session_output}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"${at_expiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"${resource.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${owner}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rexpiration\"/>\n                                    <L7p:value stringValue=\"${rexpiration}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"${rtoken}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"${scope.granted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${at_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_secret\"/>\n                                    <L7p:value stringValue=\"${token_secret}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"ENABLED\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: ciba\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"fdcbc885-1318-48e1-af48-0c2f1b6e9795\"/>\n                            <L7p:PolicyName stringValue=\"OTK grant_type=CUSTOM\"/>\n                        </L7p:Include>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant_type: custom\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"MTE5\"/>\n                                <L7p:VariableToSet stringValue=\"error.code\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"invalid grant_type\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"grant type failure\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"grant types\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Custom data passed to JWT generation\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64Expression stringValue=\"ew0KCSJzZXNzaW9uX291dHB1dCI6ICR7c2Vzc2lvbl9vdXRwdXR9LCANCgkidXNlcm5hbWUiOiAiJHtvd25lcn0iDQp9DQoNCg0K\"/>\n                        <L7p:VariableToSet stringValue=\"jwt_custom\"/>\n                    </L7p:SetVariable>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"546ac094-0584-4de1-a0c6-e03c0853a98a\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Generate JWT OAuth Token\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"act\"/>\n                                <L7p:value stringValue=\"${act}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"aud\"/>\n                                <L7p:value stringValue=\"${client_id}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"${jwt_custom}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"jti\"/>\n                                <L7p:value stringValue=\"${at_token}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"lifetime\"/>\n                                <L7p:value stringValue=\"${at_lifetime}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"mTLS_certificate_thumbprint\"/>\n                                <L7p:value stringValue=\"${mTLS_certificate_thumbprint}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"resource\"/>\n                                <L7p:value stringValue=\"${resource.granted}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"scope\"/>\n                                <L7p:value stringValue=\"${scope.granted}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Generate JWT\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${at_jwt}\"/>\n                        <L7p:Operator operatorNull=\"null\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item dataType=\"included\">\n                                <L7p:Type variableDataType=\"string\"/>\n                            </L7p:item>\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:Regex>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// if at_jwt is not empty, update the access_token in client response with JWT\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:AutoTarget booleanValue=\"false\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"clientResponse\"/>\n                        <L7p:Regex stringValue=\"access_token&quot;:[\\s]?&quot;[^,\\s]*&quot;\"/>\n                        <L7p:Replace booleanValue=\"true\"/>\n                        <L7p:Replacement stringValue=\"access_token&quot;:&quot;${at_jwt}&quot;\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                    </L7p:Regex>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// if use JWT, update acces_token in client response\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"c18ffd14-1724-48b6-9dba-624d2f3000d6\"/>\n                    <L7p:PolicyName stringValue=\"#OTK Token Response\"/>\n                </L7p:Include>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHtjbGllbnRSZXNwb25zZX0=\"/>\n                    <L7p:ResponseContentType stringValue=\"application/json;charset=UTF-8\"/>\n                </L7p:HardcodedResponse>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Pragma\"/>\n                    <L7p:HeaderValue stringValue=\"no-cache\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                    <L7p:HeaderValue stringValue=\"no-store\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Request\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${isPreflight}\"/>\n                    <L7p:MultivaluedComparison multivaluedComparison=\"FIRST\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"boolean\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"204\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:ResponseContentType stringValue=\"text/plain;charset=UTF-8\"/>\n                    <L7p:ResponseStatus stringValue=\"204\"/>\n                </L7p:HardcodedResponse>\n                <L7p:AddHeader>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Replace\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Override header to reflect actual allowed methods\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:HeaderName stringValue=\"Access-Control-Allow-Methods\"/>\n                    <L7p:HeaderValue stringValue=\"POST\"/>\n                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"IsPreflight\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"PreFlight\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Check for CORS-Pre-Flight\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}