{
  "goid": "e1168ac712849b6ecf8330b1c84c26d6",
  "guid": "5cd3d26c-d68f-4b87-913f-7a1d6989fae8",
  "name": "oauth-token-revocation-list",
  "resolutionPath": "/auth/oauth/v2/token-revocation-list",
  "serviceType": "WEB_API",
  "checksum": "f8927e9f04f957fb727c9d6bb6b3f0e7057b32ff",
  "enabled": true,
  "folderPath": "/OTK/Server/DMZ/OAuth 2.0/AuthorizationServer",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "PATCH",
    "DELETE",
    "HEAD",
    "OPTIONS",
    "OTHER"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== *** THIS POLICY IS OVERWRITTEN DURING AN UPGRADE ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Be aware that custom configuration made in this policy is overwritten during a solution kit upgrade.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== However, the older version of the policy is kept in the history and can be referenced.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== After upgrade, manually merge customizations from the old version of the policy to the new version.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" OAuth 2.0 Token revocation list\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${gateway.otk.enable_auditing}\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"boolean\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"false\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AuditAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//Audit the service policy execution if CWP otk.enable_auditing is set to true\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:CustomizeErrorResponse>\n            <L7p:Content stringValue=\"${error.msg}\"/>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b8822449-71ff-455b-8f10-39122e6c549b\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK HTTP Method Validation\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"custom\"/>\n                    <L7p:value stringValue=\"\"/>\n                </L7p:entry>\n                <L7p:entry>\n                    <L7p:key stringValue=\"method\"/>\n                    <L7p:value stringValue=\"GET\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <L7p:CustomizeErrorResponse>\n            <L7p:Content stringValue=\"${error.msg}\"/>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"x-ca-err\"/>\n                    <L7p:Value stringValue=\"${error.code}\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:SslAssertion>\n                <L7p:RequireClientAuthentication booleanValue=\"true\"/>\n            </L7p:SslAssertion>\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"47f768f4-b478-472b-a1ee-10f4b6e76f99\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require SSL (with Client Certificate)\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireClientCert\"/>\n                        <L7p:value stringValue=\"false\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//Require SSL or TLS with optional Client Certificate Authentication\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n        </L7p:Include>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2e6e2ef3-a36f-4548-a2c4-7b369b7ae184\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Variable Configuration\"/>\n        </L7p:Encapsulated>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"21b101c5-5701-4ca2-9206-237f8b37bfe8\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK id_token configuration\"/>\n        </L7p:Encapsulated>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAuaGVhZGVyLkF1dGhvcml6YXRpb259\"/>\n            <L7p:VariableToSet stringValue=\"requestAuthHeader\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"authenticated_client_id\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${token_revocation_list_enabled}\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"string\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"true\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MzE0\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"apiPrefix\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"givenErrorCode\"/>\n                            <L7p:value stringValue=\"${error.code}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//Should the service be enabled?\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${requestAuthHeader}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${requestAuthHeader}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item regex=\"included\">\n                            <L7p:Pattern stringValue=\"^\\b[Bb][Ee][Aa][Rr][Ee][Rr]\\b\\s.+\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"393bcb93-82ad-4b55-8333-1119f607a560\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require OAuth 2.0 Token\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"any_resource_required\"/>\n                            <L7p:value stringValue=\"false\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cache_lifetime\"/>\n                            <L7p:value stringValue=\"30\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"disable_audience_check\"/>\n                            <L7p:value stringValue=\"false\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"disallow_query\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"given_access_token\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"onetime\"/>\n                            <L7p:value stringValue=\"false\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"resource_required\"/>\n                            <L7p:value stringValue=\"https://${gateway.cluster.hostname}${oauth2_token_revocation_list_path}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"scope_fail\"/>\n                            <L7p:value stringValue=\"false\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"scope_required\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uLmNsaWVudF9pZH0=\"/>\n                    <L7p:VariableToSet stringValue=\"authenticated_client_id\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uLmN1c3RvbX0=\"/>\n                    <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"custom\"/>\n                </L7p:SetVariable>\n                <L7p:EvaluateJsonPathExpressionV2>\n                    <L7p:Expression stringValue=\"clientkey.client_custom\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"custom\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"client_custom\"/>\n                </L7p:EvaluateJsonPathExpressionV2>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjbGllbnRfY3VzdG9tLnJlc3VsdH0=\"/>\n                    <L7p:VariableToSet stringValue=\"client_custom\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Validate bearer token if present in the request header\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${error.code}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// error.code and error.msg are empty\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// stop processing if error is set during token validation\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//Bearer Token authentication\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:Include>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Rate Limit\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n        </L7p:Include>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${authenticated_client_id}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Negate booleanValue=\"true\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Negated booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// set trl endpoint url\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64Expression stringValue=\"JHtvYXV0aDJfc2VydmVyX2hvc3RuYW1lfToke29hdXRoMl9zZXJ2ZXJfcG9ydH0ke29hdXRoMl90b2tlbl9yZXZvY2F0aW9uX2xpc3RfcGF0aH0=\"/>\n                        <L7p:VariableToSet stringValue=\"trl_endpoint\"/>\n                    </L7p:SetVariable>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${oauth2_server_url_prefix}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// set trl endpoint url\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"JHtvYXV0aDJfc2VydmVyX2hvc3RuYW1lfToke29hdXRoMl9zZXJ2ZXJfcG9ydH0vJHtvYXV0aDJfc2VydmVyX3VybF9wcmVmaXh9LyR7b2F1dGgyX3Rva2VuX3Jldm9jYXRpb25fbGlzdF9wYXRofQ==\"/>\n                            <L7p:VariableToSet stringValue=\"trl_endpoint\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// set trl endpoint with url prefix\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8e27e918-986e-466f-86a4-169d4602cbb1\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client Authentication\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"allow_basic\"/>\n                                <L7p:value stringValue=\"true\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"allow_query\"/>\n                                <L7p:value stringValue=\"true\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"audience\"/>\n                                <L7p:value stringValue=\"${trl_endpoint}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"auth_header\"/>\n                                <L7p:value stringValue=\"${requestAuthHeader}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"auth_param_client_assertion\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.client_assertion}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"auth_param_client_assertion_type\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.client_assertion_type}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"auth_param_id\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.client_id}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"auth_param_secret\"/>\n                                <L7p:value stringValue=\"${request.http.parameter.client_secret}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_client_name\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_environment\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_expiration\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_scope\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_status\"/>\n                                <L7p:value stringValue=\"ENABLED\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"local_type\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"df04db76-9431-40b2-872f-dd0ab9727d19\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session Tracking\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"clientkey\"/>\n                                <L7p:value stringValue=\"{&quot;client_custom&quot;: ${client_custom}, &quot;client_key_custom&quot;: ${client_key_custom}}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"current_input\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"customer\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"mag\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"otk\"/>\n                                <L7p:value stringValue=\"{&quot;client_type&quot;: &quot;${client_type}&quot;,&quot;grant_type&quot;: &quot;${grant_type}&quot;}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"portal\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjbGllbnRfaWR9\"/>\n                        <L7p:VariableToSet stringValue=\"authenticated_client_id\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// authenticate client\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${requestAuthHeader}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item regex=\"included\">\n                                    <L7p:Pattern stringValue=\"^\\b[Bb][Aa][Ss][Ii][Cc]\\b\\s.+\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:AddHeader>\n                                <L7p:HeaderName stringValue=\"WWW-Authenticate\"/>\n                                <L7p:HeaderValue stringValue=\"Basic error=&quot;Invalid or missing credentials&quot;\"/>\n                                <L7p:Target target=\"RESPONSE\"/>\n                            </L7p:AddHeader>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"WWW-Authenticate\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"add header if necessary\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <L7p:TrueAssertion/>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"add header or continue\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code provided by previous assertion\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"${error.code}\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Client Authenticate\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//client authentication\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjbGllbnRfY3VzdG9tfQ==\"/>\n                    <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"client_custom_privileged\"/>\n                </L7p:SetVariable>\n                <L7p:EvaluateJsonPathExpressionV2>\n                    <L7p:Expression stringValue=\"privileged\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"client_custom_privileged\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"privileged\"/>\n                </L7p:EvaluateJsonPathExpressionV2>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${privileged.result}\"/>\n                    <L7p:Expression2 stringValue=\"true\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MzEy\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"apiPrefix\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"givenErrorCode\"/>\n                            <L7p:value stringValue=\"${error.code}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//verify given client is privileged to introspect token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2faae09c-ee5f-499a-85f4-c6e1c0f826d7\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK TRL Get\"/>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:DataType variableDataType=\"dateTime\"/>\n                    <L7p:DateOffsetExpression stringValue=\"\"/>\n                    <L7p:VariableToSet stringValue=\"now\"/>\n                </L7p:SetVariable>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"5c1850e6-d433-4a11-b754-8b30baa9d2e2\"/>\n                </L7p:Include>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHt0cmxfand0LmNvbXBhY3R9\"/>\n                    <L7p:ResponseContentType stringValue=\"application/jwt\"/>\n                </L7p:HardcodedResponse>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"//Fetch from DB\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MzEy\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"apiPrefix\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"givenErrorCode\"/>\n                            <L7p:value stringValue=\"${error.code}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//Generate TRL\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}