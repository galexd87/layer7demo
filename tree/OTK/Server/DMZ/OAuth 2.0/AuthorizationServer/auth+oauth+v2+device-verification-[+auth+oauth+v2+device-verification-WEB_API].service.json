{
  "goid": "cc1863dcc6f56bcbae9ab4c8b10f7ffe",
  "guid": "2ea65a73-b232-4a07-8913-a60a03de438d",
  "name": "auth/oauth/v2/device-verification",
  "resolutionPath": "/auth/oauth/v2/device-verification",
  "serviceType": "WEB_API",
  "checksum": "a6c0a5ee4f3dc934bb9f280775d8bc700834ae44",
  "enabled": true,
  "folderPath": "/OTK/Server/DMZ/OAuth 2.0/AuthorizationServer",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "PATCH",
    "DELETE",
    "HEAD",
    "OPTIONS",
    "OTHER"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "laxResolution": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== *** THIS POLICY IS OVERWRITTEN DURING AN UPGRADE ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== Be aware that custom configuration made in this policy is overwritten during a solution kit upgrade.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== However, the older version of the policy is kept in the history and can be referenced.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== After upgrade, manually merge customizations from the old version of the policy to the new version.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This policy prompts for the user code and verifies the given user code and updates device registration status\"/>\n        </L7p:CommentAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${gateway.otk.enable_auditing}\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"boolean\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"false\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AuditAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Audit the service policy execution\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:CustomizeErrorResponse>\n            <L7p:Content stringValue=\"${error.msg}\"/>\n            <L7p:ContentType stringValue=\"${content-type}\"/>\n            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Cache-Control\"/>\n                    <L7p:Value stringValue=\"no-store\"/>\n                </L7p:item>\n                <L7p:item nameValuePair=\"included\">\n                    <L7p:Key stringValue=\"Pragma\"/>\n                    <L7p:Value stringValue=\"no-cache\"/>\n                </L7p:item>\n            </L7p:ExtraHeaders>\n            <L7p:HttpStatus stringValue=\"${status}\"/>\n        </L7p:CustomizeErrorResponse>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"9f29a8bd-912e-40a5-a48c-3b6f8aa40ac6\"/>\n            <L7p:PolicyName stringValue=\"OTK Security Header Extension\"/>\n        </L7p:Include>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"will be overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"will be overridden in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2e6e2ef3-a36f-4548-a2c4-7b369b7ae184\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Variable Configuration\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"custom\"/>\n                    <L7p:value stringValue=\"\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"c21337ce-bf16-4f5f-96fc-fd3ab98f5f06\"/>\n            <L7p:PolicyName stringValue=\"#OTK Device Verification Configuration\"/>\n        </L7p:Include>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:SslAssertion>\n                <L7p:RequireClientAuthentication booleanValue=\"true\"/>\n            </L7p:SslAssertion>\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"47f768f4-b478-472b-a1ee-10f4b6e76f99\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Require SSL (with Client Certificate)\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireClientCert\"/>\n                        <L7p:value stringValue=\"false\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Check for SSL\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"POST GET\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b8822449-71ff-455b-8f10-39122e6c549b\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK HTTP Method Validation\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"method\"/>\n                        <L7p:value stringValue=\"POST|GET|OPTIONS\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"content\"/>\n                            <L7p:value stringValue=\"${errorDetail}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"error.content\"/>\n                            <L7p:value stringValue=\"${error.msg}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"new.content\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"other\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"task\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Method\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Checking the HTTP method\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lm1haW5wYXJ0fSR7cmVxdWVzdC51cmx9\"/>\n                    <L7p:VariableToSet stringValue=\"requestUrl\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2be8eaf2-9b42-4173-ace9-3fdb471fb407\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"API XSS Protection\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allinput\"/>\n                            <L7p:value stringValue=\"${request.mainpart}${request.url}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:Regex>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Extra check for quotes/brackets\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:CaseInsensitive booleanValue=\"true\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"request.url\"/>\n                    <L7p:ProceedIfPatternMatches booleanValue=\"false\"/>\n                    <L7p:Regex stringValue=\"(%22|[&quot;]|%29|\\(|%28|\\))\"/>\n                    <L7p:RegexName stringValue=\"Validate URL input\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"json response\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"return json error response\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"error.content\"/>\n                            <L7p:value stringValue=\"${error.msg}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"new.content\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"other\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"task\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:FalseAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"return false\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"stop processing the whole policy\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                </L7p:FalseAssertion>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// XSS Protection\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// optional\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"bac17a37-0b06-47fd-910c-4faced9489c3\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK CORS\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"{&quot;url_path_query&quot;:&quot;${request.url.path}${request.url.query}&quot;, &quot;http_method_allowed&quot;: &quot;${http_method_allowed}&quot;}\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"requireCORS\"/>\n                        <L7p:value stringValue=\"optional\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// error code produced in previous assertion\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"givenErrorCode\"/>\n                        <L7p:value stringValue=\"${error.code}\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"CORS\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Check for CORS\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFjdGlvbn0=\"/>\n            <L7p:VariableToSet stringValue=\"action\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnVzZXJfY29kZX0=\"/>\n            <L7p:VariableToSet stringValue=\"usercode\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25JRH0=\"/>\n            <L7p:VariableToSet stringValue=\"sessionID\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlc3Npb25EYXRhfQ==\"/>\n            <L7p:VariableToSet stringValue=\"sessionDataJWT\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHthY3Rpb259\"/>\n            <L7p:VariableToSet stringValue=\"original_action\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"sub_action\"/>\n        </L7p:SetVariable>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Override the below config &amp; remove setting this within #OTK Third Party Configuration to support specific redirect uri for Device TP login\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Optional\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Ensure, the redirection from the third party OIDC happens to the OTK authorization login endpoint\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06JHtnYXRld2F5Lm90ay5wb3J0fS9hdXRoL29hdXRoL3YyL2RldmljZS12ZXJpZmljYXRpb24=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.redirect_uri\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Optional\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValueReference=\"inline\"><![CDATA[Override this here & remove setting this within #OTK Third Party Configuration to support specific redirect uri for OIDC TP login\nRetrieve third party OIDC client_id (either hard code the value here, or use OTK client custom column)]]></L7p:value>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfT0lEQ19DTElFTlRfSUQ=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.client_id\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Optional\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Retrieve third party OIDC client_secret (DO NOT hard-code the value here, try retrieving it from secure passwords, i.e., ${secpass.third_party_oidc_client_secret.plaintext})\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfQ0xJRU5UX1NFQ1JFVA==\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.client_secret\"/>\n        </L7p:SetVariable>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================================\"/>\n        </L7p:CommentAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${action}\"/>\n                <L7p:Expression2 stringValue=\"login\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"login\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:HtmlFormDataAssertion>\n                        <L7p:AllowGet booleanValue=\"true\"/>\n                        <L7p:AllowPost booleanValue=\"true\"/>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"local\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// the resource_owner authenticated against the local IDP\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:FieldSpecs htmlFormFieldSpecArray=\"included\">\n                            <L7p:item htmlFormFieldSpec=\"included\">\n                                <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                <L7p:DataType fieldDataType=\"any\"/>\n                                <L7p:MaxOccurs intValue=\"1\"/>\n                                <L7p:MinOccurs intValue=\"1\"/>\n                                <L7p:Name stringValue=\"sessionData\"/>\n                            </L7p:item>\n                            <L7p:item htmlFormFieldSpec=\"included\">\n                                <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                <L7p:DataType fieldDataType=\"any\"/>\n                                <L7p:MaxOccurs intValue=\"1\"/>\n                                <L7p:MinOccurs intValue=\"1\"/>\n                                <L7p:Name stringValue=\"sessionID\"/>\n                            </L7p:item>\n                        </L7p:FieldSpecs>\n                    </L7p:HtmlFormDataAssertion>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"3001\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"103\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Parameters\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Check for duplicate parameters in the request\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${action}\"/>\n                            <L7p:Expression2 stringValue=\"login\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:RightValue stringValue=\"login\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:DecodeJsonWebToken>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"decrypt\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:SignatureSecret stringValue=\"${otk_session_secret_encryption}\"/>\n                            <L7p:SourcePayload stringValue=\"${sessionDataJWT}\"/>\n                            <L7p:TargetVariablePrefix stringValue=\"sessionData\"/>\n                            <L7p:ValidationType stringValue=\"Using Secret\"/>\n                        </L7p:DecodeJsonWebToken>\n                        <L7p:DecodeJsonWebToken>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validate signature\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:SignatureSecret stringValue=\"${otk_session_secret}\"/>\n                            <L7p:SourcePayload stringValue=\"${sessionData.plaintext}\"/>\n                            <L7p:TargetVariablePrefix stringValue=\"sessionData\"/>\n                            <L7p:ValidationType stringValue=\"Using Secret\"/>\n                        </L7p:DecodeJsonWebToken>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${action}\"/>\n                            <L7p:Expression2 stringValue=\"login\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"login\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:DecodeJsonWebToken>\n                            <L7p:SignatureSecret stringValue=\"${otk_session_secret}\"/>\n                            <L7p:SourcePayload stringValue=\"${sessionDataJWT}\"/>\n                            <L7p:TargetVariablePrefix stringValue=\"sessionData\"/>\n                            <L7p:ValidationType stringValue=\"Using Secret\"/>\n                        </L7p:DecodeJsonWebToken>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"//before login, the sessionData is only signed\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:ComparisonAssertion>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Verify the signature validation result\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${sessionData.valid}\"/>\n                    <L7p:Expression2 stringValue=\"true\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uRGF0YS5wYXlsb2FkfQ==\"/>\n                    <L7p:ContentType stringValue=\"application/json;charset=UTF-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"sessionData\"/>\n                </L7p:SetVariable>\n                <L7p:EvaluateJsonPathExpression>\n                    <L7p:Expression stringValue=\"sessionID\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"sessionIDJWT\"/>\n                </L7p:EvaluateJsonPathExpression>\n                <L7p:EvaluateJsonPathExpression>\n                    <L7p:Expression stringValue=\"exp\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"expJWT\"/>\n                </L7p:EvaluateJsonPathExpression>\n                <L7p:EvaluateJsonPathExpression>\n                    <L7p:Expression stringValue=\"current_username\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"user\"/>\n                </L7p:EvaluateJsonPathExpression>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHt1c2VyLnJlc3VsdH0=\"/>\n                    <L7p:VariableToSet stringValue=\"current.username\"/>\n                </L7p:SetVariable>\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${sessionID}\"/>\n                    <L7p:Expression2 stringValue=\"${sessionIDJWT.result}\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"${sessionIDJWT.result}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${expJWT.result}\"/>\n                    <L7p:Expression2 stringValue=\"${gateway.time.seconds}\"/>\n                    <L7p:Operator operator=\"GE\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"GE\"/>\n                            <L7p:RightValue stringValue=\"${gateway.time.seconds}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"sessionID\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Make sure the session is still available\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheAge\"/>\n                            <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheId\"/>\n                            <L7p:value stringValue=\"${cacheName}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"cacheKey\"/>\n                            <L7p:value stringValue=\"${sessionID}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:ResponseXpathAssertion>\n                    <L7p:VariablePrefix stringValue=\"sessionValue\"/>\n                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"ns\"/>\n                                <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                        <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                    </L7p:XpathExpression>\n                </L7p:ResponseXpathAssertion>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                        <L7p:VariableToSet stringValue=\"hasSession\"/>\n                    </L7p:SetVariable>\n                    <L7p:EncodeDecode>\n                        <L7p:SourceVariableName stringValue=\"sessionValue.result\"/>\n                        <L7p:TargetDataType variableDataType=\"string\"/>\n                        <L7p:TargetVariableName stringValue=\"decoded\"/>\n                        <L7p:TransformType transformType=\"URL_DECODE\"/>\n                    </L7p:EncodeDecode>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtkZWNvZGVkfQ==\"/>\n                        <L7p:ContentType stringValue=\"text/xml;charset=UTF-8\"/>\n                        <L7p:DataType variableDataType=\"message\"/>\n                        <L7p:VariableToSet stringValue=\"grantedContent\"/>\n                    </L7p:SetVariable>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"orgRequestUrl\"/>\n                                <L7p:XmlMsgSrc stringValue=\"grantedContent\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/authorize/requestUrl/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtvcmdSZXF1ZXN0VXJsLnJlc3VsdH0=\"/>\n                                <L7p:VariableToSet stringValue=\"encodedRequestUrl\"/>\n                            </L7p:SetVariable>\n                            <L7p:EncodeDecode>\n                                <L7p:SourceVariableName stringValue=\"encodedRequestUrl\"/>\n                                <L7p:TargetDataType variableDataType=\"string\"/>\n                                <L7p:TargetVariableName stringValue=\"originalRequestUrl\"/>\n                                <L7p:TransformType transformType=\"URL_DECODE\"/>\n                            </L7p:EncodeDecode>\n                        </wsp:All>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtkZXZpY2VfdmVyaWZpY2F0aW9uX3VybH0=\"/>\n                            <L7p:VariableToSet stringValue=\"originalRequestUrl\"/>\n                        </L7p:SetVariable>\n                    </wsp:OneOrMore>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"authorizeUsercode\"/>\n                                <L7p:XmlMsgSrc stringValue=\"grantedContent\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/authorize/usercode/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHthdXRob3JpemVVc2VyY29kZS5yZXN1bHR9\"/>\n                                <L7p:VariableToSet stringValue=\"sessionUsercode\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"\"/>\n                            <L7p:VariableToSet stringValue=\"sessionUsercode\"/>\n                        </L7p:SetVariable>\n                    </wsp:OneOrMore>\n                </wsp:All>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:VariableToSet stringValue=\"action\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Session\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Use an existing session\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:HtmlFormDataAssertion>\n                    <L7p:AllowGet booleanValue=\"true\"/>\n                    <L7p:AllowPost booleanValue=\"true\"/>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Thrid Party Login\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:FieldSpecs htmlFormFieldSpecArray=\"included\">\n                        <L7p:item htmlFormFieldSpec=\"included\">\n                            <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                            <L7p:DataType fieldDataType=\"any\"/>\n                            <L7p:MaxOccurs intValue=\"1\"/>\n                            <L7p:MinOccurs intValue=\"1\"/>\n                            <L7p:Name stringValue=\"code\"/>\n                        </L7p:item>\n                        <L7p:item htmlFormFieldSpec=\"included\">\n                            <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                            <L7p:DataType fieldDataType=\"any\"/>\n                            <L7p:MaxOccurs intValue=\"1\"/>\n                            <L7p:MinOccurs intValue=\"1\"/>\n                            <L7p:Name stringValue=\"state\"/>\n                        </L7p:item>\n                    </L7p:FieldSpecs>\n                </L7p:HtmlFormDataAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"bG9naW4=\"/>\n                    <L7p:VariableToSet stringValue=\"action\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Y29kZQ==\"/>\n                    <L7p:VariableToSet stringValue=\"subAction\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Require code and state\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:TrueAssertion/>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Third Party\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${original_action}\"/>\n                <L7p:Expression2 stringValue=\"login\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"login\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${original_action}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${current.username}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                    <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                </L7p:Include>\n            </wsp:All>\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"givenErrorCode\"/>\n                        <L7p:value stringValue=\"${error.code}\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Rate Limit\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${action}\"/>\n                        <L7p:Expression2 stringValue=\"login\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"login\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// a redirect from third party wont have action\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${sub_action}\"/>\n                        <L7p:Expression2 stringValue=\"login\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"login\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                </wsp:All>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${sessionID}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheAge\"/>\n                                <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheId\"/>\n                                <L7p:value stringValue=\"${cacheName}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheKey\"/>\n                                <L7p:value stringValue=\"${sessionID}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheMaxSize\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:UUIDGenerator>\n                            <L7p:MaximumQuantity intValue=\"2\"/>\n                            <L7p:Quantity stringValue=\"2\"/>\n                            <L7p:TargetVariable stringValue=\"sessionID\"/>\n                        </L7p:UUIDGenerator>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"\"/>\n                            <L7p:DataType variableDataType=\"dateTime\"/>\n                            <L7p:DateOffsetExpression stringValue=\"${session.lifetime.s}\"/>\n                            <L7p:VariableToSet stringValue=\"exp\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"ew0KICAgICJzZXNzaW9uSUQiOiIke3Nlc3Npb25JRFswXX0iLA0KICAgICJleHAiOiR7ZXhwLnNlY29uZHN9LA0KICAgICJjdXJyZW50X3VzZXJuYW1lIjoiIiwNCiAgICAiY3VycmVudF91c2VyX2NvbnNlbnQiOiJub25lIiwNCiAgICAiY3VycmVudF91c2VyX3JvbGUiOiIiLA0KICAgICJjdXJyZW50X3VzZXJfYWNyIjoiMCIsDQogICAgImN1cnJlbnRfdXNlcl9hdXRoVGltZSI6IjAiLA0KICAgICJzYWx0IjoiIiwNCiAgICAidGhpcmRfcGFydHlfc3NvX3Rva2VuIjoiIiwNCiAgICAidGhpcmRfcGFydHlfc3NvX3Rva2VuX3R5cGUiOiIiDQp9\"/>\n                            <L7p:VariableToSet stringValue=\"session\"/>\n                        </L7p:SetVariable>\n                        <L7p:EncodeJsonWebToken>\n                            <L7p:SignPayload booleanValue=\"true\"/>\n                            <L7p:SignatureAlgorithm stringValue=\"HS256\"/>\n                            <L7p:SignatureSecretKey stringValue=\"${otk_session_secret}\"/>\n                            <L7p:SourceVariable stringValue=\"${session}\"/>\n                            <L7p:TargetVariable stringValue=\"jwt_session\"/>\n                        </L7p:EncodeJsonWebToken>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"request.url\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"encodedRequestUrl\"/>\n                            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Mobile SSO extension included\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"PGF1dGhvcml6ZT4NCiAgICA8dXNlcmNvZGU+JHt1c2VyY29kZX08L3VzZXJjb2RlPg0KICAgIDxyZXF1ZXN0VXJsPiR7ZW5jb2RlZFJlcXVlc3RVcmx9PC9yZXF1ZXN0VXJsPg0KICAgIDxzZXNzaW9uPiR7c2Vzc2lvbklEWzFdfTwvc2Vzc2lvbj4NCiAgICA8c2Vzc2lvbkRhdGE+JHtqd3Rfc2Vzc2lvbi5jb21wYWN0fTwvc2Vzc2lvbkRhdGE+DQo8L2F1dGhvcml6ZT4=\"/>\n                            <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID[0]}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"dbAge\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"value\"/>\n                                    <L7p:value stringValue=\"${sessionValue}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uSURbMF19\"/>\n                            <L7p:VariableToSet stringValue=\"sessionID\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtqd3Rfc2Vzc2lvbi5jb21wYWN0fQ==\"/>\n                            <L7p:VariableToSet stringValue=\"sessionDataJWT\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Include>\n                                    <L7p:PolicyGuid stringValue=\"a45e324c-eb67-43fc-81da-c34c16937214\"/>\n                                    <L7p:PolicyName stringValue=\"#OTK Third Party Configuration\"/>\n                                </L7p:Include>\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${third_party_oidc_provider}\"/>\n                                    <L7p:Expression2 stringValue=\"THIRD_PARTY_OIDC_PROVIDER\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:RightValue stringValue=\"THIRD_PARTY_OIDC_PROVIDER\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:HardcodedResponse>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"302\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:ResponseContentType stringValue=\"text/plain; charset=UTF-8\"/>\n                                    <L7p:ResponseStatus stringValue=\"302\"/>\n                                </L7p:HardcodedResponse>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"Pragma\"/>\n                                    <L7p:HeaderValue stringValue=\"no-cache\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                                    <L7p:HeaderValue stringValue=\"no-store\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:Include>\n                                    <L7p:PolicyGuid stringValue=\"ca804e07-62fd-491d-8a21-90e0fd6699ea\"/>\n                                    <L7p:PolicyName stringValue=\"#OTK Third Party Authentication\"/>\n                                </L7p:Include>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"redirect to third party\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${newContent}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"login\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:HardcodedResponse>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:Base64ResponseBody stringValue=\"JHtjb250ZW50fQ==\"/>\n                                    <L7p:ResponseContentType stringValue=\"${content-type}\"/>\n                                </L7p:HardcodedResponse>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"return default prompt\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                        </wsp:OneOrMore>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                <L7p:VariableToSet stringValue=\"error.code\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error code message\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                                    <L7p:VariableToSet stringValue=\"error.msg\"/>\n                                </L7p:SetVariable>\n                            </wsp:OneOrMore>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.msg\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                            <L7p:VariableToSet stringValue=\"erro.msg\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                            <L7p:VariableToSet stringValue=\"content-type\"/>\n                        </L7p:SetVariable>\n                        <L7p:AuditDetailAssertion>\n                            <L7p:Detail stringValue=\"error.code: '${error.code}', error.msg: ${error.msg}\"/>\n                        </L7p:AuditDetailAssertion>\n                        <L7p:FalseAssertion/>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"create an error response\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Pragma\"/>\n                    <L7p:HeaderValue stringValue=\"no-cache\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:AddHeader>\n                    <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                    <L7p:HeaderValue stringValue=\"no-store\"/>\n                    <L7p:Target target=\"RESPONSE\"/>\n                </L7p:AddHeader>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Initial call\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"login\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"login\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${subAction}\"/>\n                    <L7p:Expression2 stringValue=\"code\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"code\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnByb3ZpZGVyfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"provider\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnN0YXRlfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"sessionID\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmNvZGV9\"/>\n                        <L7p:VariableToSet stringValue=\"code\"/>\n                    </L7p:SetVariable>\n                    <L7p:Include>\n                        <L7p:PolicyGuid stringValue=\"ddc12b1f-ade6-4279-b3ba-0f9adeef4211\"/>\n                        <L7p:PolicyName stringValue=\"#OTK Third Party Login Auth Code Verification\"/>\n                    </L7p:Include>\n                    <L7p:EvaluateJsonPathExpression>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Optional\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"//extract username from JWT\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Expression stringValue=\"name\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"third_party_login_profile\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                        <L7p:VariablePrefix stringValue=\"username\"/>\n                    </L7p:EvaluateJsonPathExpression>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt1c2VybmFtZS5yZXN1bHR9\"/>\n                        <L7p:VariableToSet stringValue=\"current.username\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt1c2VyYWNyLnJlc3VsdH0=\"/>\n                        <L7p:VariableToSet stringValue=\"current.user.acr\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyaXNrc2NvcmUucmVzdWx0fQ==\"/>\n                        <L7p:VariableToSet stringValue=\"riskscore\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjdXJyZW50LnVzZXJuYW1lfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"resource_owner\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjdXJyZW50LnVzZXJuYW1lfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"salt\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtnYXRld2F5LnRpbWUuc2Vjb25kc30=\"/>\n                        <L7p:VariableToSet stringValue=\"current.user.authTime\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjdXJyZW50LnVzZXIucm9sZX0=\"/>\n                        <L7p:VariableToSet stringValue=\"resource_owner_role\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHthdC5yZXN1bHR9\"/>\n                        <L7p:VariableToSet stringValue=\"third_party_sso_token\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt0aGlyZF9wYXJ0eV9vaWRjX3Byb3ZpZGVyfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"third_party_sso_token_type\"/>\n                    </L7p:SetVariable>\n                    <L7p:Include>\n                        <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                        <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                    </L7p:Include>\n                    <L7p:EncodeDecode>\n                        <L7p:SourceVariableName stringValue=\"current.user.acr\"/>\n                        <L7p:TargetDataType variableDataType=\"string\"/>\n                        <L7p:TargetVariableName stringValue=\"current.user.acr\"/>\n                        <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                    </L7p:EncodeDecode>\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"sessionID\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Make sure the session is still available\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheAge\"/>\n                                <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheId\"/>\n                                <L7p:value stringValue=\"${cacheName}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cacheKey\"/>\n                                <L7p:value stringValue=\"${sessionID}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"sessionValue\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                            <L7p:VariableToSet stringValue=\"hasSession\"/>\n                        </L7p:SetVariable>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"sessionValue.result\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"decoded\"/>\n                            <L7p:TransformType transformType=\"URL_DECODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtkZWNvZGVkfQ==\"/>\n                            <L7p:ContentType stringValue=\"text/xml;charset=UTF-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"grantedContent\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"orgRequestUrl\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"grantedContent\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/authorize/requestUrl/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                </L7p:ResponseXpathAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtvcmdSZXF1ZXN0VXJsLnJlc3VsdH0=\"/>\n                                    <L7p:VariableToSet stringValue=\"encodedRequestUrl\"/>\n                                </L7p:SetVariable>\n                                <L7p:EncodeDecode>\n                                    <L7p:SourceVariableName stringValue=\"encodedRequestUrl\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n                                    <L7p:TargetVariableName stringValue=\"originalRequestUrl\"/>\n                                    <L7p:TransformType transformType=\"URL_DECODE\"/>\n                                </L7p:EncodeDecode>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtkZXZpY2VfdmVyaWZpY2F0aW9uX3VybH0=\"/>\n                                <L7p:VariableToSet stringValue=\"originalRequestUrl\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"authorizeUsercode\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"grantedContent\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/authorize/usercode/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                </L7p:ResponseXpathAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHthdXRob3JpemVVc2VyY29kZS5yZXN1bHR9\"/>\n                                    <L7p:VariableToSet stringValue=\"sessionUsercode\"/>\n                                </L7p:SetVariable>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"\"/>\n                                <L7p:VariableToSet stringValue=\"sessionUsercode\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                    </wsp:All>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"\"/>\n                                <L7p:DataType variableDataType=\"dateTime\"/>\n                                <L7p:DateOffsetExpression stringValue=\"${session.lifetime.s}\"/>\n                                <L7p:VariableToSet stringValue=\"exp\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"ew0KICAgICJzZXNzaW9uSUQiOiIke3Nlc3Npb25JRH0iLA0KICAgICJleHAiOiR7ZXhwLnNlY29uZHN9LA0KICAgICJjdXJyZW50X3VzZXJuYW1lIjoiJHtjdXJyZW50LnVzZXJuYW1lfSIsDQogICAgImN1cnJlbnRfdXNlcl9jb25zZW50IjoiIiwNCiAgICAiY3VycmVudF91c2VyX3JvbGUiOiIke3Jlc291cmNlX293bmVyX3JvbGV9IiwNCiAgICAiY3VycmVudF91c2VyX2FjciI6IiR7dXNlcmFjci5yZXN1bHR9IiwNCiAgICAiY3VycmVudF91c2VyX2F1dGhUaW1lIjoiJHtjdXJyZW50LnVzZXIuYXV0aFRpbWV9IiwNCiAgICAic2FsdCI6IiR7c2FsdH0iLA0KICAgICJ0aGlyZF9wYXJ0eV9zc29fdG9rZW4iOiIke3RoaXJkX3BhcnR5X3Nzb190b2tlbn0iLA0KICAgICJ0aGlyZF9wYXJ0eV9zc29fdG9rZW5fdHlwZSI6IiR7dGhpcmRfcGFydHlfc3NvX3Rva2VuX3R5cGV9Ig0KfQ==\"/>\n                                <L7p:VariableToSet stringValue=\"session\"/>\n                            </L7p:SetVariable>\n                            <L7p:EncodeJsonWebToken>\n                                <L7p:ContentEncryptionAlgorithm stringValue=\"A128CBC-HS256\"/>\n                                <L7p:EncryptPayload booleanValue=\"true\"/>\n                                <L7p:EncryptionSecret stringValue=\"${otk_session_secret_encryption}\"/>\n                                <L7p:KeyManagementAlgorithm stringValue=\"dir\"/>\n                                <L7p:SignPayload booleanValue=\"true\"/>\n                                <L7p:SignatureAlgorithm stringValue=\"HS256\"/>\n                                <L7p:SignatureSecretKey stringValue=\"${otk_session_secret}\"/>\n                                <L7p:SourceVariable stringValue=\"${session}\"/>\n                                <L7p:TargetVariable stringValue=\"jwt_session\"/>\n                            </L7p:EncodeJsonWebToken>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"PGF1dGhvcml6ZT4NCiAgICA8dXNlcmNvZGU+JHtzZXNzaW9uVXNlcmNvZGV9PC91c2VyY29kZT4NCiAgICA8cmVxdWVzdFVybD4ke2VuY29kZWRSZXF1ZXN0VXJsfTwvcmVxdWVzdFVybD4NCiAgICA8c2Vzc2lvbj4ke3Nlc3Npb25JRH08L3Nlc3Npb24+DQogICAgPHNlc3Npb25EYXRhPiR7and0X3Nlc3Npb24uY29tcGFjdH08L3Nlc3Npb25EYXRhPg0KPC9hdXRob3JpemU+\"/>\n                                <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                            </L7p:SetVariable>\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID[0]}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"dbAge\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"value\"/>\n                                    <L7p:value stringValue=\"${sessionValue}\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtqd3Rfc2Vzc2lvbi5jb21wYWN0fQ==\"/>\n                                <L7p:VariableToSet stringValue=\"sessionDataJWT\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                </L7p:SetVariable>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:OneOrMore>\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${error.msg}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:Encapsulated>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error code message\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                                    <L7p:VariableToSet stringValue=\"error.msg\"/>\n                                    </L7p:SetVariable>\n                                </wsp:OneOrMore>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error.msg\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:OneOrMore>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                                <L7p:VariableToSet stringValue=\"erro.msg\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n                                <L7p:VariableToSet stringValue=\"content-type\"/>\n                            </L7p:SetVariable>\n                            <L7p:AuditDetailAssertion>\n                                <L7p:Detail stringValue=\"error.code: '${error.code}', error.msg: ${error.msg}\"/>\n                            </L7p:AuditDetailAssertion>\n                            <L7p:FalseAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"create an error response\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"create a new session with available information\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${sessionUsercode}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"dXNlcmNvZGU=\"/>\n                                <L7p:VariableToSet stringValue=\"action_next\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"dmVyaWZ5\"/>\n                            <L7p:VariableToSet stringValue=\"action_next\"/>\n                        </L7p:SetVariable>\n                    </wsp:OneOrMore>\n                    <L7p:HardcodedResponse>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Auto-Form-Post\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64ResponseBody stringValue=\"PGh0bWw+CjxIRUFEPgogICAgPE1FVEEgSFRUUC1FUVVJVj0nUFJBR01BJyBDT05URU5UPSdOTy1DQUNIRSc+CiAgICA8TUVUQSBIVFRQLUVRVUlWPSdDQUNIRS1DT05UUk9MJyBDT05URU5UPSdOTy1DQUNIRSc+CiAgICA8VElUTEU+TG9naW4gQXV0by1QT1NUIGZvcm08L1RJVExFPjwvSEVBRD4KPGJvZHkgb25Mb2FkPSJkb2N1bWVudC5mb3Jtc1swXS5zdWJtaXQoKSI+CjxOT1NDUklQVD5Zb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBKYXZhU2NyaXB0LiBQbGVhc2UgY2xpY2sgdGhlICdDb250aW51ZScgYnV0dG9uIGJlbG93IHRvIHByb2NlZWQuPC9OT1NDUklQVD48YnIvPgo8Zm9ybSBhY3Rpb249IiR7b3JpZ2luYWxSZXF1ZXN0VXJsfSIgbWV0aG9kPSJQT1NUIiBlbmN0eXBlPSJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iJHthY3Rpb25fbmV4dH0iPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2Vzc2lvbklEIiB2YWx1ZT0iJHtzZXNzaW9uSUR9Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InNlc3Npb25EYXRhIiB2YWx1ZT0iJHtqd3Rfc2Vzc2lvbi5jb21wYWN0fSI+CiAgICA8Tk9TQ1JJUFQ+PElOUFVUIFRZUEU9IlNVQk1JVCIgVkFMVUU9IkNvbnRpbnVlIj48L05PU0NSSVBUPgo8L2Zvcm0+CjwvYm9keT4KPC9odG1sPg==\"/>\n                        <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                    </L7p:HardcodedResponse>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"eyAgDQogICAiY3VycmVudCI6eyAgDQogICAgICAidXNlcm5hbWUiOiIke2N1cnJlbnQudXNlcm5hbWV9IiwNCiAgICAgICJ1c2VyIjp7ICANCiAgICAgICAgICJyb2xlIjoiJHtyZXNvdXJjZV9vd25lcl9yb2xlfSIsDQogICAgICAgICAiYXV0aFRpbWUiOiR7Y3VycmVudC51c2VyLmF1dGhUaW1lfQ0KICAgICAgfQ0KICAgfQ0KfQ==\"/>\n                        <L7p:VariableToSet stringValue=\"cookieValue\"/>\n                    </L7p:SetVariable>\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b79ebaf7-acff-4eac-8d48-61b90bf597cb\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cookie Management\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cookie\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cookieName\"/>\n                                <L7p:value stringValue=\"sessionCookie\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"cookieValue\"/>\n                                <L7p:value stringValue=\"${cookieValue}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"lifetime\"/>\n                                <L7p:value stringValue=\"3600\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"task\"/>\n                                <L7p:value stringValue=\"true\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:AddHeader>\n                        <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                        <L7p:HeaderValue stringValue=\"${setCookie}\"/>\n                        <L7p:Target target=\"RESPONSE\"/>\n                    </L7p:AddHeader>\n                    <L7p:AddHeader>\n                        <L7p:HeaderName stringValue=\"Pragma\"/>\n                        <L7p:HeaderValue stringValue=\"no-cache\"/>\n                        <L7p:Target target=\"RESPONSE\"/>\n                    </L7p:AddHeader>\n                    <L7p:AddHeader>\n                        <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                        <L7p:HeaderValue stringValue=\"no-store\"/>\n                        <L7p:Target target=\"RESPONSE\"/>\n                    </L7p:AddHeader>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// auth_code verification &amp; prepare consent request\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Third Party\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"login\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"login\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"27196c5d-a37a-4ee3-a24a-01615c2e1bb1\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK User Authentication\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"acrValuesEssential\"/>\n                                    <L7p:value stringValue=\"${acr_values_essential}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"acrValuesRequested\"/>\n                                    <L7p:value stringValue=\"${acr_values}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"authHeader\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"authIdToken\"/>\n                                    <L7p:value stringValue=\"${id_token_hint}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"authSession\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"clientId\"/>\n                                    <L7p:value stringValue=\"${clientIdJWT.result}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cookie\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cookiename\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"maxAge\"/>\n                                    <L7p:value stringValue=\"${maxAge.result}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"oauth_token\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.oauth_token}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"oauth_verifier\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.oauth_verifier}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"password\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.password}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"prompt\"/>\n                                    <L7p:value stringValue=\"${prompt}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"provider\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.provider}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"state\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"username\"/>\n                                    <L7p:value stringValue=\"${request.http.parameter.username}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50LnVzZXJuYW1lfQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"resource_owner\"/>\n                                </L7p:SetVariable>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtjdXJyZW50LnVzZXIucm9sZX0=\"/>\n                                    <L7p:VariableToSet stringValue=\"resource_owner_role\"/>\n                                </L7p:SetVariable>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"authenticate\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"MjAy\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                </L7p:SetVariable>\n                                <L7p:FalseAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// login required\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"User authentication\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                            <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                        </L7p:Include>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uRGF0YS5tYWlucGFydH0=\"/>\n                            <L7p:VariableToSet stringValue=\"sessionData\"/>\n                        </L7p:SetVariable>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"current.user.acr\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"current.user.acr\"/>\n                            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                        </L7p:EncodeDecode>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"current_user_consent&quot;:[\\s]?&quot;none&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"current_user_consent&quot;:&quot;${consent}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"current_username&quot;:[\\s]?&quot;&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"current_username&quot;:&quot;${resource_owner}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"current_user_role&quot;:[\\s]?&quot;&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"current_user_role&quot;:&quot;${resource_owner_role}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"current_user_acr&quot;:[\\s]?&quot;0&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"current_user_acr&quot;:&quot;${current.user.acr}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"current_user_authTime&quot;:[\\s]?&quot;0&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"current_user_authTime&quot;:&quot;${current.user.authTime}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"salt&quot;:[\\s]?&quot;&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"salt&quot;:&quot;${salt}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"third_party_sso_token&quot;:[\\s]?&quot;&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"third_party_sso_token&quot;:&quot;${third_party_sso_token}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:Regex>\n                                <L7p:AutoTarget booleanValue=\"false\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                                <L7p:Regex stringValue=\"third_party_sso_token_type&quot;:[\\s]?&quot;&quot;\"/>\n                                <L7p:Replace booleanValue=\"true\"/>\n                                <L7p:Replacement stringValue=\"third_party_sso_token_type&quot;:&quot;${third_party_sso_token_type}&quot;\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                            </L7p:Regex>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Update\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Update session data\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <L7p:EncodeJsonWebToken>\n                            <L7p:ContentEncryptionAlgorithm stringValue=\"A128CBC-HS256\"/>\n                            <L7p:EncryptPayload booleanValue=\"true\"/>\n                            <L7p:EncryptionSecret stringValue=\"${otk_session_secret_encryption}\"/>\n                            <L7p:KeyManagementAlgorithm stringValue=\"dir\"/>\n                            <L7p:SignPayload booleanValue=\"true\"/>\n                            <L7p:SignatureAlgorithm stringValue=\"HS256\"/>\n                            <L7p:SignatureSecretKey stringValue=\"${otk_session_secret}\"/>\n                            <L7p:SourceVariable stringValue=\"${sessionData}\"/>\n                            <L7p:TargetVariable stringValue=\"jwt_session\"/>\n                        </L7p:EncodeJsonWebToken>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:Expression1 stringValue=\"${sessionUsercode}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"dXNlcmNvZGU=\"/>\n                                    <L7p:VariableToSet stringValue=\"action_next\"/>\n                                </L7p:SetVariable>\n                            </wsp:All>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"dmVyaWZ5\"/>\n                                <L7p:VariableToSet stringValue=\"action_next\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Auto-Form-Post\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"PGh0bWw+CjxIRUFEPgogICAgPE1FVEEgSFRUUC1FUVVJVj0nUFJBR01BJyBDT05URU5UPSdOTy1DQUNIRSc+CiAgICA8TUVUQSBIVFRQLUVRVUlWPSdDQUNIRS1DT05UUk9MJyBDT05URU5UPSdOTy1DQUNIRSc+CiAgICA8VElUTEU+TG9naW4gQXV0by1QT1NUIGZvcm08L1RJVExFPjwvSEVBRD4KPGJvZHkgb25Mb2FkPSJkb2N1bWVudC5mb3Jtc1swXS5zdWJtaXQoKSI+CjxOT1NDUklQVD5Zb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBKYXZhU2NyaXB0LiBQbGVhc2UgY2xpY2sgdGhlICdDb250aW51ZScgYnV0dG9uIGJlbG93IHRvIHByb2NlZWQuPC9OT1NDUklQVD48YnIvPgo8Zm9ybSBhY3Rpb249IiR7b3JpZ2luYWxSZXF1ZXN0VXJsfSIgbWV0aG9kPSJQT1NUIiBlbmN0eXBlPSJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYWN0aW9uIiB2YWx1ZT0iJHthY3Rpb25fbmV4dH0iPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2Vzc2lvbklEIiB2YWx1ZT0iJHtzZXNzaW9uSUR9Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InNlc3Npb25EYXRhIiB2YWx1ZT0iJHtqd3Rfc2Vzc2lvbi5jb21wYWN0fSI+CiAgICA8Tk9TQ1JJUFQ+PElOUFVUIFRZUEU9IlNVQk1JVCIgVkFMVUU9IkNvbnRpbnVlIj48L05PU0NSSVBUPgo8L2Zvcm0+CjwvYm9keT4KPC9odG1sPg==\"/>\n                            <L7p:ResponseContentType stringValue=\"text/html;charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"eyAgDQogICAiY3VycmVudCI6eyAgDQogICAgICAidXNlcm5hbWUiOiIke2N1cnJlbnQudXNlcm5hbWV9IiwNCiAgICAgICJ1c2VyIjp7ICANCiAgICAgICAgICJyb2xlIjoiJHtjdXJyZW50LnVzZXIucm9sZX0iLA0KICAgICAgICAgImF1dGhUaW1lIjoke2N1cnJlbnQudXNlci5hdXRoVGltZX0NCiAgICAgIH0NCiAgIH0NCn0=\"/>\n                            <L7p:VariableToSet stringValue=\"cookieValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b79ebaf7-acff-4eac-8d48-61b90bf597cb\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cookie Management\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookie\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieName\"/>\n                                    <L7p:value stringValue=\"sessionCookie\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieValue\"/>\n                                    <L7p:value stringValue=\"${cookieValue}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"lifetime\"/>\n                                    <L7p:value stringValue=\"3600\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:AddHeader>\n                            <L7p:HeaderName stringValue=\"Set-Cookie\"/>\n                            <L7p:HeaderValue stringValue=\"${setCookie}\"/>\n                            <L7p:Target target=\"RESPONSE\"/>\n                        </L7p:AddHeader>\n                        <L7p:AddHeader>\n                            <L7p:HeaderName stringValue=\"Pragma\"/>\n                            <L7p:HeaderValue stringValue=\"no-cache\"/>\n                            <L7p:Target target=\"RESPONSE\"/>\n                        </L7p:AddHeader>\n                        <L7p:AddHeader>\n                            <L7p:HeaderName stringValue=\"Cache-Control\"/>\n                            <L7p:HeaderValue stringValue=\"no-store\"/>\n                            <L7p:Target target=\"RESPONSE\"/>\n                        </L7p:AddHeader>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Success\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:Encapsulated>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                                    <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:FalseAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error response\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"302, HTML\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Authentication\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// authenticate and prepare consent request\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Authenticate\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"usercode\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"usercode\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PHA+V2VsY29tZSA8Yj4ke2N1cnJlbnQudXNlcm5hbWV9PC9iPjwvcD4NCjxwPlBsZWFzZSBlbnRlciB0aGUgY29kZSBkaXNwbGF5ZWQgb24geW91ciBkZXZpY2U6PC9wPg0KPGZvcm0gYXV0b2NvbXBsZXRlPSJvZmYiIGFjdGlvbj0iJHtvcmlnaW5hbFJlcXVlc3RVcmx9IiBtZXRob2Q9IlBPU1QiIGNsYXNzPSJmb3JtLWJvZHkgZm9ybS1sb2dpbiIgc3R5bGU9Im1hcmdpbjogMDsiPg0KPGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+DQo8bGFiZWw+Q29kZSAqPC9sYWJlbD4NCjxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ1c2VyX2NvZGUiIGNsYXNzPSJpbnB1dC1ibG9jayIgdmFsdWU9IiIgcmVxdWlyZWQvPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ic2Vzc2lvbklEIiB2YWx1ZT0iJHtzZXNzaW9uSUR9Ij4NCjxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InNlc3Npb25EYXRhIiB2YWx1ZT0iJHtzZXNzaW9uRGF0YUpXVH0iPg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJyb3ctZmx1aWQiPg0KPGRpdiBjbGFzcz0ic3BhbjEyIj4NCjxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IHB1bGwtcmlnaHQiIG5hbWU9ImFjdGlvbiIgdmFsdWU9InZlcmlmeSIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAyZW07Ij5TdWJtaXQ8L2J1dHRvbj4NCjwvZGl2Pg0KPC9kaXY+DQo8L2Zvcm0+\"/>\n                    <L7p:VariableToSet stringValue=\"userCodeHtmlContent\"/>\n                </L7p:SetVariable>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"error.content\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"new.content\"/>\n                            <L7p:value stringValue=\"${userCodeHtmlContent}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"other\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"task\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:HardcodedResponse>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"200\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64ResponseBody stringValue=\"JHtjb250ZW50fQ==\"/>\n                    <L7p:ResponseContentType stringValue=\"${content-type}\"/>\n                </L7p:HardcodedResponse>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"display\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// usercode form\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"verify\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"verify\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${usercode}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uVXNlcmNvZGV9\"/>\n                                <L7p:VariableToSet stringValue=\"usercode\"/>\n                            </L7p:SetVariable>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"bb6a3703-39d8-43fd-b380-b850a09866d9\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Read (dag)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"device_code\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"user_code\"/>\n                                    <L7p:value stringValue=\"${usercode}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${error.code}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"$.values.value.expiration\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"exp.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${exp.jsonPath.found}\"/>\n                            <L7p:Expression2 stringValue=\"true\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"$.values.value.device_code\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"device_code.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${device_code.jsonPath.found}\"/>\n                            <L7p:Expression2 stringValue=\"true\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtkZXZpY2VfY29kZS5qc29uUGF0aC5yZXN1bHR9\"/>\n                            <L7p:VariableToSet stringValue=\"device_code\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"\"/>\n                            <L7p:DataType variableDataType=\"dateTime\"/>\n                            <L7p:DateOffsetExpression stringValue=\"\"/>\n                            <L7p:VariableToSet stringValue=\"now\"/>\n                        </L7p:SetVariable>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${exp.jsonPath.result}\"/>\n                            <L7p:Expression2 stringValue=\"${now.seconds}\"/>\n                            <L7p:Operator operator=\"GT\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"GT\"/>\n                                    <L7p:RightValue stringValue=\"${now.seconds}\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"$.values.value.status\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"status.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${status.jsonPath.found}\"/>\n                            <L7p:Expression2 stringValue=\"true\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${status.jsonPath.result}\"/>\n                            <L7p:Expression2 stringValue=\"NONE\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"NONE\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"11de0843-a690-4dd5-922b-3fe29439bd6d\"/>\n                            <L7p:PolicyName stringValue=\"#OTK DAG Consent Display Details\"/>\n                        </L7p:Include>\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Mobile SSO extension included\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"PGF1dGhvcml6ZT4NCiAgICA8dXNlcmNvZGU+JHt1c2VyY29kZX08L3VzZXJjb2RlPg0KICAgIDxyZXF1ZXN0VXJsPiR7ZW5jb2RlZFJlcXVlc3RVcmx9PC9yZXF1ZXN0VXJsPg0KICAgIDxzZXNzaW9uPiR7c2Vzc2lvbklEfTwvc2Vzc2lvbj4NCiAgICA8c2Vzc2lvbkRhdGE+JHtzZXNzaW9uRGF0YUpXVH08L3Nlc3Npb25EYXRhPg0KICAgIDxkZXZpY2VOYW1lPiR7ZGV2aWNlX25hbWUuanNvblBhdGgucmVzdWx0fTwvZGV2aWNlTmFtZT4NCjwvYXV0aG9yaXplPg==\"/>\n                            <L7p:VariableToSet stringValue=\"sessionValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"dbAge\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"value\"/>\n                                    <L7p:value stringValue=\"${sessionValue}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"current_user_acr\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"current_user_acr.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"current_user_authTime\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"current_user_authTime.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"third_party_sso_token\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"third_party_sso_token.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"third_party_sso_token_type\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"third_party_sso_token_type.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"salt\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"salt.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"PHM+DQogIDxub25jZT48L25vbmNlPg0KICA8c2FsdD48IVtDREFUQVske3NhbHQuanNvblBhdGgucmVzdWx0fV1dPjwvc2FsdD4NCiAgPHRoaXJkX3BhcnR5X3Nzb190b2tlbj48IVtDREFUQVske3RoaXJkX3BhcnR5X3Nzb190b2tlbi5qc29uUGF0aC5yZXN1bHR9XV0+PC90aGlyZF9wYXJ0eV9zc29fdG9rZW4+DQogIDx0aGlyZF9wYXJ0eV9zc29fdG9rZW5fdHlwZT48IVtDREFUQVske3RoaXJkX3BhcnR5X3Nzb190b2tlbl90eXBlLmpzb25QYXRoLnJlc3VsdH1dXT48L3RoaXJkX3BhcnR5X3Nzb190b2tlbl90eXBlPg0KICA8YXV0aFRpbWU+PCFbQ0RBVEFbJHtjdXJyZW50X3VzZXJfYXV0aFRpbWUuanNvblBhdGgucmVzdWx0fV1dPjwvYXV0aFRpbWU+DQogIDxhY3I+PCFbQ0RBVEFbJHtjdXJyZW50X3VzZXJfYWNyLmpzb25QYXRoLnJlc3VsdH1dXT48L2Fjcj4NCiAgPG1heF9hZ2U+PC9tYXhfYWdlPg0KICA8cmVzcG9uc2VfdHlwZT5jb2RlPC9yZXNwb25zZV90eXBlPg0KICA8c3RhdGU+PC9zdGF0ZT4NCjwvcz4=\"/>\n                            <L7p:VariableToSet stringValue=\"openIdSessionValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dd360775-0fec-47db-8b45-059d995b262d\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Store\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"openIDConnectCache\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${device_code}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"dbAge\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"value\"/>\n                                    <L7p:value stringValue=\"${openIdSessionValue}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"${userCodeConfirmation}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"JHtjb250ZW50fQ==\"/>\n                            <L7p:ResponseContentType stringValue=\"${content-type}\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"324\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                                    <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:FalseAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error response\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"302, HTML\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"verify\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// usercode\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"grant\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"grant\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uVXNlcmNvZGV9\"/>\n                            <L7p:VariableToSet stringValue=\"usercode\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${usercode}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"324\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"deviceName\"/>\n                                <L7p:XmlMsgSrc stringValue=\"grantedContent\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/authorize/deviceName/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:TrueAssertion/>\n                        </wsp:OneOrMore>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"current_user_acr\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"sessionData\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"current_user_acr.jsonPath\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtjdXJyZW50X3VzZXJfYWNyLmpzb25QYXRoLnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"acr\"/>\n                        </L7p:SetVariable>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"b17f391d-6e8a-4bb7-8411-2de47657e8fb\"/>\n                            <L7p:PolicyName stringValue=\"#OTK Token Rank\"/>\n                        </L7p:Include>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"bb6a3703-39d8-43fd-b380-b850a09866d9\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Read (dag)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"device_code\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"user_code\"/>\n                                    <L7p:value stringValue=\"${usercode}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathCustom\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:custom\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHt4cGF0aEN1c3RvbS5yZXN1bHR9\"/>\n                            <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"custom\"/>\n                        </L7p:SetVariable>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"$.device_metadata\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"custom\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"device_metadata\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"$.client_custom\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"custom\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"client_custom\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"ew0KICJjbGllbnRfY3VzdG9tIjogJHtjbGllbnRfY3VzdG9tLnJlc3VsdH0sDQogImRldmljZV9tZXRhZGF0YSIgOiAke2RldmljZV9tZXRhZGF0YS5yZXN1bHR9LA0KICJ0b2tlbl9yYW5rIiA6ICR7dG9rZW5fcmFua30NCn0=\"/>\n                            <L7p:VariableToSet stringValue=\"custom\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b79ebaf7-acff-4eac-8d48-61b90bf597cb\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cookie Management\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookie\"/>\n                                    <L7p:value stringValue=\"${request.http.cookies}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieName\"/>\n                                    <L7p:value stringValue=\"sessionCookie\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieValue\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"lifetime\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtjb29raWVWYWx1ZX0=\"/>\n                            <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"cookieValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:EvaluateJsonPathExpression>\n                            <L7p:Expression stringValue=\"current.username\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"cookieValue\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"resource_owner\"/>\n                        </L7p:EvaluateJsonPathExpression>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${resource_owner.result}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b24307dc-f5d8-4bf1-91bb-d454530b8fde\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Write (dag)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"${custom}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"device_code\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"operation\"/>\n                                    <L7p:value stringValue=\"update\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${resource_owner.result}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"status\"/>\n                                    <L7p:value stringValue=\"ACCEPTED\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"update_last_polled_time\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"user_code\"/>\n                                    <L7p:value stringValue=\"${usercode}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${error.code}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+DQo8cD5XZWxjb21lIDxiPiR7Y3VycmVudC51c2VybmFtZX08L2I+PC9wPg0KPHA+VGhlIFVzZXIgQ29kZSA8Yj4ke3VzZXJjb2RlfTwvYj4gaXMgYWNjZXB0ZWQgZm9yIHRoZSBjbGllbnQgcnVubmluZyBvbiB0aGUgZGV2aWNlIDxiPiR7ZGV2aWNlTmFtZS5yZXN1bHR9PC9iPjwvcD4NCjxwPk5vdyB5b3UgbWF5IGNsb3NlIHRoaXMgd2luZG93LjwvcD4NCjwvZGl2Pg0KPGRpdiBjbGFzcz0icm93LWZsdWlkIj4NCjwvZGl2Pg==\"/>\n                            <L7p:VariableToSet stringValue=\"userCodeAccepted\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"${userCodeAccepted}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"JHtjb250ZW50fQ==\"/>\n                            <L7p:ResponseContentType stringValue=\"${content-type}\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:AddHeader>\n                            <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                            <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                            <L7p:RemoveExisting booleanValue=\"true\"/>\n                            <L7p:Target target=\"RESPONSE\"/>\n                        </L7p:AddHeader>\n                        <L7p:FalseAssertion/>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Grant\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Grant user code\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"deny\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"deny\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uVXNlcmNvZGV9\"/>\n                            <L7p:VariableToSet stringValue=\"usercode\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${usercode}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"324\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b79ebaf7-acff-4eac-8d48-61b90bf597cb\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cookie Management\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookie\"/>\n                                    <L7p:value stringValue=\"${request.http.cookies}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieName\"/>\n                                    <L7p:value stringValue=\"sessionCookie\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cookieValue\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"lifetime\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtjb29raWVWYWx1ZX0=\"/>\n                            <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"cookieValue\"/>\n                        </L7p:SetVariable>\n                        <L7p:EvaluateJsonPathExpression>\n                            <L7p:Expression stringValue=\"current.username\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"cookieValue\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"resource_owner\"/>\n                        </L7p:EvaluateJsonPathExpression>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${resource_owner.result}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b24307dc-f5d8-4bf1-91bb-d454530b8fde\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Write (dag)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_name\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"device_code\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"expiration\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"operation\"/>\n                                    <L7p:value stringValue=\"update\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"${resource_owner.result}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"scope\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"status\"/>\n                                    <L7p:value stringValue=\"REJECTED\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"update_last_polled_time\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"user_code\"/>\n                                    <L7p:value stringValue=\"${usercode}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${error.code}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"PGRpdiBjbGFzcz0iY29udHJvbC1ncm91cCI+DQo8cD5XZWxjb21lIDxiPiR7Y3VycmVudC51c2VybmFtZX08L2I+PC9wPg0KPHA+VGhlIFVzZXIgQ29kZSA8Yj4ke3VzZXJjb2RlfTwvYj4gaXMgZGVuaWVkIGZvciB0aGUgY2xpZW50IHJ1bm5pbmcgb24gdGhlIGRldmljZSA8Yj4ke2RldmljZU5hbWUucmVzdWx0fTwvYj48L3A+DQo8cD5Ob3cgeW91IG1heSBjbG9zZSB0aGlzIHdpbmRvdy48L3A+DQo8L2Rpdj4NCjxkaXYgY2xhc3M9InJvdy1mbHVpZCI+DQo8ZGl2IGNsYXNzPSJzcGFuMTIiPg0KPC9kaXY+DQo8L2Rpdj4=\"/>\n                            <L7p:VariableToSet stringValue=\"userCodeRejected\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"${userCodeRejected}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:HardcodedResponse>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"200\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64ResponseBody stringValue=\"JHtjb250ZW50fQ==\"/>\n                            <L7p:ResponseContentType stringValue=\"${content-type}\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:AddHeader>\n                            <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                            <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                            <L7p:RemoveExisting booleanValue=\"true\"/>\n                            <L7p:Target target=\"RESPONSE\"/>\n                        </L7p:AddHeader>\n                        <L7p:FalseAssertion/>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"Deny\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Deny user code\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${action}\"/>\n                    <L7p:Expression2 stringValue=\"cancel\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"cancel\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                    <L7p:Expression2 stringValue=\"false\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"false\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:HtmlFormDataAssertion>\n                        <L7p:AllowGet booleanValue=\"true\"/>\n                        <L7p:AllowPost booleanValue=\"true\"/>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"success\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:FieldSpecs htmlFormFieldSpecArray=\"included\">\n                            <L7p:item htmlFormFieldSpec=\"included\">\n                                <L7p:AllowEmpty boxedBooleanValue=\"false\"/>\n                                <L7p:DataType fieldDataType=\"any\"/>\n                                <L7p:MaxOccurs intValue=\"1\"/>\n                                <L7p:MinOccurs intValue=\"1\"/>\n                                <L7p:Name stringValue=\"sessionID\"/>\n                            </L7p:item>\n                        </L7p:FieldSpecs>\n                    </L7p:HtmlFormDataAssertion>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"other\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"task\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <L7p:AddHeader>\n                                <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                                <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                                <L7p:RemoveExisting booleanValue=\"true\"/>\n                                <L7p:Target target=\"RESPONSE\"/>\n                            </L7p:AddHeader>\n                            <L7p:FalseAssertion/>\n                        </wsp:All>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error message\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Parameters\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Check for duplicate parameters in the request\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4e4bc164-3fa2-4b15-ba65-31cef45b84b0\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session GET\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"sessionValue\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:found/ns:value/text()\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-session\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                            <L7p:VariableToSet stringValue=\"hasSession\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8d06714c-d54c-48e5-a454-e3c036b67f98\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Session - Delete\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheAge\"/>\n                                    <L7p:value stringValue=\"${session.lifetime.s}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheId\"/>\n                                    <L7p:value stringValue=\"${cacheName}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${sessionID}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxEntries\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheMaxSize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"sessionValue.result\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"decoded\"/>\n                            <L7p:TransformType transformType=\"URL_DECODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtkZWNvZGVkfQ==\"/>\n                            <L7p:ContentType stringValue=\"text/xml;charset=UTF-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"grantedContent\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n                        <L7p:VariableToSet stringValue=\"hasSession\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"session\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"Lookup session data\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"123\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"apiPrefix\"/>\n                                <L7p:value stringValue=\"3001\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                <L7p:value stringValue=\"123\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n                            <L7p:ContentType stringValue=\"application/json;charset=UTF-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"jsonMsg\"/>\n                        </L7p:SetVariable>\n                        <L7p:EvaluateJsonPathExpression>\n                            <L7p:Expression stringValue=\"error\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"jsonMsg\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"error\"/>\n                        </L7p:EvaluateJsonPathExpression>\n                        <L7p:EvaluateJsonPathExpression>\n                            <L7p:Expression stringValue=\"error_description\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"jsonMsg\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"error_description\"/>\n                        </L7p:EvaluateJsonPathExpression>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvcl9kZXNjcmlwdGlvbi5yZXN1bHR9\"/>\n                            <L7p:VariableToSet stringValue=\"error_description\"/>\n                        </L7p:SetVariable>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5yZXN1bHR9\"/>\n                            <L7p:VariableToSet stringValue=\"error_type\"/>\n                        </L7p:SetVariable>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"error_description.result\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"error_description_encoded\"/>\n                            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"error.result\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"error_type_encoded\"/>\n                            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"action denied\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"get the error message\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"html\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"used with html response\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"content\"/>\n                                <L7p:value stringValue=\"${errorDetail}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"error.content\"/>\n                                <L7p:value stringValue=\"${error.msg}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"new.content\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <L7p:AddHeader>\n                        <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                        <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                        <L7p:RemoveExisting booleanValue=\"true\"/>\n                        <L7p:Target target=\"RESPONSE\"/>\n                    </L7p:AddHeader>\n                    <L7p:FalseAssertion/>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"HTML\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"cancel\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Login process was cancelled\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${sessionID}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${action}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:AuditDetailAssertion>\n                                <L7p:Detail stringValue=\"action but no session\"/>\n                            </L7p:AuditDetailAssertion>\n                            <L7p:FalseAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"action, no session\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Invalid combination of parameters was used\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${sessionID}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${action}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:AuditDetailAssertion>\n                                <L7p:Detail stringValue=\"no action but session\"/>\n                            </L7p:AuditDetailAssertion>\n                            <L7p:FalseAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"no action, session\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Invalid combination of parameters was used\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:Encapsulated>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"103\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                                    <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error response\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error message\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"parameters\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"wrong parameter combination\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:AuditDetailAssertion>\n                            <L7p:Detail stringValue=\"Something went totally wrong!\"/>\n                        </L7p:AuditDetailAssertion>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:Encapsulated>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"000\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"API-ID 3001\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"3001\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"000\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09faa5d6-e22c-4d4d-812d-32603331c136\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Authorization Server Website Template\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"content\"/>\n                                    <L7p:value stringValue=\"${errorDetail}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"error.content\"/>\n                                    <L7p:value stringValue=\"${error.msg}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"new.content\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"x-ca-err\"/>\n                                    <L7p:HeaderValue stringValue=\"${error.code}\"/>\n                                    <L7p:RemoveExisting booleanValue=\"true\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error response\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"get the error message\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"unknown\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"something unknown happened\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"error type\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"Unknown action\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"tasks\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}