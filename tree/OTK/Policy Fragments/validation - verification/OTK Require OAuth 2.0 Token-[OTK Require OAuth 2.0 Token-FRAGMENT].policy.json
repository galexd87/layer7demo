{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fd841",
  "guid": "495c191d-9fb1-4f22-a8ec-76ecacf8bef4",
  "name": "OTK Require OAuth 2.0 Token",
  "policyType": "FRAGMENT",
  "checksum": "6fb7ae40dcabf3a94c52986de2f975f93caf108b",
  "folderPath": "/OTK/Policy Fragments/validation - verification",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === ***  THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === If you have the need to customize this policy\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === please contact CA APIM Support so we can improve customization capability\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This policy can be found and should be used as 'Encapsulated Assertion'!\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Include this policy in a service policy to authorize api access based on an oauth 2.0 access token\"/>\n        </L7p:CommentAssertion>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"7e2b4f64-e226-4a03-980a-c4603163acc0\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK OVP Configuration\"/>\n        </L7p:Encapsulated>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"client_cert_thumbprint\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:LookupDynamicContextVariables>\n                    <L7p:SourceVariable stringValue=\"request.ssl.clientCertificate\"/>\n                    <L7p:TargetDataType variableDataType=\"cert\"/>\n                </L7p:LookupDynamicContextVariables>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"request.ssl.clientCertificate\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"client_cert_base64\"/>\n                    <L7p:TransformType transformType=\"BASE64_ENCODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0LnNzbC5jbGllbnRDZXJ0aWZpY2F0ZS50aHVtYnByaW50U0hBMjU2fQ==\"/>\n                    <L7p:VariableToSet stringValue=\"client_cert_thumbprint\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${gateway.otk.oauth2.mtls.client_certificate_header}\"/>\n                    <L7p:Expression2 stringValue=\"true\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:LookupDynamicContextVariables>\n                    <L7p:SourceVariable stringValue=\"request.http.headervalues.${gateway.otk.oauth2.mtls.client_certificate_header}\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetOutputVariablePrefix stringValue=\"clientCert\"/>\n                </L7p:LookupDynamicContextVariables>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjbGllbnRDZXJ0Lm91dHB1dH0=\"/>\n                    <L7p:VariableToSet stringValue=\"client_cert_base64\"/>\n                </L7p:SetVariable>\n                <L7p:EncodeDecode>\n                    <L7p:CharacterEncoding stringValueNull=\"null\"/>\n                    <L7p:SourceVariableName stringValue=\"client_cert_base64\"/>\n                    <L7p:TargetDataType variableDataType=\"cert\"/>\n                    <L7p:TargetVariableName stringValue=\"client_cert\"/>\n                    <L7p:TransformType transformType=\"BASE64_DECODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjbGllbnRfY2VydC50aHVtYnByaW50U0hBMjU2fQ==\"/>\n                    <L7p:VariableToSet stringValue=\"client_cert_thumbprint\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"//extract from request header\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:VariableToSet stringValue=\"client_cert_base64\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// extract client certificate if present\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"error code\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overwritten in case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"error msg\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"overwritten in case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${disallow_query}\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"boolean\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"false\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"find\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"find the access_token, fails if not found\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dc16f9da-c833-4b0a-8525-8a41ce420795\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Access Token Retrieval\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allow_header\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allow_query\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"auth_header\"/>\n                            <L7p:value stringValue=\"${request.http.header.authorization}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"auth_param_token\"/>\n                            <L7p:value stringValue=\"${request.http.parameters.access_token}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"given_access_token\"/>\n                            <L7p:value stringValue=\"${given_access_token}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${disallow_query}\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"boolean\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"find\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"find the access_token, fails if not found\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"dc16f9da-c833-4b0a-8525-8a41ce420795\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Access Token Retrieval\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allow_header\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"allow_query\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"auth_header\"/>\n                            <L7p:value stringValue=\"${request.http.header.authorization}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"auth_param_token\"/>\n                            <L7p:value stringValue=\"${request.http.parameters.access_token}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"custom\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"disallow_query\"/>\n                            <L7p:value stringValue=\"true\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"given_access_token\"/>\n                            <L7p:value stringValue=\"${given_access_token}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n            </wsp:All>\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error code\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"error code is provided from previous assertion\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"apiPrefix\"/>\n                        <L7p:value stringValue=\"\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"givenErrorCode\"/>\n                        <L7p:value stringValue=\"${error.code}\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"find the access_token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHthY2Nlc3NfdG9rZW59\"/>\n            <L7p:VariableToSet stringValue=\"uuid_token\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"string\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:RightValue stringValue=\"uuid\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"jwt\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:DecodeJsonWebToken>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// decoding to get jti (uuid_token) from jwt\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:SourcePayload stringValue=\"${access_token}\"/>\n                    <L7p:TargetVariablePrefix stringValue=\"jwt_token\"/>\n                    <L7p:ValidationType stringValue=\"None\"/>\n                </L7p:DecodeJsonWebToken>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtqd3RfdG9rZW4ucGF5bG9hZH0=\"/>\n                    <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"jwt_token.payload\"/>\n                </L7p:SetVariable>\n                <L7p:EvaluateJsonPathExpressionV2>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// extract JWT ID (&quot;jti&quot;) from payload\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Expression stringValue=\"jti\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"jwt_token.payload\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                    <L7p:VariablePrefix stringValue=\"jwt_jti\"/>\n                </L7p:EvaluateJsonPathExpressionV2>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtqd3RfanRpLnJlc3VsdH0=\"/>\n                    <L7p:VariableToSet stringValue=\"uuid_token\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// extract JWT certficate thumbprint (&quot;x5t#256&quot;) from payload\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Expression stringValue=\"cnf.x5t#S256\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"jwt_token.payload\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"jwt_x5t\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtqd3RfeDV0LnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"token_cert_thumbprint\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"\"/>\n                        <L7p:VariableToSet stringValue=\"token_cert_thumbprint\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// extract x5t#256 value from JWT payload\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"act\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"jwt_token.payload\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"jwt_act_claim\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtqd3RfYWN0X2NsYWltLnJlc3VsdH0=\"/>\n                            <L7p:VariableToSet stringValue=\"session.act_claim\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"\"/>\n                        <L7p:VariableToSet stringValue=\"session.act_claim\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// extract act claim from JWT payload\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:Expression stringValue=\"may_act\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"jwt_token.payload\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                            <L7p:VariablePrefix stringValue=\"jwt_may_act_claim\"/>\n                        </L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtqd3RfbWF5X2FjdF9jbGFpbS5yZXN1bHR9\"/>\n                            <L7p:VariableToSet stringValue=\"session.may_act_claim\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"\"/>\n                        <L7p:VariableToSet stringValue=\"session.may_act_claim\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// extract may_ act claim from JWT payload\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// extract jti for uuid_token if it's a jwt\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"ab782606-2791-41a1-824d-115b67904480\"/>\n        </L7p:Include>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Validation location\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Set the location to validate the access_token\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n            <L7p:VariableToSet stringValue=\"isLocal\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${auth_scheme}\"/>\n                    <L7p:Expression2 stringValue=\"Bearer\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"Bearer\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:CommentAssertion>\n                    <L7p:Comment stringValue=\"The cacheKey is a combination of access_token, required SCOPE, SCOPE-fail-flag, resource_required and client_cert_thumbprint\"/>\n                </L7p:CommentAssertion>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"CacheKey\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"The key used for caching the token validation result\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"JHthY2Nlc3NfdG9rZW59JHtzY29wZV9mYWlsfSR7c2NvcGVfcmVxdWlyZWR9JHtyZXNvdXJjZV9yZXF1aXJlZH0ke2NsaWVudF9jZXJ0X3RodW1icHJpbnR9\"/>\n                    <L7p:VariableToSet stringValue=\"cacheKey\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"68ad78a1-f4a1-4568-91e1-0980d95c75cd\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cache Look Up\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheID\"/>\n                                    <L7p:value stringValue=\"accessTokenValidation\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${cacheKey}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"maxAcceptableAge\"/>\n                                    <L7p:value stringValue=\"${cache_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntryAge\"/>\n                                    <L7p:value stringValue=\"${cache_lifetime}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// From Cache\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${host_oauth_ovp_server}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item regex=\"included\">\n                                    <L7p:Pattern stringValue=\"http[s]?://(localhost|127[.]0[.]0[.]1).+\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"set local\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Set the location to validate access token\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"isLocal\"/>\n                                </L7p:SetVariable>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"uuid\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"19902efe-b202-49da-a5d9-619c57ee842a\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Get (token)\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"0\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${access_token}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"UUID\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate if access_token is UUID\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"jwt\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"fce241db-a269-4dfe-adad-7790748c4940\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Validate JWT OAuth Token\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"access_token\"/>\n                                    <L7p:value stringValue=\"${access_token}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${query_db}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"19902efe-b202-49da-a5d9-619c57ee842a\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Get (token)\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"0\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${jwt_id}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Query DB or Not\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:OneOrMore>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"JWT\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate if access_token is JWT\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate either JWT or UUID\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                                <L7p:Encapsulated>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"It implicitly also uses 'scope_required' and 'scope_fail' and 'access_token'\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2c8a8e1d-fbcd-4d9a-b866-981d923aeb83\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK OAuth 2.0 Token Validation - BEARER\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"client_cert\"/>\n                                    <L7p:value stringValue=\"${request.ssl.clientCertificate}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token_cert_thumbprint\"/>\n                                    <L7p:value stringValue=\"${token_cert_thumbprint}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"tokenValues\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate Locally\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${isLocal}\"/>\n                                    <L7p:Expression2 stringValue=\"false\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:EncodeDecode>\n                                    <L7p:SourceVariableName stringValue=\"scope_required\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n                                    <L7p:TargetVariableName stringValue=\"scope_required\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                </L7p:EncodeDecode>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"uuid\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:EncodeDecode>\n                                    <L7p:SourceVariableName stringValue=\"access_token\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n                                    <L7p:TargetVariableName stringValue=\"access_token\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:EncodeDecode>\n                                    <L7p:SourceVariableName stringValue=\"client_cert_base64\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n                                    <L7p:TargetVariableName stringValue=\"client_cert_base64\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:EncodeDecode>\n                                    <L7p:SourceVariableName stringValue=\"resource_required\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n                                    <L7p:TargetVariableName stringValue=\"resource_required\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"YWNjZXNzX3Rva2VuPSR7YWNjZXNzX3Rva2VufSZpc29uZXRpbWU9JHtvbmV0aW1lfSZhdXRoX3NjaGVtZT1CZWFyZXImc2NvcGVfcmVxdWlyZWQ9JHtzY29wZV9yZXF1aXJlZH0mc2NvcGVfZmFpbD0ke3Njb3BlX2ZhaWx9JnJlc291cmNlX3JlcXVpcmVkPSR7cmVzb3VyY2VfcmVxdWlyZWR9JmNsaWVudF9jZXJ0X2Jhc2U2ND0ke2NsaWVudF9jZXJ0X2Jhc2U2NH0mYW55X3Jlc291cmNlX3JlcXVpcmVkPSR7YW55X3Jlc291cmNlX3JlcXVpcmVkfSZkaXNhYmxlX2F1ZGllbmNlX2NoZWNrPSR7ZGlzYWJsZV9hdWRpZW5jZV9jaGVja30=\"/>\n                                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded; charset=utf-8\"/>\n                                    <L7p:DataType variableDataType=\"message\"/>\n                                    <L7p:VariableToSet stringValue=\"req\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:HttpRoutingAssertion>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"no-fail\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"always succeed\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n\n                                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                                    <L7p:HttpMethod httpMethod=\"POST\"/>\n                                    <L7p:PassThroughSoapFaults booleanValue=\"false\"/>\n                                    <L7p:ProtectedServiceUrl stringValue=\"${host_oauth_ovp_server}/oauth/validation/validate/v2/token\"/>\n                                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:Rules httpPassthroughRules=\"included\"/>\n                                    </L7p:RequestHeaderRules>\n                                    <L7p:RequestMsgSrc stringValue=\"req\"/>\n                                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:Rules httpPassthroughRules=\"included\"/>\n                                    </L7p:RequestParamRules>\n                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:ForwardAll booleanValue=\"true\"/>\n                                    <L7p:Rules httpPassthroughRules=\"included\">\n                                    <L7p:item httpPassthroughRule=\"included\">\n                                    <L7p:Name stringValue=\"x-ca-err\"/>\n                                    </L7p:item>\n                                    </L7p:Rules>\n                                    </L7p:ResponseHeaderRules>\n                                    <L7p:ResponseMsgDest stringValue=\"resp\"/>\n                                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                                    </L7p:HttpRoutingAssertion>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtyZXNwLmh0dHAuaGVhZGVyLngtY2EtZXJyfQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// UUID\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${access_token_type}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"jwt\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"fce241db-a269-4dfe-adad-7790748c4940\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Validate JWT OAuth Token\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"access_token\"/>\n                                    <L7p:value stringValue=\"${access_token}\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtqd3RfaWR9\"/>\n                                    <L7p:VariableToSet stringValue=\"access_token\"/>\n                                    </L7p:SetVariable>\n                                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${query_db}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n\n                                    <L7p:value stringValue=\"It implicitly also uses 'scope_required' and 'scope_fail' and 'access_token'\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2c8a8e1d-fbcd-4d9a-b866-981d923aeb83\"/>\n\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK OAuth 2.0 Token Validation - BEARER\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"custom\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"token_cert_thumbprint\"/>\n                                    <L7p:value stringValue=\"${token_cert_thumbprint}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"tokenValues\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    </wsp:All>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:EncodeDecode>\n\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n\n                                    <L7p:value stringValue=\"// Validate against DB using JTI (jwt_id)\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n\n                                    <L7p:SourceVariableName stringValue=\"access_token\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n\n                                    <L7p:TargetVariableName stringValue=\"access_token\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:EncodeDecode>\n\n                                    <L7p:SourceVariableName stringValue=\"client_cert_base64\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n\n                                    <L7p:TargetVariableName stringValue=\"client_cert_base64\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:EncodeDecode>\n\n                                    <L7p:SourceVariableName stringValue=\"token_cert_thumbprint\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n\n                                    <L7p:TargetVariableName stringValue=\"token_cert_thumbprint_encoded\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:EncodeDecode>\n\n                                    <L7p:SourceVariableName stringValue=\"resource_required\"/>\n                                    <L7p:TargetDataType variableDataType=\"string\"/>\n\n                                    <L7p:TargetVariableName stringValue=\"resource_required\"/>\n                                    <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                                    </L7p:EncodeDecode>\n                                    <L7p:SetVariable>\n\n                                    <L7p:Base64Expression stringValue=\"YWNjZXNzX3Rva2VuPSR7YWNjZXNzX3Rva2VufSZpc29uZXRpbWU9JHtvbmV0aW1lfSZhdXRoX3NjaGVtZT1CZWFyZXImc2NvcGVfcmVxdWlyZWQ9JHtzY29wZV9yZXF1aXJlZH0mc2NvcGVfZmFpbD0ke3Njb3BlX2ZhaWx9JnJlc291cmNlX3JlcXVpcmVkPSR7cmVzb3VyY2VfcmVxdWlyZWR9JmNsaWVudF9jZXJ0X2Jhc2U2ND0ke2NsaWVudF9jZXJ0X2Jhc2U2NH0mdG9rZW5fY2VydF90aHVtYnByaW50PSR7dG9rZW5fY2VydF90aHVtYnByaW50X2VuY29kZWR9JmFueV9yZXNvdXJjZV9yZXF1aXJlZD0ke2FueV9yZXNvdXJjZV9yZXF1aXJlZH0mZGlzYWJsZV9hdWRpZW5jZV9jaGVjaz0ke2Rpc2FibGVfYXVkaWVuY2VfY2hlY2t9\"/>\n                                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded; charset=utf-8\"/>\n                                    <L7p:DataType variableDataType=\"message\"/>\n                                    <L7p:VariableToSet stringValue=\"req\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:HttpRoutingAssertion>\n\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n\n                                    <L7p:value stringValue=\"no-fail\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n\n                                    <L7p:value stringValue=\"always succeed\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n\n                                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n\n                                    <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                                    <L7p:HttpMethod httpMethod=\"POST\"/>\n\n                                    <L7p:PassThroughSoapFaults booleanValue=\"false\"/>\n\n                                    <L7p:ProtectedServiceUrl stringValue=\"${host_oauth_ovp_server}/oauth/validation/validate/v2/token\"/>\n                                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n\n                                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:Rules httpPassthroughRules=\"included\"/>\n                                    </L7p:RequestHeaderRules>\n                                    <L7p:RequestMsgSrc stringValue=\"req\"/>\n\n                                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:Rules httpPassthroughRules=\"included\"/>\n                                    </L7p:RequestParamRules>\n\n                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                                    <L7p:ForwardAll booleanValue=\"true\"/>\n                                    <L7p:Rules httpPassthroughRules=\"included\">\n                                    <L7p:item httpPassthroughRule=\"included\">\n\n                                    <L7p:Name stringValue=\"x-ca-err\"/>\n                                    </L7p:item>\n                                    </L7p:Rules>\n                                    </L7p:ResponseHeaderRules>\n                                    <L7p:ResponseMsgDest stringValue=\"resp\"/>\n\n                                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                                    </L7p:HttpRoutingAssertion>\n                                    <L7p:SetVariable>\n\n                                    <L7p:Base64Expression stringValue=\"JHtyZXNwLmh0dHAuaGVhZGVyLngtY2EtZXJyfQ==\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Make remote validation call to query database\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Query DB or Not\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:OneOrMore>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// JWT\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validate\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"UUID or JWT\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${httpRouting.reasonCode}\"/>\n                                    <L7p:Expression2 stringValue=\"500\"/>\n                                    <L7p:Operator operator=\"LT\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"LT\"/>\n                                    <L7p:RightValue stringValue=\"500\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${query_db}\"/>\n                                    <L7p:Operator operatorNull=\"null\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:AuditDetailAssertion>\n                                    <L7p:Detail stringValue=\"routing failed!\"/>\n                                    </L7p:AuditDetailAssertion>\n                                    <L7p:SetVariable>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"set error code to 000\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                    </L7p:SetVariable>\n                                    <L7p:FalseAssertion/>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"routing errors\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"check if the routing assertion was successful\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:Regex>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"capture\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"capture the last 3 digits\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n\n                                    <L7p:OtherTargetMessageVariable stringValue=\"error.code\"/>\n                                    <L7p:Regex stringValue=\"(\\d{0,16})(\\d{3})$\"/>\n                                    <L7p:Replace booleanValue=\"true\"/>\n                                    <L7p:Replacement stringValue=\"$2\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                    </L7p:Regex>\n                                    <L7p:FalseAssertion/>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                    </wsp:All>\n                                    <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"check for an error code\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:assertionComment>\n                                </wsp:OneOrMore>\n                                <L7p:SetVariable>\n                                    <L7p:Base64Expression stringValue=\"JHtyZXNwLmh0dHAuaGVhZGVyLmNvbnRlbnQtdHlwZX0=\"/>\n                                    <L7p:VariableToSet stringValue=\"content-type\"/>\n                                </L7p:SetVariable>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate remotely\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Validate locally or remotely\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"xpathClientId\"/>\n                                <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:client_key/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"xpathOwner\"/>\n                                <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:resource_owner/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"xpathScope\"/>\n                                <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:scope/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"xpathExpiration\"/>\n                                <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:expiration/text()\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <L7p:ResponseXpathAssertion>\n                                <L7p:VariablePrefix stringValue=\"xpathCustom\"/>\n                                <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:custom\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                </L7p:XpathExpression>\n                            </L7p:ResponseXpathAssertion>\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"xpathResource\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:resource\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                    </L7p:ResponseXpathAssertion>\n                                    <L7p:ResponseXpathAssertion>\n                                    <L7p:VariablePrefix stringValue=\"xpathResourceVerified\"/>\n                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                    <L7p:Expression stringValue=\"/ns:validation/ns:resource_verified\"/>\n                                    <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                    </L7p:Namespaces>\n                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                    </L7p:XpathExpression>\n                                    </L7p:ResponseXpathAssertion>\n                                </wsp:All>\n                                <L7p:TrueAssertion/>\n                            </wsp:OneOrMore>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHt4cGF0aENsaWVudElkLnJlc3VsdH0jQCMke3hwYXRoT3duZXIucmVzdWx0fSNAIyR7eHBhdGhTY29wZS5yZXN1bHR9I0AjJHt4cGF0aEV4cGlyYXRpb24ucmVzdWx0fSNAIyR7eHBhdGhDdXN0b20ucmVzdWx0fSNAIyR7eHBhdGhSZXNvdXJjZS5yZXN1bHR9I0AjJHt4cGF0aFJlc291cmNlVmVyaWZpZWQucmVzdWx0fQ==\"/>\n                                <L7p:ContentType stringValue=\"text/plain; charset=UTF-8\"/>\n                                <L7p:DataType variableDataType=\"message\"/>\n                                <L7p:VariableToSet stringValue=\"resp\"/>\n                            </L7p:SetVariable>\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${onetime}\"/>\n                                    <L7p:Expression2 stringValue=\"true\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:Encapsulated>\n                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"e5ee8bcf-1796-4297-88dd-c838031a6f6a\"/>\n                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cache Store\"/>\n                                    <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheID\"/>\n                                    <L7p:value stringValue=\"accessTokenValidation\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${cacheKey}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"doNotCacheSoapFaults\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntries\"/>\n                                    <L7p:value stringValue=\"100000\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntryAge\"/>\n                                    <L7p:value stringValue=\"${cache_lifetime}\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntrySize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"msg\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                    </L7p:entry>\n                                    </L7p:Parameters>\n                                </L7p:Encapsulated>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"caching\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"only if it is not a one time access_token\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:OneOrMore>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"collect validation response data\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// New validation\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                <L7p:VariableToSet stringValue=\"error.code\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"set error.code to '000' if we do not have one (which should not be the case)\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtlcnJvci5jb2RlfQ==\"/>\n                            <L7p:ContentType stringValue=\"text/plain; charset=UTF-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"resp\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"e5ee8bcf-1796-4297-88dd-c838031a6f6a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Cache Store\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheID\"/>\n                                    <L7p:value stringValue=\"accessTokenValidation\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"cacheKey\"/>\n                                    <L7p:value stringValue=\"${cacheKey}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"doNotCacheSoapFaults\"/>\n                                    <L7p:value stringValue=\"true\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntries\"/>\n                                    <L7p:value stringValue=\"100000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntryAge\"/>\n                                    <L7p:value stringValue=\"${cache_lifetime}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"maxEntrySize\"/>\n                                    <L7p:value stringValue=\"10000\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"msg\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validation error. Set cache content for invalid token to ''\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Validation\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:CommentAssertion>\n                    <L7p:Comment stringValue=\"Create response variables\"/>\n                </L7p:CommentAssertion>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:SetVariable>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"may contain an error.code\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLm1haW5wYXJ0fQ==\"/>\n                        <L7p:VariableToSet stringValue=\"resp\"/>\n                    </L7p:SetVariable>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:Regex>\n                            <L7p:AutoTarget booleanValue=\"false\"/>\n                            <L7p:CaptureVar stringValue=\"resp.details\"/>\n                            <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                            <L7p:Regex stringValue=\"(.{1,256})#@#(.{1,128})#@#(.{1,4000})#@#([0-9]{10})#@#(.*)#@#(.{0,4000})#@#(.{0,4000})\"/>\n                            <L7p:Replacement stringValue=\"\"/>\n                            <L7p:Target target=\"OTHER\"/>\n                        </L7p:Regex>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                <wsp:All wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${auth_scheme}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"WWW-Authenticate\"/>\n                                    <L7p:HeaderValue stringValue=\"${auth_scheme} error=&quot;Invalid request&quot;\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                    </L7p:AddHeader>\n                                </wsp:All>\n                                <L7p:TrueAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Add WWW-Authenticate header\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:OneOrMore>\n                            <L7p:Encapsulated>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"'resp' contains an error code, created during validation\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${resp}\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validation error. Set cache content for invalid token to ''\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:All>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"check if there is valid content. Respond with an error otherwise\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"MjAw\"/>\n                        <L7p:VariableToSet stringValue=\"status\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbMV19\"/>\n                        <L7p:VariableToSet stringValue=\"session.client_id\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbMl19\"/>\n                        <L7p:VariableToSet stringValue=\"session.subscriber_id\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbM119\"/>\n                        <L7p:VariableToSet stringValue=\"session.scope\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbNF19\"/>\n                        <L7p:VariableToSet stringValue=\"session.expires_at\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbNV19\"/>\n                        <L7p:VariableToSet stringValue=\"session.custom\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbNl19\"/>\n                        <L7p:VariableToSet stringValue=\"session.resource\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtyZXNwLmRldGFpbHNbN119\"/>\n                        <L7p:VariableToSet stringValue=\"session.resource_verified\"/>\n                    </L7p:SetVariable>\n                    <wsp:OneOrMore wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${session.act_claim}\"/>\n                            <L7p:Expression2 stringValue=\"\"/>\n                            <L7p:Negate booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${session.custom}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHtzZXNzaW9uLmN1c3RvbX0=\"/>\n                                <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                                <L7p:DataType variableDataType=\"message\"/>\n                                <L7p:VariableToSet stringValue=\"registered_token_all_custom\"/>\n                            </L7p:SetVariable>\n                            <L7p:EvaluateJsonPathExpressionV2>\n                                <L7p:Expression stringValue=\"act\"/>\n                                <L7p:OtherTargetMessageVariable stringValue=\"registered_token_all_custom\"/>\n                                <L7p:Target target=\"OTHER\"/>\n                                <L7p:VariablePrefix stringValue=\"actClaim\"/>\n                            </L7p:EvaluateJsonPathExpressionV2>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHthY3RDbGFpbS5yZXN1bHR9\"/>\n                                <L7p:VariableToSet stringValue=\"session.act_claim\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"\"/>\n                            <L7p:VariableToSet stringValue=\"session.act_claim\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// extract act claim from custom\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:OneOrMore>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"create response\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"BEARER token\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${auth_scheme}\"/>\n                    <L7p:Expression2 stringValue=\"MAC\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"MAC\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0Lmh0dHAubWV0aG9kfQ==\"/>\n                    <L7p:VariableToSet stringValue=\"request_http_method\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZXF1ZXN0LnVybH0=\"/>\n                    <L7p:VariableToSet stringValue=\"request_url\"/>\n                </L7p:SetVariable>\n                <L7p:CommentAssertion>\n                    <L7p:Comment stringValue=\"Caching is not possible for MAC token profile\"/>\n                </L7p:CommentAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${host_oauth_ovp_server}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item regex=\"included\">\n                                    <L7p:Pattern stringValue=\"http[s]?://(localhost|127[.]0[.]0[.]1).+\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"set local\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Set the location to validate access token\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                            <L7p:VariableToSet stringValue=\"isLocal\"/>\n                        </L7p:SetVariable>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"19902efe-b202-49da-a5d9-619c57ee842a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Get (token)\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"client_key\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"queryOffset\"/>\n                                    <L7p:value stringValue=\"0\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"return_json\"/>\n                                    <L7p:value stringValue=\"false\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"rtoken\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token\"/>\n                                    <L7p:value stringValue=\"${access_token}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"token_status\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"93e26a5f-02b5-4a0e-8d76-7ba7e171871a\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK OAuth 2.0 Token Validation - MAC\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"http_method\"/>\n                                    <L7p:value stringValue=\"${request_http_method}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"tokenValues\"/>\n                                    <L7p:value stringValue=\"resp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"url\"/>\n                                    <L7p:value stringValue=\"${request_url}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validate locally\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${isLocal}\"/>\n                            <L7p:Expression2 stringValue=\"false\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EncodeDecode>\n                            <L7p:SourceVariableName stringValue=\"request_url\"/>\n                            <L7p:TargetDataType variableDataType=\"string\"/>\n                            <L7p:TargetVariableName stringValue=\"request_url\"/>\n                            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n                        </L7p:EncodeDecode>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"YXV0aF9zY2hlbWU9TUFDJmh0dHBfbWV0aG9kPSR7cmVxdWVzdF9odHRwX21ldGhvZH0mdXJsPSR7cmVxdWVzdF91cmx9Jmlzb25ldGltZT0ke29uZXRpbWV9\"/>\n                            <L7p:ContentType stringValue=\"application/x-www-form-urlencoded; charset=UTF-8\"/>\n                            <L7p:DataType variableDataType=\"message\"/>\n                            <L7p:VariableToSet stringValue=\"req\"/>\n                        </L7p:SetVariable>\n                        <L7p:HttpRoutingAssertion>\n                            <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                            <L7p:FailOnErrorStatus booleanValue=\"false\"/>\n                            <L7p:HttpMethod httpMethod=\"POST\"/>\n                            <L7p:PassThroughSoapFaults booleanValue=\"false\"/>\n                            <L7p:ProtectedServiceUrl stringValue=\"${host_oauth_ovp_server}/oauth/validation/validate/v2/token\"/>\n                            <L7p:ProxyPassword stringValueNull=\"null\"/>\n                            <L7p:ProxyUsername stringValueNull=\"null\"/>\n                            <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                                <L7p:Rules httpPassthroughRules=\"included\">\n                                    <L7p:item httpPassthroughRule=\"included\">\n                                    <L7p:CustomizeValue stringValue=\"${auth_header}\"/>\n                                    <L7p:Name stringValue=\"authorization\"/>\n                                    <L7p:UsesCustomizedValue booleanValue=\"true\"/>\n                                    </L7p:item>\n                                </L7p:Rules>\n                            </L7p:RequestHeaderRules>\n                            <L7p:RequestMsgSrc stringValue=\"req\"/>\n                            <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                                <L7p:ForwardAll booleanValue=\"true\"/>\n                                <L7p:Rules httpPassthroughRules=\"included\"/>\n                            </L7p:RequestParamRules>\n                            <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                                <L7p:ForwardAll booleanValue=\"true\"/>\n                                <L7p:Rules httpPassthroughRules=\"included\">\n                                    <L7p:item httpPassthroughRule=\"included\">\n                                    <L7p:Name stringValue=\"Set-Cookie\"/>\n                                    </L7p:item>\n                                </L7p:Rules>\n                            </L7p:ResponseHeaderRules>\n                            <L7p:ResponseMsgDest stringValue=\"resp\"/>\n                            <L7p:SamlAssertionVersion intValue=\"2\"/>\n                        </L7p:HttpRoutingAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLmh0dHAuaGVhZGVyLngtY2EtZXJyfQ==\"/>\n                            <L7p:VariableToSet stringValue=\"error.code\"/>\n                        </L7p:SetVariable>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${httpRouting.reasonCode}\"/>\n                                <L7p:Expression2 stringValue=\"500\"/>\n                                <L7p:Operator operator=\"LT\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"LT\"/>\n                                    <L7p:RightValue stringValue=\"500\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Negate booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:AuditDetailAssertion>\n                                    <L7p:Detail stringValue=\"routing failed!\"/>\n                                </L7p:AuditDetailAssertion>\n                                <L7p:SetVariable>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"set error code to 000\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:Base64Expression stringValue=\"MDAw\"/>\n                                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                                </L7p:SetVariable>\n                                <L7p:FalseAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"routing errors\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"check if the routing assertion was successful\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                <L7p:Expression2 stringValue=\"\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:Regex>\n                                    <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"capture\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"capture the last 3 digits\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                    </L7p:AssertionComment>\n                                    <L7p:AutoTarget booleanValue=\"false\"/>\n                                    <L7p:OtherTargetMessageVariable stringValue=\"error.code\"/>\n                                    <L7p:Regex stringValue=\"(\\d{0,16})(\\d{3})$\"/>\n                                    <L7p:Replace booleanValue=\"true\"/>\n                                    <L7p:Replacement stringValue=\"$2\"/>\n                                    <L7p:Target target=\"OTHER\"/>\n                                </L7p:Regex>\n                                <L7p:FalseAssertion/>\n                                <L7p:assertionComment>\n                                    <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                    </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:assertionComment>\n                            </wsp:All>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"check for an error code\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtyZXNwLmh0dHAuaGVhZGVyLmNvbnRlbnQtdHlwZX0=\"/>\n                            <L7p:VariableToSet stringValue=\"content-type\"/>\n                        </L7p:SetVariable>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"validate remotely\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <wsp:All wsp:Usage=\"Required\">\n                                <L7p:ComparisonAssertion>\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Expression1 stringValue=\"${auth_scheme}\"/>\n                                    <L7p:Expression2 stringValue=\"\"/>\n                                    <L7p:Negate booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                    </L7p:Predicates>\n                                </L7p:ComparisonAssertion>\n                                <L7p:AddHeader>\n                                    <L7p:HeaderName stringValue=\"WWW-Authenticate\"/>\n                                    <L7p:HeaderValue stringValue=\"${auth_scheme} error=&quot;Invalid request&quot;\"/>\n                                    <L7p:Target target=\"RESPONSE\"/>\n                                </L7p:AddHeader>\n                            </wsp:All>\n                            <L7p:TrueAssertion/>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Add WWW-Authenticate header\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:Encapsulated>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error code provided by previous assertions\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"apiPrefix\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"givenErrorCode\"/>\n                                    <L7p:value stringValue=\"${error.code}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"Validation\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathClientId\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:validation/ns:client_key/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathOwner\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:validation/ns:resource_owner/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathScope\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:validation/ns:scope/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathExpiration\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:validation/ns:expiration/text()\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathCustom\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:validation/ns:custom\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-ovp\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"MjAw\"/>\n                        <L7p:VariableToSet stringValue=\"status\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aENsaWVudElkLnJlc3VsdH0=\"/>\n                        <L7p:VariableToSet stringValue=\"session.client_id\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aE93bmVyLnJlc3VsdH0=\"/>\n                        <L7p:VariableToSet stringValue=\"session.subscriber_id\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aFNjb3BlLnJlc3VsdH0=\"/>\n                        <L7p:VariableToSet stringValue=\"session.scope\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aEV4cGlyYXRpb24ucmVzdWx0fQ==\"/>\n                        <L7p:VariableToSet stringValue=\"session.expires_at\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aEN1c3RvbS5yZXN1bHR9\"/>\n                        <L7p:VariableToSet stringValue=\"session.custom\"/>\n                    </L7p:SetVariable>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"create response variables\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:All>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"MAC token\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Encapsulated>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"000\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"something unknown happened\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"apiPrefix\"/>\n                            <L7p:value stringValue=\"\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"givenErrorCode\"/>\n                            <L7p:value stringValue=\"000\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"error. Something unexpected happened\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"validate\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}