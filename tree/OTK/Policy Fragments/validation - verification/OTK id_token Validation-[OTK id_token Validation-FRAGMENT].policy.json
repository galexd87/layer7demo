{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fd133",
  "guid": "727ab65b-2d8e-4af6-89eb-0a6afc0a08df",
  "name": "OTK id_token Validation",
  "policyType": "FRAGMENT",
  "checksum": "2a322bf5c52b6f7349d14f07089afe4e547043b1",
  "folderPath": "/OTK/Policy Fragments/validation - verification",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === ***  THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === Required changes can be implemented in policies in the 'Customizations' folder \"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === Suffixed policies can be used to extend functionality\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === If you find you cannot add your customizations using the policies in the 'Customizations' folder\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === please contact CA APIM Support so we can improve customization capability\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This policy can be found and should be used as 'Encapsulated Assertion'!\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"NDAw\"/>\n            <L7p:VariableToSet stringValue=\"status\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"dGV4dC94bWw7Y2hhcnNldD1VVEYtOA==\"/>\n            <L7p:VariableToSet stringValue=\"content-type\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"will be overwritten in the case of an error\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"error.code\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"third_party_sso_token\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"third_party_sso_token_type\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"initialize\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"PHRoaXJkX3BhcnR5X3Nzb190b2tlbj48L3RoaXJkX3BhcnR5X3Nzb190b2tlbj4NCjx0aGlyZF9wYXJ0eV9zc29fdG9rZW5fdHlwZT48L3RoaXJkX3BhcnR5X3Nzb190b2tlbl90eXBlPg==\"/>\n            <L7p:VariableToSet stringValue=\"third_party_sso_resp_elements\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:Regex>\n                    <L7p:AutoTarget booleanValue=\"false\"/>\n                    <L7p:CaptureVar stringValue=\"jwt.payload\"/>\n                    <L7p:IncludeEntireExpressionCapture booleanValue=\"false\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"jwt\"/>\n                    <L7p:Regex stringValue=\".[.](.+)[.]\"/>\n                    <L7p:RegexName stringValue=\"extract payload from JWT\"/>\n                    <L7p:Replacement stringValue=\"\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:Regex>\n                <L7p:EncodeDecode>\n                    <L7p:SourceVariableName stringValue=\"jwt.payload\"/>\n                    <L7p:TargetDataType variableDataType=\"string\"/>\n                    <L7p:TargetVariableName stringValue=\"jwt.payload\"/>\n                    <L7p:TransformType transformType=\"BASE64_DECODE\"/>\n                </L7p:EncodeDecode>\n                <L7p:CustomAssertion>\n                    <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAAHdAAfTWVzc2FnZVZhbGlkYXRpb25UcmFuc2Zvcm1hdGlvbnhwc3IARGNvbS5sN3RlY2guY3VzdG9tLm9wZW5pZGNvbm5lY3QuRGVjb2RlSURUb2tlbi5JRFRva2VuRGVjb2RlQXNzZXJ0aW9uxl6qBXO//LkCABNaAAlleHBvcnRBY3JaAAlleHBvcnRBbGxaAAxleHBvcnRBdEhhc2haAAlleHBvcnRBdWRaAA5leHBvcnRBdXRoVGltZVoACWV4cG9ydEF6cFoAC2V4cG9ydENIYXNoWgAQZXhwb3J0RXhwaXJhdGlvbloACWV4cG9ydElhdFoACWV4cG9ydElzc1oAC2V4cG9ydE5vbmNlWgARZXhwb3J0T3RoZXJDbGFpbXNaAAtleHBvcnRTSGFzaFoACWV4cG9ydFN1YloADnZhbGlkYXRlQ2xhaW1zWgASdmFsaWRhdGVFeHBpcmF0aW9uTAATYWxsb3dlZEN1c3RvbUNsYWltc3EAfgAETAAOZXhwb3J0VmFyaWFibGVxAH4ABEwAB3BheWxvYWRxAH4ABHhwAAAAAAABAAAAAQAAAAEAAHQAAHQABGRpZHR0AA4ke2p3dC5wYXlsb2FkfXQAGk9wZW5JRENvbm5lY3RBc3NlcnRpb24uamFydAAuRGVjb2RlcyBhbiBJRCBUb2tlbiBwYXNzZWQgaW4gYXMgSlNPTiBtZXNzYWdlLnBwcA==</L7p:base64SerializedValue>\n                </L7p:CustomAssertion>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:AuditDetailAssertion>\n                    <L7p:Detail stringValue=\"Given JWT is invalid: '${jwt}'\"/>\n                </L7p:AuditDetailAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTIx\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"== EXTRACT\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Get payload from JWT and extract the json into variables\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:Encapsulated>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// ${subject_type}, ${id_token_signing_algorithm}, ${iss}\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"21b101c5-5701-4ca2-9206-237f8b37bfe8\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK id_token configuration\"/>\n        </L7p:Encapsulated>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${shared_secret_alg}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:SetVariable>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"==\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// valid values:  HS256, RS256 or CUSTOM\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:Base64Expression stringValue=\"JHtzaGFyZWRfc2VjcmV0X2FsZ30=\"/>\n                <L7p:VariableToSet stringValue=\"id_token_signing_algorithm\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"alg\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// choose the algorithm. Either the configured one or the runtime one\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${didt.iss}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"${iss}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${shared_secret}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${resource_owner}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${azp}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${salt}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// if any required params are missing, look them up\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:Encapsulated>\n                            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"755e056d-fe4a-440c-81ac-cc76dfd58899\"/>\n                            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK id_token Lookup\"/>\n                            <L7p:Parameters mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"azp\"/>\n                                    <L7p:value stringValue=\"${didt.azp}\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"format\"/>\n                                    <L7p:value stringValue=\"xml\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"jwt\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"resource_owner\"/>\n                                    <L7p:value stringValue=\"\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"sub\"/>\n                                    <L7p:value stringValue=\"${didt.sub}\"/>\n                                </L7p:entry>\n                            </L7p:Parameters>\n                        </L7p:Encapsulated>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathResourceOwner\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:resource_owner/text()\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathSharedSecret\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:shared_secret/text()\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathAzp\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:azp/text()\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:VariablePrefix stringValue=\"xpathSalt\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:salt/text()\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${shared_secret}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHt4cGF0aFNoYXJlZFNlY3JldC5yZXN1bHR9\"/>\n                                <L7p:VariableToSet stringValue=\"shared_secret\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// shared_secret\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${resource_owner}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHt4cGF0aFJlc291cmNlT3duZXIucmVzdWx0fQ==\"/>\n                                <L7p:VariableToSet stringValue=\"resource_owner\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// resource_owner\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${azp}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHt4cGF0aEF6cC5yZXN1bHR9\"/>\n                                <L7p:VariableToSet stringValue=\"azp\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// azp\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${salt}\"/>\n                                <L7p:Operator operatorNull=\"null\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                    </L7p:item>\n                                    <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"JHt4cGF0aFNhbHQucmVzdWx0fQ==\"/>\n                                <L7p:VariableToSet stringValue=\"salt\"/>\n                            </L7p:SetVariable>\n                            <L7p:assertionComment>\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// salt\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:assertionComment>\n                        </wsp:OneOrMore>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"== LOOKUP\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// check if lookup needed\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${id_token_signing_algorithm}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"hs256\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"4c971df6-233e-4b33-b40f-c8cad59883c7\"/>\n                        </L7p:Include>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// HS256\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${id_token_signing_algorithm}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"PS256\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"dd4477b5-de81-438e-96ac-5fedacd62682\"/>\n                        </L7p:Include>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// PS256\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${id_token_signing_algorithm}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:RightValue stringValue=\"HS256\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:RightValue stringValue=\"PS256\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:Include>\n                            <L7p:PolicyGuid stringValue=\"f989cf1d-5fbb-4267-860f-072c0829d555\"/>\n                        </L7p:Include>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// Any other algorithm\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <L7p:assertionComment>\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Choose Algorithm\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:assertionComment>\n                </wsp:OneOrMore>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"06247a28-fa89-4967-8a4d-b6f3769b46f1\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"MAG Extract Third Party SSO Token\"/>\n                    <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PCFbQ0RBVEFbJHt0aGlyZF9wYXJ0eV9zc29fdG9rZW59XV0+\"/>\n                    <L7p:VariableToSet stringValue=\"third_party_sso_token\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"PCFbQ0RBVEFbJHt0aGlyZF9wYXJ0eV9zc29fdG9rZW5fdHlwZX1dXT4=\"/>\n                    <L7p:VariableToSet stringValue=\"third_party_sso_token_type\"/>\n                </L7p:SetVariable>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"68ce345d-8f7e-41a0-8f0a-81ec59096884\"/>\n                </L7p:Include>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${check_expiration}\"/>\n                            <L7p:Expression2 stringValue=\"true\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"true\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:CustomAssertion>\n                            <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAAHdAAfTWVzc2FnZVZhbGlkYXRpb25UcmFuc2Zvcm1hdGlvbnhwc3IARGNvbS5sN3RlY2guY3VzdG9tLm9wZW5pZGNvbm5lY3QuRGVjb2RlSURUb2tlbi5JRFRva2VuRGVjb2RlQXNzZXJ0aW9uxl6qBXO//LkCABNaAAlleHBvcnRBY3JaAAlleHBvcnRBbGxaAAxleHBvcnRBdEhhc2haAAlleHBvcnRBdWRaAA5leHBvcnRBdXRoVGltZVoACWV4cG9ydEF6cFoAC2V4cG9ydENIYXNoWgAQZXhwb3J0RXhwaXJhdGlvbloACWV4cG9ydElhdFoACWV4cG9ydElzc1oAC2V4cG9ydE5vbmNlWgARZXhwb3J0T3RoZXJDbGFpbXNaAAtleHBvcnRTSGFzaFoACWV4cG9ydFN1YloADnZhbGlkYXRlQ2xhaW1zWgASdmFsaWRhdGVFeHBpcmF0aW9uTAATYWxsb3dlZEN1c3RvbUNsYWltc3EAfgAETAAOZXhwb3J0VmFyaWFibGVxAH4ABEwAB3BheWxvYWRxAH4ABHhwAQAAAQEBAAEAAQABAAEBAXQAGCR7YWxsb3dlZF9jdXN0b21fY2xhaW1zfXQABGRpZHR0ABMke2lkX3Rva2VuLnBheWxvYWR9dAAaT3BlbklEQ29ubmVjdEFzc2VydGlvbi5qYXJ0AC5EZWNvZGVzIGFuIElEIFRva2VuIHBhc3NlZCBpbiBhcyBKU09OIG1lc3NhZ2UucHBw</L7p:base64SerializedValue>\n                        </L7p:CustomAssertion>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"with expiration\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${check_expiration}\"/>\n                            <L7p:Expression2 stringValue=\"false\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                    <L7p:RightValue stringValue=\"false\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:CustomAssertion>\n                            <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAAHdAAfTWVzc2FnZVZhbGlkYXRpb25UcmFuc2Zvcm1hdGlvbnhwc3IARGNvbS5sN3RlY2guY3VzdG9tLm9wZW5pZGNvbm5lY3QuRGVjb2RlSURUb2tlbi5JRFRva2VuRGVjb2RlQXNzZXJ0aW9uxl6qBXO//LkCABNaAAlleHBvcnRBY3JaAAlleHBvcnRBbGxaAAxleHBvcnRBdEhhc2haAAlleHBvcnRBdWRaAA5leHBvcnRBdXRoVGltZVoACWV4cG9ydEF6cFoAC2V4cG9ydENIYXNoWgAQZXhwb3J0RXhwaXJhdGlvbloACWV4cG9ydElhdFoACWV4cG9ydElzc1oAC2V4cG9ydE5vbmNlWgARZXhwb3J0T3RoZXJDbGFpbXNaAAtleHBvcnRTSGFzaFoACWV4cG9ydFN1YloADnZhbGlkYXRlQ2xhaW1zWgASdmFsaWRhdGVFeHBpcmF0aW9uTAATYWxsb3dlZEN1c3RvbUNsYWltc3EAfgAETAAOZXhwb3J0VmFyaWFibGVxAH4ABEwAB3BheWxvYWRxAH4ABHhwAQAAAQEBAAEAAQABAAEBAHQAGCR7YWxsb3dlZF9jdXN0b21fY2xhaW1zfXQABGRpZHR0ABMke2lkX3Rva2VuLnBheWxvYWR9dAAaT3BlbklEQ29ubmVjdEFzc2VydGlvbi5qYXJ0AC5EZWNvZGVzIGFuIElEIFRva2VuIHBhc3NlZCBpbiBhcyBKU09OIG1lc3NhZ2UucHBw</L7p:base64SerializedValue>\n                        </L7p:CustomAssertion>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"without expiration\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:AuditDetailAssertion>\n                            <L7p:Detail stringValue=\"The id_token is invalid: '${id_token.payload}'\"/>\n                        </L7p:AuditDetailAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"MTIw\"/>\n                            <L7p:VariableToSet stringValue=\"error.code\"/>\n                        </L7p:SetVariable>\n                        <L7p:FalseAssertion/>\n                        <L7p:assertionComment>\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                    <L7p:value stringValue=\"error\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:assertionComment>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${azp}\"/>\n                        <L7p:Expression2 stringValue=\"${didt.azp}\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"${didt.azp}\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:AuditDetailAssertion>\n                            <L7p:Detail stringValue=\"The azp is not valid for this id_token: azp: '${didt.azp}', expected: '${azp}'\"/>\n                        </L7p:AuditDetailAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"MTE3\"/>\n                            <L7p:VariableToSet stringValue=\"error.code\"/>\n                        </L7p:SetVariable>\n                        <L7p:FalseAssertion/>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"d881a6b7-113c-4688-8a9c-17f5c0426972\"/>\n                </L7p:Include>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4abca6f4-c8e6-47e7-b99e-bd1c2202fdca\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"MAG Variable third_party_sso_resp_elements\"/>\n                    <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n                </L7p:Encapsulated>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// default iss\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${didt.iss}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:RightValue stringValue=\"${iss}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:Include>\n                    <L7p:PolicyGuid stringValue=\"99ab9e0f-5b60-45d5-8148-f345ad57237d\"/>\n                </L7p:Include>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// custom iss\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:AuditDetailAssertion>\n                    <L7p:Detail stringValue=\"Given ISS is invalid: '${didt.iss}', configured iss = '${iss}'\"/>\n                </L7p:AuditDetailAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTIx\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"error\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// no valid ISS\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"==Validate\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Based on iss from payload, select an algorithm\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${azp}\"/>\n                <L7p:Expression2 stringValue=\"${didt.azp}\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"${didt.azp}\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:AuditDetailAssertion>\n                    <L7p:Detail stringValue=\"The azp is not valid for this id_token: azp: '${didt.azp}', expected: '${azp}'\"/>\n                </L7p:AuditDetailAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTE3\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"third_party_sso_resp_elements\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtkaWR0Lm1heV9hY3R9\"/>\n            <L7p:VariableToSet stringValue=\"may_act_claim\"/>\n        </L7p:SetVariable>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"4abca6f4-c8e6-47e7-b99e-bd1c2202fdca\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"MAG Variable third_party_sso_resp_elements\"/>\n            <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n        </L7p:Encapsulated>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"MjAw\"/>\n            <L7p:VariableToSet stringValue=\"status\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"PHZhbGlkYXRpb24geG1sbnM9Imh0dHA6Ly9ucy5sN3RlY2guY29tLzIwMTIvMTEvb3RrLW92cCI+DQogPHJlc3VsdD52YWxpZDwvcmVzdWx0Pg0KIDxyZXNvdXJjZV9vd25lcj48IVtDREFUQVske3Jlc291cmNlX293bmVyfV1dPjwvcmVzb3VyY2Vfb3duZXI+DQogPGlzcz48IVtDREFUQVske2RpZHQuaXNzfV1dPjwvaXNzPg0KIDxzdWI+PCFbQ0RBVEFbJHtkaWR0LnN1Yn1dXT48L3N1Yj4NCiA8YXVkPjwhW0NEQVRBWyR7ZGlkdC5hdWR9XV0+PC9hdWQ+DQogPGV4cGlyYXRpb24+PCFbQ0RBVEFbJHtkaWR0LmV4cH1dXT48L2V4cGlyYXRpb24+DQogPGF6cD48IVtDREFUQVske2RpZHQuYXpwfV1dPjwvYXpwPg0KIDxhY3I+PCFbQ0RBVEFbJHtkaWR0LmFjcn1dXT48L2Fjcj4NCiA8c2FsdD48IVtDREFUQVske3NhbHR9XV0+PC9zYWx0Pg0KIDxhdXRoX3RpbWU+PCFbQ0RBVEFbJHtkaWR0LmF1dGhfdGltZX1dXT48L2F1dGhfdGltZT4NCiR7dGhpcmRfcGFydHlfc3NvX3Jlc3BfZWxlbWVudHN9DQo8L3ZhbGlkYXRpb24+\"/>\n            <L7p:ContentType stringValue=\"text/xml;charset=UTF-8\"/>\n            <L7p:DataType variableDataType=\"message\"/>\n            <L7p:VariableToSet stringValue=\"resp\"/>\n        </L7p:SetVariable>\n    </wsp:All>\n</wsp:Policy>"
  }
}