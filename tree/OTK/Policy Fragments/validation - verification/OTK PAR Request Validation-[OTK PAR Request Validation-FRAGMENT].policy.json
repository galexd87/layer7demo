{
  "goid": "9110b71318cba425cac48980b7e7d399",
  "guid": "848e037e-6e66-4af3-994a-0a39b9b830d6",
  "name": "OTK PAR Request Validation",
  "policyType": "FRAGMENT",
  "checksum": "2024335211d8d72774d7a09e0d979fae5368b57b",
  "folderPath": "/OTK/Policy Fragments/validation - verification",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Policy Fragment: OTK PAR Request Validation\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtjbGllbnRfaWR9\"/>\n            <L7p:VariableToSet stringValue=\"client_id_param\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n            <L7p:VariableToSet stringValue=\"return_json\"/>\n        </L7p:SetVariable>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b776a5d6-2c96-47da-bfb3-ba25bdc91f66\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK PAR Read\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"request_uri\"/>\n                    <L7p:value stringValue=\"${request_uri_reference}\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <L7p:ResponseXpathAssertion>\n            <L7p:VariablePrefix stringValue=\"xpathParExpiration\"/>\n            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:expiration/text()\"/>\n                <L7p:Namespaces mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"ns\"/>\n                        <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"s\"/>\n                        <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                    </L7p:entry>\n                </L7p:Namespaces>\n                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n            </L7p:XpathExpression>\n        </L7p:ResponseXpathAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHt4cGF0aFBhckV4cGlyYXRpb24ucmVzdWx0fQ==\"/>\n            <L7p:DataType variableDataType=\"dateTime\"/>\n            <L7p:DateOffsetExpression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"parExpiration\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"\"/>\n            <L7p:DataType variableDataType=\"dateTime\"/>\n            <L7p:DateOffsetExpression stringValue=\"\"/>\n            <L7p:VariableToSet stringValue=\"now\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${parExpiration.seconds}\"/>\n                <L7p:Expression2 stringValue=\"${now.seconds}\"/>\n                <L7p:Operator operator=\"GT\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Operator operator=\"GT\"/>\n                        <L7p:RightValue stringValue=\"${now.seconds}\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"Mzkw\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// validate par expiration\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:ResponseXpathAssertion>\n            <L7p:VariablePrefix stringValue=\"xpathParRequestValue\"/>\n            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                <L7p:Expression stringValue=\"/ns:values/ns:value/ns:request_value/text()\"/>\n                <L7p:Namespaces mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"ns\"/>\n                        <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-tokenstore\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"s\"/>\n                        <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                    </L7p:entry>\n                </L7p:Namespaces>\n                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n            </L7p:XpathExpression>\n        </L7p:ResponseXpathAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHt4cGF0aFBhclJlcXVlc3RWYWx1ZS5yZXN1bHR9\"/>\n            <L7p:VariableToSet stringValue=\"parRequestValueJson\"/>\n        </L7p:SetVariable>\n        <L7p:Encapsulated>\n            <L7p:EncapsulatedAssertionConfigGuid stringValue=\"d036e40b-5c8d-4b1e-abf3-dd44956ab621\"/>\n            <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK PAR Write\"/>\n            <L7p:Parameters mapValue=\"included\">\n                <L7p:entry>\n                    <L7p:key stringValue=\"custom\"/>\n                    <L7p:value stringValue=\"\"/>\n                </L7p:entry>\n                <L7p:entry>\n                    <L7p:key stringValue=\"expiration\"/>\n                    <L7p:value stringValue=\"\"/>\n                </L7p:entry>\n                <L7p:entry>\n                    <L7p:key stringValue=\"operation\"/>\n                    <L7p:value stringValue=\"delete\"/>\n                </L7p:entry>\n                <L7p:entry>\n                    <L7p:key stringValue=\"request_uri\"/>\n                    <L7p:value stringValue=\"${request_uri_reference}\"/>\n                </L7p:entry>\n                <L7p:entry>\n                    <L7p:key stringValue=\"request_value\"/>\n                    <L7p:value stringValue=\"\"/>\n                </L7p:entry>\n            </L7p:Parameters>\n        </L7p:Encapsulated>\n        <L7p:CustomAssertion>\n            <L7p:base64SerializedValue>rO0ABXNyADFjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uQ3VzdG9tQXNzZXJ0aW9uSG9sZGVyZtcreFwddTICAAlaAAxpc1VpQXV0b09wZW5MAApjYXRlZ29yaWVzdAAPTGphdmEvdXRpbC9TZXQ7TAAIY2F0ZWdvcnl0ACpMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DYXRlZ29yeTtMAA9jdXN0b21Bc3NlcnRpb250ADFMY29tL2w3dGVjaC9wb2xpY3kvYXNzZXJ0aW9uL2V4dC9DdXN0b21Bc3NlcnRpb247TAAUY3VzdG9tTW9kdWxlRmlsZU5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMAA9kZXNjcmlwdGlvblRleHRxAH4ABEwAD3BhbGV0dGVOb2RlTmFtZXEAfgAETAAOcG9saWN5Tm9kZU5hbWVxAH4ABEwAHnJlZ2lzdGVyZWRDdXN0b21GZWF0dXJlU2V0TmFtZXEAfgAEeHIAJWNvbS5sN3RlY2gucG9saWN5LmFzc2VydGlvbi5Bc3NlcnRpb27bX2OZPL2isQIAAloAB2VuYWJsZWRMABBhc3NlcnRpb25Db21tZW50dAAvTGNvbS9sN3RlY2gvcG9saWN5L2Fzc2VydGlvbi9Bc3NlcnRpb24kQ29tbWVudDt4cAFwAXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyAChjb20ubDd0ZWNoLnBvbGljeS5hc3NlcnRpb24uZXh0LkNhdGVnb3J5WrCcZaFE/jUCAAJJAAVteUtleUwABm15TmFtZXEAfgAEeHAAAAALdAAQQ3VzdG9tQXNzZXJ0aW9uc3hwc3IAMmNvbS5sN3RlY2guY3VzdG9tLmp3dC5kZWNvZGVqd3QuRGVjb2RlSldUQXNzZXJ0aW9uxl6qBXO//LkCAAVaAAlleHBvcnRBbGxaABJ2YWxpZGF0ZUV4cGlyYXRpb25MAAxleHBvcnRDbGFpbXNxAH4ABEwAB3BheWxvYWRxAH4ABEwADnJlcXVpcmVkQ2xhaW1zcQB+AAR4cAEAdAAAdAAWJHtwYXJSZXF1ZXN0VmFsdWVKc29ufXQAAHQANGVmMmEzMmRmNThlZGU0NWQyNDJjOWZjOTM0MDZiN2JmNTkzNTYwM2QxZjUyYWY1ZC5qYXJ0ADBEZWNvZGVzIGEgSldUIFBheWxvYWQgcGFzc2VkIGluIGFzIEpTT04gbWVzc2FnZS50ABJEZWNvZGUgSldUIFBheWxvYWR0ABJEZWNvZGUgSldUIFBheWxvYWRw</L7p:base64SerializedValue>\n        </L7p:CustomAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${client_id_param}\"/>\n                <L7p:Expression2 stringValue=\"${client_id}\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"${client_id}\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTg5\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// validate client id\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${codeChallengeEncoded}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Negate booleanValue=\"true\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtjb2RlQ2hhbGxlbmdlRW5jb2RlZH0=\"/>\n                    <L7p:VariableToSet stringValue=\"codeChallenge\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:VariableToSet stringValue=\"codeChallenge\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// get codechallenge\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"display\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"displayEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"prompt\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"promptEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"id_token_hint\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"id_token_hintEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"login_hint\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"login_hintEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"scope\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"scopeOriginalEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"resource\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"resourceOriginalEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"scope_verified\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathScopeEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"resource_verified\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathResourceEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"client_name\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathNameEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"redirect_uri_verified\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathRedirectURIEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"response_type\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathResponseTypeEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"response_mode\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"xpathResponseModeEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"client_id\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"client_idEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"client_ident\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"clientIdentEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${codeChallenge}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:MultivaluedComparison multivaluedComparison=\"FAIL\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${codeChallenge}\"/>\n                    <L7p:MultivaluedComparison multivaluedComparison=\"FAIL\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item regex=\"included\">\n                            <L7p:Pattern stringValue=\".{0}|[\\w\\d-_~.]{43,128}\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${codeChallengeMethod}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${codeChallengeMethod}\"/>\n                        <L7p:Expression2 stringValue=\"plain\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:RightValue stringValue=\"plain\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:ComparisonAssertion>\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Expression1 stringValue=\"${codeChallengeMethod}\"/>\n                        <L7p:Expression2 stringValue=\"s256\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:RightValue stringValue=\"s256\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                </wsp:OneOrMore>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTEy\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZWRpcmVjdF91cml9\"/>\n                    <L7p:VariableToSet stringValue=\"error_redirect_uri\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"PKCE\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${oauth2_profile.fapi_baseline}\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"string\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"false\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:ComparisonAssertion>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${oauth2_profile.fapi_advanced}\"/>\n                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                <L7p:Operator operatorNull=\"null\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item dataType=\"included\">\n                        <L7p:Type variableDataType=\"string\"/>\n                    </L7p:item>\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"true\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${codeChallenge}\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:Negated booleanValue=\"true\"/>\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"false\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${codeChallengeMethod}\"/>\n                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:RightValue stringValue=\"S256\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MTEy\"/>\n                    <L7p:VariableToSet stringValue=\"error.code\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtyZWRpcmVjdF91cml9\"/>\n                    <L7p:VariableToSet stringValue=\"error_redirect_uri\"/>\n                </L7p:SetVariable>\n                <L7p:FalseAssertion/>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"PKCE\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtjbGllbnRfdHlwZX0=\"/>\n            <L7p:VariableToSet stringValue=\"xpathClientTypeEncoded\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtjbGllbnRfY3VzdG9tfQ==\"/>\n            <L7p:VariableToSet stringValue=\"xpathClientCustomEncoded\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtjbGllbnRfa2V5X2N1c3RvbX0=\"/>\n            <L7p:VariableToSet stringValue=\"xpathClientKeyCustomEncoded\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtjbGllbnRfa2V5X2N1c3RvbX0=\"/>\n            <L7p:VariableToSet stringValue=\"xpathClientKeyCustom.result\"/>\n        </L7p:SetVariable>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"redirect_uri\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"redirectURIEncoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n    </wsp:All>\n</wsp:Policy>"
  }
}