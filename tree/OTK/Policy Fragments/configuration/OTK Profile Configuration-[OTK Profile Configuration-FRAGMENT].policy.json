{
  "goid": "2a93e2b64633d7874eb692e23adc6c42",
  "guid": "7e2f84c6-f8b6-423f-ba2a-bd802fa9a17d",
  "name": "OTK Profile Configuration",
  "policyType": "FRAGMENT",
  "checksum": "f3965dfa6f34181e5aba9fa16ba63a514cd5db8a",
  "folderPath": "/OTK/Policy Fragments/configuration",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === ***  THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === Required changes can be implemented in policies in the 'Customizations' folder \"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === The policies within that folder will have the same name as this policy but \"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === either prefixed with '#' or suffixed with 'Extensions'\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === Prefixed policies can be used to overwrite variables of this policy\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === Suffixed policies can be used to extend functionality\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === If you find you cannot add your customizations using the policies in the 'Customizations' folder\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === please contact CA APIM Support so we can improve customization capability\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This policy can be found and should be used as 'Encapsulated Assertion'!\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n            <L7p:VariableToSet stringValue=\"oauth2_profile.default\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtnYXRld2F5Lm90ay5mYXBpX2Jhc2VsaW5lLmVuYWJsZWR9\"/>\n            <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_baseline\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtnYXRld2F5Lm90ay5mYXBpX2FkdmFuY2VkLmVuYWJsZWR9\"/>\n            <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_advanced\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${oauth2_profile.fapi_advanced}\"/>\n                <L7p:Expression2 stringValue=\"false\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"false\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_baseline\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// fapi_advanced includes fapi_baseline\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${oauth2_profile.fapi_baseline}\"/>\n                <L7p:Expression2 stringValue=\"true\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"true\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                <L7p:VariableToSet stringValue=\"oauth2_profile.default\"/>\n            </L7p:SetVariable>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// select oauth2_profile.default if no other profile is enabled\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <wsp:All wsp:Usage=\"Required\">\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${client_key_custom}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Negate booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Negated booleanValue=\"true\"/>\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtjbGllbnRfa2V5X2N1c3RvbX0=\"/>\n                        <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                        <L7p:DataType variableDataType=\"message\"/>\n                        <L7p:VariableToSet stringValue=\"clientKeyCustom\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${client_id}\"/>\n                        <L7p:Expression2 stringValue=\"\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:Operator operator=\"EMPTY\"/>\n                                <L7p:RightValue stringValue=\"\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"e30=\"/>\n                        <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                        <L7p:DataType variableDataType=\"message\"/>\n                        <L7p:VariableToSet stringValue=\"clientKeyCustom\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:Encapsulated>\n                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"290511a8-b775-47a7-98ab-7be386da2105\"/>\n                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client GET\"/>\n                        <L7p:Parameters mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"client_ident\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"client_key\"/>\n                                <L7p:value stringValue=\"${client_id}\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"custom\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"environment\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"filterStatus\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"format\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"master\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"name\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"operation\"/>\n                                <L7p:value stringValue=\"getAll\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"org\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"queryOffset\"/>\n                                <L7p:value stringValue=\"0\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"registered_by\"/>\n                                <L7p:value stringValue=\"\"/>\n                            </L7p:entry>\n                        </L7p:Parameters>\n                    </L7p:Encapsulated>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ResponseXpathAssertion>\n                            <L7p:AssertionComment assertionComment=\"included\">\n                                <L7p:Properties mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"Verify the client is not using a master key.\"/>\n                                    </L7p:entry>\n                                </L7p:Properties>\n                            </L7p:AssertionComment>\n                            <L7p:VariablePrefix stringValue=\"xpathMasterKeyFlag\"/>\n                            <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                <L7p:Expression stringValue=\"/ns:values/ns:keys/ns:values/ns:value/ns:masterkey_flag\"/>\n                                <L7p:Namespaces mapValue=\"included\">\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-clientstore\"/>\n                                    </L7p:entry>\n                                    <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                    </L7p:entry>\n                                </L7p:Namespaces>\n                                <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                            </L7p:XpathExpression>\n                        </L7p:ResponseXpathAssertion>\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${xpathMasterKeyFlag.result}\"/>\n                            <L7p:Expression2 stringValue=\"0\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"0\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                    </wsp:All>\n                    <L7p:ResponseXpathAssertion>\n                        <L7p:VariablePrefix stringValue=\"xpathClientKeyCustom\"/>\n                        <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                        <L7p:XpathExpression xpathExpressionValue=\"included\">\n                            <L7p:Expression stringValue=\"/ns:values/ns:keys/ns:values/ns:value/ns:client_key_custom\"/>\n                            <L7p:Namespaces mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"ns\"/>\n                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-clientstore\"/>\n                                </L7p:entry>\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"s\"/>\n                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                </L7p:entry>\n                            </L7p:Namespaces>\n                            <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                        </L7p:XpathExpression>\n                    </L7p:ResponseXpathAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHt4cGF0aENsaWVudEtleUN1c3RvbS5yZXN1bHR9\"/>\n                        <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                        <L7p:DataType variableDataType=\"message\"/>\n                        <L7p:VariableToSet stringValue=\"clientKeyCustom\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"e30=\"/>\n                    <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"clientKeyCustom\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// get client key custom from db if given client_key_custom is empty\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:EvaluateJsonPathExpressionV2>\n                        <L7p:AssertionComment assertionComment=\"included\">\n                            <L7p:Properties mapValue=\"included\">\n                                <L7p:entry>\n                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                    <L7p:value stringValue=\"// fapi_profile\"/>\n                                </L7p:entry>\n                            </L7p:Properties>\n                        </L7p:AssertionComment>\n                        <L7p:Expression stringValue=\"openid_registration.response.fapi_profile\"/>\n                        <L7p:OtherTargetMessageVariable stringValue=\"clientKeyCustom\"/>\n                        <L7p:Target target=\"OTHER\"/>\n                        <L7p:VariablePrefix stringValue=\"fapiProfile\"/>\n                    </L7p:EvaluateJsonPathExpressionV2>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"JHtmYXBpUHJvZmlsZS5yZXN1bHR9\"/>\n                        <L7p:VariableToSet stringValue=\"fapiProfileValue\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"\"/>\n                    <L7p:VariableToSet stringValue=\"fapiProfileValue\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// extract fapi_profile from client key custom\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:Expression1 stringValue=\"${fapiProfileValue}\"/>\n                    <L7p:Expression2 stringValue=\"\"/>\n                    <L7p:Operator operator=\"EMPTY\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item binary=\"included\">\n                            <L7p:Operator operator=\"EMPTY\"/>\n                            <L7p:RightValue stringValue=\"\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${fapiProfileValue}\"/>\n                        <L7p:Expression2 stringValue=\"advanced\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"advanced\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                        <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_advanced\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                        <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_baseline\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${fapiProfileValue}\"/>\n                        <L7p:Expression2 stringValue=\"baseline\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"baseline\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                        <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_baseline\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${fapiProfileValue}\"/>\n                        <L7p:Expression2 stringValue=\"none\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"none\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n                        <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_baseline\"/>\n                    </L7p:SetVariable>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n                        <L7p:VariableToSet stringValue=\"oauth2_profile.fapi_advanced\"/>\n                    </L7p:SetVariable>\n                </wsp:All>\n                <L7p:TrueAssertion/>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// set profile based on fapi_profile value\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"//override with client level fapi settings\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:Include>\n            <L7p:PolicyGuid stringValue=\"65160b39-84e5-4e02-ab75-9888ecdfa67b\"/>\n            <L7p:PolicyName stringValue=\"#OTK Profile Configuration\"/>\n        </L7p:Include>\n    </wsp:All>\n</wsp:Policy>"
  }
}