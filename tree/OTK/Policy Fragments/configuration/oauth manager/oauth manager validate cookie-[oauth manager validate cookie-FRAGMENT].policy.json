{
  "goid": "e001cfd0c1c1ffaa18e187b5e72fe990",
  "guid": "3d18cfd8-631f-48f1-b154-c11b85df2fb9",
  "name": "oauth manager validate cookie",
  "policyType": "FRAGMENT",
  "checksum": "2f9287456d3e86be3e0cafd2f96af55e39441b07",
  "folderPath": "/OTK/Policy Fragments/configuration/oauth manager",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === ***  THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === If you have the need to customize this policy\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === please contact CA APIM Support so we can improve customization capability\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== This policy validates the cookie used with OAuth Manager\"/>\n        </L7p:CommentAssertion>\n        <L7p:CookieCredentialSource>\n            <L7p:CookieName stringValue=\"l7manager\"/>\n            <L7p:VariablePrefix stringValue=\"session\"/>\n        </L7p:CookieCredentialSource>\n        <L7p:EncodeDecode>\n            <L7p:SourceVariableName stringValue=\"session.l7manager\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"cookieContent\"/>\n            <L7p:TransformType transformType=\"URL_DECODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:Split>\n            <L7p:InputVariable stringValue=\"cookieContent\"/>\n            <L7p:OutputVariable stringValue=\"userSession\"/>\n            <L7p:SplitPattern stringValue=\"|\"/>\n            <L7p:SplitPatternRegEx booleanValue=\"false\"/>\n        </L7p:Split>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHt1c2VyU2Vzc2lvblswXX0=\"/>\n            <L7p:VariableToSet stringValue=\"sessionID\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHt1c2VyU2Vzc2lvblsxXX0=\"/>\n            <L7p:VariableToSet stringValue=\"expiration\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHt1c2VyU2Vzc2lvblsyXX0=\"/>\n            <L7p:VariableToSet stringValue=\"signature\"/>\n        </L7p:SetVariable>\n        <L7p:GenerateSecurityHash>\n            <L7p:Base64Data stringValue=\"JHtzZXNzaW9uSUR9fCR7ZXhwaXJhdGlvbn18\"/>\n            <L7p:KeyText stringValue=\"${cookieKey}\"/>\n            <L7p:LineBreak lineBreak=\"CR-LF\"/>\n            <L7p:TargetOutputVariable stringValue=\"actualHash\"/>\n        </L7p:GenerateSecurityHash>\n        <L7p:Regex>\n            <L7p:AutoTarget booleanValue=\"false\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"actualHash\"/>\n            <L7p:Regex stringValue=\"[ =+/]\"/>\n            <L7p:Replace booleanValue=\"true\"/>\n            <L7p:Replacement stringValue=\"\"/>\n            <L7p:Target target=\"OTHER\"/>\n        </L7p:Regex>\n        <L7p:ComparisonAssertion>\n            <L7p:Expression1 stringValue=\"${actualHash}\"/>\n            <L7p:Expression2 stringValue=\"${signature}\"/>\n            <L7p:Predicates predicates=\"included\">\n                <L7p:item binary=\"included\">\n                    <L7p:RightValue stringValue=\"${signature}\"/>\n                </L7p:item>\n            </L7p:Predicates>\n        </L7p:ComparisonAssertion>\n        <L7p:ComparisonAssertion>\n            <L7p:CaseSensitive booleanValue=\"false\"/>\n            <L7p:Expression1 stringValue=\"${expiration}\"/>\n            <L7p:Operator operatorNull=\"null\"/>\n            <L7p:Predicates predicates=\"included\">\n                <L7p:item dataType=\"included\">\n                    <L7p:Type variableDataType=\"int\"/>\n                </L7p:item>\n                <L7p:item binary=\"included\">\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Operator operator=\"GE\"/>\n                    <L7p:RightValue stringValue=\"${gateway.time.seconds}\"/>\n                </L7p:item>\n            </L7p:Predicates>\n        </L7p:ComparisonAssertion>\n        <L7p:ExportVariables>\n            <L7p:ExportedVars stringArrayValue=\"included\">\n                <L7p:item stringValue=\"expiration\"/>\n                <L7p:item stringValue=\"sessionID\"/>\n            </L7p:ExportedVars>\n        </L7p:ExportVariables>\n    </wsp:All>\n</wsp:Policy>"
  }
}