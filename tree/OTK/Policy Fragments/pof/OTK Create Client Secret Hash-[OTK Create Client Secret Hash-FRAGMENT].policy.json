{
  "goid": "21ef294e4e9c18c6b0382148ff8c2b63",
  "guid": "2bc05dde-3a88-42d9-88ab-134899f1c148",
  "name": "OTK Create Client Secret Hash",
  "policyType": "FRAGMENT",
  "checksum": "a5d23b97b78d1f5cdaf654e08c6531e0afe8a0dd",
  "folderPath": "/OTK/Policy Fragments/pof",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"*** THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=== This policy logic converts plain text 'client_secret' to hashed when CWP 'otk.hashed_secret.enable' set as true ====\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Policy Fragment: OTK Create Client Secret Hash\"/>\n        </L7p:CommentAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${master_key_flag}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"false\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <L7p:ComparisonAssertion>\n                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                    <L7p:Expression1 stringValue=\"${hashed_secret_enable}\"/>\n                    <L7p:Operator operatorNull=\"null\"/>\n                    <L7p:Predicates predicates=\"included\">\n                        <L7p:item dataType=\"included\">\n                            <L7p:Type variableDataType=\"string\"/>\n                        </L7p:item>\n                        <L7p:item binary=\"included\">\n                            <L7p:RightValue stringValue=\"true\"/>\n                        </L7p:item>\n                    </L7p:Predicates>\n                </L7p:ComparisonAssertion>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${hashed_secret_algorithm}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtoYXNoZWRfc2VjcmV0X2FsZ29yaXRobX0=\"/>\n                            <L7p:VariableToSet stringValue=\"hashing_algorithm\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <L7p:SetVariable>\n                        <L7p:Base64Expression stringValue=\"U0hBLTUxMg==\"/>\n                        <L7p:VariableToSet stringValue=\"hashing_algorithm\"/>\n                    </L7p:SetVariable>\n                </wsp:OneOrMore>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:CaseSensitive booleanValue=\"false\"/>\n                            <L7p:Expression1 stringValue=\"${hashed_secret_salt}\"/>\n                            <L7p:Operator operatorNull=\"null\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item dataType=\"included\">\n                                    <L7p:Type variableDataType=\"string\"/>\n                                </L7p:item>\n                                <L7p:item binary=\"included\">\n                                    <L7p:Negated booleanValue=\"true\"/>\n                                    <L7p:Operator operator=\"EMPTY\"/>\n                                    <L7p:RightValue stringValue=\"\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtoYXNoZWRfc2VjcmV0X3NhbHR9\"/>\n                            <L7p:VariableToSet stringValue=\"hashing_salt\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:UUIDGenerator>\n                            <L7p:TargetVariable stringValue=\"hashing_salt_random\"/>\n                        </L7p:UUIDGenerator>\n                        <L7p:SetVariable>\n                            <L7p:Base64Expression stringValue=\"JHtoYXNoaW5nX3NhbHRfcmFuZG9tWzBdfQ==\"/>\n                            <L7p:VariableToSet stringValue=\"hashing_salt\"/>\n                        </L7p:SetVariable>\n                    </wsp:All>\n                </wsp:OneOrMore>\n                <L7p:Encapsulated>\n                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"b1324b61-1d6f-4dc9-a355-32e6b64d9f34\"/>\n                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Create Hash\"/>\n                    <L7p:Parameters mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"algorithm\"/>\n                            <L7p:value stringValue=\"${hashing_algorithm}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"inputPlaintext\"/>\n                            <L7p:value stringValue=\"${client_secret}\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"salt\"/>\n                            <L7p:value stringValue=\"${hashing_salt}\"/>\n                        </L7p:entry>\n                    </L7p:Parameters>\n                </L7p:Encapsulated>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtoYXNoZWRWYWx1ZX0=\"/>\n                    <L7p:VariableToSet stringValue=\"client_secret\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"eyJzYWx0IjoiJHtoYXNoaW5nX3NhbHR9IiwiYWxnb3JpdGhtIjoiJHtoYXNoaW5nX2FsZ29yaXRobX0ifQ==\"/>\n                    <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                    <L7p:DataType variableDataType=\"message\"/>\n                    <L7p:VariableToSet stringValue=\"hashing_metadata\"/>\n                </L7p:SetVariable>\n            </wsp:All>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"\"/>\n                <L7p:ContentType stringValue=\"application/json; charset=utf-8\"/>\n                <L7p:DataType variableDataType=\"message\"/>\n                <L7p:VariableToSet stringValue=\"hashing_metadata\"/>\n            </L7p:SetVariable>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>"
  }
}