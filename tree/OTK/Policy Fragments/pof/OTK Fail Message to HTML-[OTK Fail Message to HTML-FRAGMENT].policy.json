{
  "goid": "095bb413e268e62ad01b1c785f2c3b3c",
  "guid": "f99da4f0-42fa-4a9e-9183-a4e2b810e69d",
  "name": "OTK Fail Message to HTML",
  "policyType": "FRAGMENT",
  "checksum": "b665f3d3b84cacd72c97e540e172b9979455d48a",
  "folderPath": "/OTK/Policy Fragments/pof",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === ***  THIS POLICY IS READ ONLY ***\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === If you have the need to customize this policy\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" === please contact CA APIM Support so we can improve customization capability\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" ============================================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This fragment takes the error created via OTK Fail with error message.\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"This fragment is used at /auth/oauth/v2/authorize to turn a JSON error message into HTML\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtlcnJvci5tc2d9\"/>\n            <L7p:ContentType stringValue=\"application/json;charset=UTF-8\"/>\n            <L7p:DataType variableDataType=\"message\"/>\n            <L7p:VariableToSet stringValue=\"jsonMsg\"/>\n        </L7p:SetVariable>\n        <L7p:EvaluateJsonPathExpression>\n            <L7p:Expression stringValue=\"error\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"jsonMsg\"/>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:VariablePrefix stringValue=\"error\"/>\n        </L7p:EvaluateJsonPathExpression>\n        <L7p:EvaluateJsonPathExpression>\n            <L7p:Expression stringValue=\"error_description\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"jsonMsg\"/>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:VariablePrefix stringValue=\"error_description\"/>\n        </L7p:EvaluateJsonPathExpression>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"PGRpdiBpZD0iYXV0aFNydkVyciI+IDxwPjxiPmVycm9yOiA8L2I+JHtlcnJvci5yZXN1bHR9PGJyLz48Yj5lcnJvcl9kZXNjcmlwdGlvbjogPC9iPiR7ZXJyb3JfZGVzY3JpcHRpb24ucmVzdWx0fTwvcD4gPC9kaXY+\"/>\n            <L7p:VariableToSet stringValue=\"errorDetail\"/>\n        </L7p:SetVariable>\n        <L7p:Regex>\n            <L7p:AutoTarget booleanValue=\"false\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"errorContent\"/>\n            <L7p:Regex stringValue=\"&lt;!--oauth_content_placeholder-->\"/>\n            <L7p:Replace booleanValue=\"true\"/>\n            <L7p:Replacement stringValue=\"${errorDetail}\"/>\n            <L7p:Target target=\"OTHER\"/>\n        </L7p:Regex>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtlcnJvckNvbnRlbnR9\"/>\n            <L7p:VariableToSet stringValue=\"error.msg\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"dGV4dC9odG1sO2NoYXJzZXQ9VVRGLTg=\"/>\n            <L7p:VariableToSet stringValue=\"content-type\"/>\n        </L7p:SetVariable>\n    </wsp:All>\n</wsp:Policy>"
  }
}