{
  "goid": "63d1084dbcdad00797aef0f6a3c40964",
  "guid": "e8c7f796-1a4e-451e-8f82-f9e8edbb0723",
  "name": "#OTK Validate SAML Token v2",
  "policyType": "FRAGMENT",
  "checksum": "22f5854aa1aced0e163241ff930280822a01c205",
  "folderPath": "/OTK/Customizations",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"== Target Policy:  &quot;OTK grant_type=TOKEN_EXCHANGE&quot;\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"============================\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"========== Validate the SAML Token v2 ======================\"/>\n        </L7p:CommentAssertion>\n        <L7p:ValidateNonSoapSamlToken>\n            <L7p:AudienceRestriction stringValue=\"${conditions}\"/>\n            <L7p:AuthenticationStatement samlAuthenticationInfo=\"included\">\n                <L7p:AuthenticationMethods stringArrayValue=\"included\">\n                    <L7p:item stringValue=\"urn:ietf:rfc:1510\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:MobileTwoFactorContract\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:am:unspecified\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:am:SPKI\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:am:X509-PKI\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:Smartcard\"/>\n                    <L7p:item stringValue=\"urn:ietf:rfc:3075\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:TimeSyncToken\"/>\n                    <L7p:item stringValue=\"urn:ietf:rfc:2945\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:SmartcardPKI\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:PreviousSession\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:MobileTwoFactorUnregistered\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:MobileOneFactorContract\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:NomadTelephony\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:MobileOneFactorUnregistered\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:AuthenticatedTelephony\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:am:PGP\"/>\n                    <L7p:item stringValue=\"urn:ietf:rfc:2246\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:PersonalizedTelephony\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:InternetProtocol\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:Telephony\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:InternetProtocolPassword\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:2.0:ac:classes:SoftwarePKI\"/>\n                    <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:am:password\"/>\n                </L7p:AuthenticationMethods>\n            </L7p:AuthenticationStatement>\n            <L7p:MaxExpiry longValue=\"3600000\"/>\n            <L7p:NameFormats stringArrayValue=\"included\">\n                <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\"/>\n            </L7p:NameFormats>\n            <L7p:NameQualifier stringValue=\"\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"bearerToken\"/>\n            <L7p:SubjectConfirmationDataCheckValidity booleanValue=\"false\"/>\n            <L7p:SubjectConfirmationDataRecipient stringValue=\"${receipient}\"/>\n            <L7p:SubjectConfirmations stringArrayValue=\"included\">\n                <L7p:item stringValue=\"urn:oasis:names:tc:SAML:1.0:cm:bearer\"/>\n            </L7p:SubjectConfirmations>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:Version boxedIntegerValue=\"2\"/>\n        </L7p:ValidateNonSoapSamlToken>\n        <L7p:ResponseXpathAssertion>\n            <L7p:VariablePrefix stringValue=\"\"/>\n            <L7p:XmlMsgSrc stringValue=\"bearerToken\"/>\n            <L7p:XpathExpression xpathExpressionValue=\"included\">\n                <L7p:Expression stringValue=\"/saml2:Assertion/saml2:Subject/saml2:NameID\"/>\n                <L7p:Namespaces mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"saml2\"/>\n                        <L7p:value stringValue=\"urn:oasis:names:tc:SAML:2.0:assertion\"/>\n                    </L7p:entry>\n                </L7p:Namespaces>\n            </L7p:XpathExpression>\n        </L7p:ResponseXpathAssertion>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0=\"/>\n            <L7p:VariableToSet stringValue=\"owner\"/>\n        </L7p:SetVariable>\n    </wsp:All>\n</wsp:Policy>"
  }
}