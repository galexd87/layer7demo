{
  "goid": "bc9a31b7578652a08a514d7d4fef3567",
  "guid": "e2038842-60b3-4fa4-a95a-9039d622cd7e",
  "name": "OTK User Authentication Extension",
  "policyType": "FRAGMENT",
  "checksum": "754208b796ea2abcedaeca652c2a080dd6908796",
  "folderPath": "/OTK/Customizations/authentication",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"== Target Policy:  &quot;OTK User Authentication&quot;\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"== Change the assertions below to select a different Identity Provider, if needed\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"== Output:  ${current.username}, ${salt}, ${third_party_sso_token} and ${third_party_sso_token_type}\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"==\"/>\n        </L7p:CommentAssertion>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:XpathCredentialSource>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// creating an authorization context\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:PasswordExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"$password\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                    </L7p:PasswordExpression>\n                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                        <L7p:Expression stringValue=\"$username\"/>\n                        <L7p:Namespaces mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"s\"/>\n                                <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                            </L7p:entry>\n                        </L7p:Namespaces>\n                    </L7p:XpathExpression>\n                </L7p:XpathCredentialSource>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"YmFzaWNfYXV0aA==\"/>\n                    <L7p:VariableToSet stringValue=\"auth_method\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// check for basic auth\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CookieCredentialSource>\n                    <L7p:CookieName stringValue=\"SMSESSION\"/>\n                </L7p:CookieCredentialSource>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"c21zZXNzaW9uX2Nvb2tpZQ==\"/>\n                    <L7p:VariableToSet stringValue=\"auth_method\"/>\n                </L7p:SetVariable>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// check for smsession\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// check for basic auth or smsession cookie\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Implement a RateLimit assertion here if rate limiting is required for authentication\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Enable/ Disable whatever branch is required\"/>\n        </L7p:CommentAssertion>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:ComparisonAssertion>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// modify this check if this policy branch should also be used for other validations than just by username\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:CaseSensitive booleanValue=\"false\"/>\n                <L7p:Expression1 stringValue=\"${username}\"/>\n                <L7p:Expression2 stringValue=\"\"/>\n                <L7p:Negate booleanValue=\"true\"/>\n                <L7p:Operator operator=\"EMPTY\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                        <L7p:Negated booleanValue=\"true\"/>\n                        <L7p:Operator operator=\"EMPTY\"/>\n                        <L7p:RightValue stringValue=\"\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${auth_method}\"/>\n                <L7p:Expression2 stringValue=\"basic_auth\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:RightValue stringValue=\"basic_auth\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:Authentication>\n                <L7p:IdentityProviderOid goidValue=\"0000000000000000fffffffffffffffe\"/>\n            </L7p:Authentication>\n            <L7p:SetVariable>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// default: use the given username\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:Base64Expression stringValue=\"JHt1c2VybmFtZX0=\"/>\n                <L7p:VariableToSet stringValue=\"current.username\"/>\n            </L7p:SetVariable>\n            <L7p:IdentityAttributes>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                            <L7p:value stringValue=\"id\"/>\n                        </L7p:entry>\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Lookup the internal ID for creating 'salt'\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:IdentityProviderOid goidValue=\"0000000000000000fffffffffffffffe\"/>\n                <L7p:LookupAttributes identityMappingArray=\"included\">\n                    <L7p:item internalAttributeMapping=\"included\">\n                        <L7p:AttributeConfig attributeConfig=\"included\">\n                            <L7p:Header header=\"included\">\n                                <L7p:Name stringValue=\"Unique ID\"/>\n                                <L7p:Type variableDataType=\"string\"/>\n                                <L7p:UsersOrGroups usersOrGroups=\"BOTH\"/>\n                                <L7p:VariableName stringValue=\"id\"/>\n                            </L7p:Header>\n                            <L7p:VariableName stringValue=\"id\"/>\n                        </L7p:AttributeConfig>\n                        <L7p:ProviderOid goidValue=\"0000000000000000fffffffffffffffe\"/>\n                    </L7p:item>\n                </L7p:LookupAttributes>\n                <L7p:VariablePrefix stringValue=\"given_username\"/>\n            </L7p:IdentityAttributes>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHtnaXZlbl91c2VybmFtZS5pZH0=\"/>\n                <L7p:VariableToSet stringValue=\"salt\"/>\n            </L7p:SetVariable>\n            <L7p:Encapsulated>\n                <L7p:AssertionComment assertionComment=\"included\">\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// get the user id to be used for 'salt' which is used for 'sub' when generating an id_token\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:AssertionComment>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"fb3a7c6b-6fc1-47b3-a823-2eecdfa173fe\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK User Attribute Look Up\"/>\n                <L7p:Parameters mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"custom\"/>\n                        <L7p:value stringValue=\"${provider}\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"given_username\"/>\n                        <L7p:value stringValue=\"${current.username}\"/>\n                    </L7p:entry>\n                </L7p:Parameters>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"IDP\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Configure your IDP\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <wsp:All L7p:Enabled=\"false\" wsp:Usage=\"Required\">\n            <L7p:Include>\n                <L7p:PolicyGuid stringValue=\"721e7ae9-e7d9-42f2-8965-f22a79b7de4e\"/>\n                <L7p:PolicyName stringValue=\"#OTK SiteMinder Check Protected Resource\"/>\n            </L7p:Include>\n            <wsp:OneOrMore wsp:Usage=\"Required\">\n                <wsp:All wsp:Usage=\"Required\">\n                    <L7p:ComparisonAssertion>\n                        <L7p:Expression1 stringValue=\"${auth_method}\"/>\n                        <L7p:Expression2 stringValue=\"smsession_cookie\"/>\n                        <L7p:Predicates predicates=\"included\">\n                            <L7p:item binary=\"included\">\n                                <L7p:RightValue stringValue=\"smsession_cookie\"/>\n                            </L7p:item>\n                        </L7p:Predicates>\n                    </L7p:ComparisonAssertion>\n                    <L7p:SiteMinderAuthenticate>\n                        <L7p:CookieSourceVar stringValue=\"cookie.SMSESSION\"/>\n                        <L7p:CreateSsoToken booleanValue=\"false\"/>\n                        <L7p:NamedCertificate stringValue=\"\"/>\n                        <L7p:NamedJsonWebToken stringValue=\"\"/>\n                        <L7p:NamedUser stringValue=\"${creds}\"/>\n                        <L7p:Prefix stringValue=\"siteminder\"/>\n                        <L7p:SsoZoneName stringValue=\"\"/>\n                        <L7p:UseSMCookie booleanValue=\"true\"/>\n                    </L7p:SiteMinderAuthenticate>\n                </wsp:All>\n                <L7p:SiteMinderAuthenticate>\n                    <L7p:CookieSourceVar stringValue=\"cookie.SMSESSION\"/>\n                    <L7p:NamedCertificate stringValue=\"\"/>\n                    <L7p:NamedJsonWebToken stringValue=\"\"/>\n                    <L7p:NamedUser stringValue=\"${creds}\"/>\n                    <L7p:Prefix stringValue=\"siteminder\"/>\n                    <L7p:SsoZoneName stringValue=\"\"/>\n                </L7p:SiteMinderAuthenticate>\n                <L7p:assertionComment>\n                    <L7p:Properties mapValue=\"included\">\n                        <L7p:entry>\n                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                            <L7p:value stringValue=\"// Use smsession cookie or user credentials\"/>\n                        </L7p:entry>\n                    </L7p:Properties>\n                </L7p:assertionComment>\n            </wsp:OneOrMore>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHtzaXRlbWluZGVyLnNtY29udGV4dC5hdHRyaWJ1dGVzLkFUVFJfVVNFUk5BTUV9\"/>\n                <L7p:VariableToSet stringValue=\"current.username\"/>\n            </L7p:SetVariable>\n            <L7p:SetVariable>\n                <L7p:Base64Expression stringValue=\"JHtzaXRlbWluZGVyLnNtY29udGV4dC5hdHRyaWJ1dGVzLkFUVFJfVVNFUlVOSVZFUlNBTElEfQ==\"/>\n                <L7p:VariableToSet stringValue=\"salt\"/>\n            </L7p:SetVariable>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"=== Other available attributes:\"/>\n            </L7p:CommentAssertion>\n            <L7p:CommentAssertion>\n                <L7p:Comment stringValue=\"ATTR_USERDN, ATTR_USERUNIVERSALID, ATTR_AUTH_DIR_OID, ATTR_AUTH_DIR_NAME, ATTR_AUTH_DIR_SERVER, ATTR_AUTH_DIR_NAMESPACE, ATTR_USERNAME\"/>\n            </L7p:CommentAssertion>\n            <L7p:Encapsulated>\n                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"09be8009-c273-4608-8f4d-5ac4f31eb7eb\"/>\n                <L7p:EncapsulatedAssertionConfigName stringValue=\"MAG Configure Context Variables For Third Party SSO\"/>\n                <L7p:NoOpIfConfigMissing booleanValue=\"true\"/>\n            </L7p:Encapsulated>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"SiteMinder\"/>\n                    </L7p:entry>\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// pre-configured for use with SiteMinder\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n        <L7p:ExportVariables>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// Update the exports if adding outputs\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:ExportedVars stringArrayValue=\"included\">\n                <L7p:item stringValue=\"current.user.attributes\"/>\n                <L7p:item stringValue=\"current.username\"/>\n                <L7p:item stringValue=\"salt\"/>\n                <L7p:item stringValue=\"third_party_sso_token\"/>\n                <L7p:item stringValue=\"third_party_sso_token_type\"/>\n            </L7p:ExportedVars>\n        </L7p:ExportVariables>\n    </wsp:All>\n</wsp:Policy>"
  }
}