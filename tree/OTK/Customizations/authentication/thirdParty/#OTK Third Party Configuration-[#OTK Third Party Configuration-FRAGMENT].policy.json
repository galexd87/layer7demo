{
  "goid": "e5bae5339f26208b6f26dad4e83c3fcc",
  "guid": "a45e324c-eb67-43fc-81da-c34c16937214",
  "name": "#OTK Third Party Configuration",
  "policyType": "FRAGMENT",
  "checksum": "200f254b1bfa9a4dcc0bcba2461c94e54cd196c0",
  "folderPath": "/OTK/Customizations/authentication/thirdParty",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Policy Fragment: #OTK Third Party Configuration\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"***************************************************************\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Request OIDC endpoints\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"URL: https://&lt;THIRD_PARTY_OIDC>/.well-known/openid-configuration\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Ex: SSP OIDC URL :  'https://&lt;SSP_OIDC_HOST>/default/.well-known/openid-configuration'\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Ex: Google OIDC URL 'https://accounts.google.com/.well-known/openid-configuration'\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" \"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Store 'third_party_oidc.client_id' and 'third_party_oidc.client_secret' securely in Stored Passwords and refer via context variable ${secpass.&lt;name>.plaintext}\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\" \"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Output:\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"    {\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"         &quot;authorization_endpoint&quot;: &quot;&lt;Authorization URL>&quot;\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"         &quot;token_endpoint&quot;: &quot;&lt;Token URL>&quot;\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"         &quot;userinfo_endpoint&quot;: &quot;&lt;User Info URL>&quot;\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"    }\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"***************************************************************\"/>\n        </L7p:CommentAssertion>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"// third party OIDC provider name (Ex: SSP, Google)\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfT0lEQ19QUk9WSURFUg==\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc_provider\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfT0lEQy8ud2VsbC1rbm93bi9vcGVuaWQtY29uZmlndXJhdGlvbg==\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc_discovery_url\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore L7p:Enabled=\"false\" wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CacheLookup>\n                    <L7p:CacheEntryKey stringValue=\"${third_party_oidc_discovery_url}\"/>\n                    <L7p:CacheId stringValue=\"third_party_oidc_configuration\"/>\n                    <L7p:ContentTypeOverride stringValue=\"\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"oidc_config\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:CacheLookup>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:HttpRoutingAssertion>\n                    <L7p:HttpMethod httpMethod=\"GET\"/>\n                    <L7p:ProtectedServiceUrl stringValue=\"${third_party_oidc_discovery_url}\"/>\n                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Cookie\"/>\n                            </L7p:item>\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"SOAPAction\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:RequestHeaderRules>\n                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\"/>\n                    </L7p:RequestParamRules>\n                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                        <L7p:ForwardAll booleanValue=\"true\"/>\n                        <L7p:Rules httpPassthroughRules=\"included\">\n                            <L7p:item httpPassthroughRule=\"included\">\n                                <L7p:Name stringValue=\"Set-Cookie\"/>\n                            </L7p:item>\n                        </L7p:Rules>\n                    </L7p:ResponseHeaderRules>\n                    <L7p:ResponseMsgDest stringValue=\"oidc_config\"/>\n                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                </L7p:HttpRoutingAssertion>\n                <L7p:CacheStorage>\n                    <L7p:CacheEntryKey stringValue=\"${third_party_oidc_discovery_url}\"/>\n                    <L7p:CacheId stringValue=\"third_party_oidc_configuration\"/>\n                    <L7p:OtherTargetMessageVariable stringValue=\"oidc_config\"/>\n                    <L7p:Target target=\"OTHER\"/>\n                </L7p:CacheStorage>\n            </wsp:All>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"Retrieve third party OIDC configuration\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:OneOrMore>\n        <L7p:EvaluateJsonPathExpressionV2>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:Expression stringValue=\"authorization_endpoint\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"oidc_config\"/>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:VariablePrefix stringValue=\"oidc_authorization\"/>\n        </L7p:EvaluateJsonPathExpressionV2>\n        <L7p:EvaluateJsonPathExpressionV2>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:Expression stringValue=\"token_endpoint\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"oidc_config\"/>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:VariablePrefix stringValue=\"oidc_token\"/>\n        </L7p:EvaluateJsonPathExpressionV2>\n        <L7p:EvaluateJsonPathExpressionV2>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:Expression stringValue=\"userinfo_endpoint\"/>\n            <L7p:OtherTargetMessageVariable stringValue=\"oidc_config\"/>\n            <L7p:Target target=\"OTHER\"/>\n            <L7p:VariablePrefix stringValue=\"oidc_userinfo\"/>\n        </L7p:EvaluateJsonPathExpressionV2>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtvaWRjX2F1dGhvcml6YXRpb24ucmVzdWx0fQ==\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.authorization_endpoint\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtvaWRjX3Rva2VuLnJlc3VsdH0=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.token_endpoint\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"JHtvaWRjX3VzZXJpbmZvLnJlc3VsdH0=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.introspect_endpoint\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Customize scope for the third party OIDC authorization flow\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"b3BlbmlkIHByb2ZpbGUgZW1haWw=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.scope\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Retrieve third party OIDC client_id (either hard code the value here, or use OTK client custom column)\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfT0lEQ19DTElFTlRfSUQ=\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.client_id\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Retrieve third party OIDC client_secret (DO NOT hard-code the value here, try retrieving it from secure passwords, i.e., ${secpass.third_party_oidc_client_secret.plaintext})\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"VEhJUkRfUEFSVFlfQ0xJRU5UX1NFQ1JFVA==\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.client_secret\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:AssertionComment assertionComment=\"included\">\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                        <L7p:value stringValue=\"Ensure, the redirection from the third party OIDC happens to the OTK authorization login endpoint\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:AssertionComment>\n            <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06JHtnYXRld2F5Lm90ay5wb3J0fS9hdXRoL29hdXRoL3YyL2F1dGhvcml6ZS9sb2dpbg==\"/>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:VariableToSet stringValue=\"third_party_oidc.redirect_uri\"/>\n        </L7p:SetVariable>\n        <L7p:EncodeDecode>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:SourceVariableName stringValue=\"third_party_oidc.scope\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"third_party_oidc.scope_encoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n        <L7p:EncodeDecode>\n            <L7p:Enabled booleanValue=\"false\"/>\n            <L7p:SourceVariableName stringValue=\"third_party_oidc.redirect_uri\"/>\n            <L7p:TargetDataType variableDataType=\"string\"/>\n            <L7p:TargetVariableName stringValue=\"third_party_oidc.redirect_uri_encoded\"/>\n            <L7p:TransformType transformType=\"URL_ENCODE\"/>\n        </L7p:EncodeDecode>\n    </wsp:All>\n</wsp:Policy>"
  }
}