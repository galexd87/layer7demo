{
  "goid": "d82da0a76165678d597f8cf3be584a17",
  "guid": "be4b3a90-d974-4624-85c4-ef5edaa31504",
  "name": "#OTK Health Check",
  "policyType": "FRAGMENT",
  "checksum": "69827deb2da9c8ea10090a31426819c637982444",
  "folderPath": "/OTK/Customizations",
  "soap": false,
  "policy": {
    "xml": "<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:CommentAssertion>\n                            <L7p:Comment stringValue=\"Policy Fragment: #OTK Health Check\"/>\n                        </L7p:CommentAssertion>\n                        <L7p:CustomizeErrorResponse>\n                            <L7p:Content stringValue=\"${error.msg}\"/>\n                            <L7p:ContentType stringValue=\"text/plain\"/>\n                            <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                                <L7p:item nameValuePair=\"included\">\n                                    <L7p:Key stringValue=\"Pragma\"/>\n                                    <L7p:Value stringValue=\"no-cache\"/>\n                                </L7p:item>\n                                <L7p:item nameValuePair=\"included\">\n                                    <L7p:Key stringValue=\"Cache-Control\"/>\n                                    <L7p:Value stringValue=\"no-store\"/>\n                                </L7p:item>\n                                <L7p:item nameValuePair=\"included\">\n                                    <L7p:Key stringValue=\"x-ca-err\"/>\n                                    <L7p:Value stringValue=\"${error.code}\"/>\n                                </L7p:item>\n                            </L7p:ExtraHeaders>\n                            <L7p:HttpStatus stringValue=\"${status}\"/>\n                        </L7p:CustomizeErrorResponse>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                                <L7p:VariableToSet stringValue=\"cleanCreds\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"ZmFpbA==\"/>\n                                <L7p:VariableToSet stringValue=\"clientCheck\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"ZmFpbA==\"/>\n                                <L7p:VariableToSet stringValue=\"accessTokenCheck\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"ZmFpbA==\"/>\n                                <L7p:VariableToSet stringValue=\"idTokenCheck\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"ZmFsc2U=\"/>\n                                <L7p:VariableToSet stringValue=\"healthCheckError\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                        <L7p:entry>\n                                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                            <L7p:value stringValue=\"// must be url encoded (i.e.: 'scopea scopeb' == 'scopea+scopeb'\"/>\n                                        </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:Base64Expression stringValue=\"aGVhbHRoY2hlY2s=\"/>\n                                <L7p:VariableToSet stringValue=\"scope\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:Base64Expression stringValue=\"T1RLLUhlYWx0aGNoZWNr\"/>\n                                <L7p:VariableToSet stringValue=\"client_name\"/>\n                            </L7p:SetVariable>\n                            <L7p:SetVariable>\n                                <L7p:AssertionComment assertionComment=\"included\">\n                                    <L7p:Properties mapValue=\"included\">\n                                        <L7p:entry>\n                                            <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                            <L7p:value stringValue=\"// must be url encoded (i.e.: 'scopea scopeb' == 'scopea+scopeb'\"/>\n                                        </L7p:entry>\n                                    </L7p:Properties>\n                                </L7p:AssertionComment>\n                                <L7p:Base64Expression stringValue=\"SGVhbHRoY2hlY2tBUEk=\"/>\n                                <L7p:VariableToSet stringValue=\"resource_owner\"/>\n                            </L7p:SetVariable>\n                        </wsp:All>\n                        <wsp:All wsp:Usage=\"Required\">\n                            <L7p:CommentAssertion>\n                                <L7p:Comment stringValue=\"Basic Check : Check if OTK DB connnection is working \"/>\n                            </L7p:CommentAssertion>\n                            <L7p:CommentAssertion>\n                                <L7p:Comment stringValue=\"Basic Check : This can be invoked only at localhost. Disable the below line to acccess it from outside  \"/>\n                            </L7p:CommentAssertion>\n                            <L7p:Encapsulated>\n                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"8b9ded79-cefc-4481-94ab-3cb31ac8136b\"/>\n                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Version GET\"/>\n                                <L7p:Parameters mapValue=\"included\">\n                                    <L7p:entry>\n                                        <L7p:key stringValue=\"operation\"/>\n                                        <L7p:value stringValue=\"getOtkVersion\"/>\n                                    </L7p:entry>\n                                </L7p:Parameters>\n                            </L7p:Encapsulated>\n                            <L7p:ComparisonAssertion>\n                                <L7p:Expression1 stringValue=\"${otk_version.queryresult.count}\"/>\n                                <L7p:Expression2 stringValue=\"1\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                        <L7p:RightValue stringValue=\"1\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                        </wsp:All>\n                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                            <L7p:ComparisonAssertion>\n                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                <L7p:Expression1 stringValue=\"${check_type}\"/>\n                                <L7p:Expression2 stringValue=\"basic\"/>\n                                <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                <L7p:Predicates predicates=\"included\">\n                                    <L7p:item binary=\"included\">\n                                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                                        <L7p:RightValue stringValue=\"basic\"/>\n                                    </L7p:item>\n                                </L7p:Predicates>\n                            </L7p:ComparisonAssertion>\n                            <wsp:All wsp:Usage=\"Required\">\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                                        <L7p:Expression1 stringValue=\"${client_id}\"/>\n                                        <L7p:Expression2 stringValue=\"${gateway.otk.health.apikey}\"/>\n                                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                        <L7p:Negate booleanValue=\"true\"/>\n                                        <L7p:Operator operator=\"EMPTY\"/>\n                                        <L7p:Predicates predicates=\"included\">\n                                            <L7p:item binary=\"included\">\n                                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                <L7p:Negated booleanValue=\"true\"/>\n                                                <L7p:Operator operator=\"EMPTY\"/>\n                                                <L7p:RightValue stringValue=\"${gateway.otk.health.apikey}\"/>\n                                            </L7p:item>\n                                        </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n                                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                        <L7p:Parameters mapValue=\"included\">\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"apiPrefix\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"custom\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                                <L7p:value stringValue=\"103\"/>\n                                            </L7p:entry>\n                                        </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                        <L7p:Regex>\n                                            <L7p:AutoTarget booleanValue=\"false\"/>\n                                            <L7p:OtherTargetMessageVariable stringValue=\"error.msg\"/>\n                                            <L7p:Regex stringValue=\"Missing or duplicate parameters\"/>\n                                            <L7p:Replace booleanValue=\"true\"/>\n                                            <L7p:Replacement stringValue=\"invalid parameters : client_id\"/>\n                                            <L7p:Target target=\"OTHER\"/>\n                                        </L7p:Regex>\n                                        <L7p:AuditDetailAssertion>\n                                            <L7p:Detail stringValue=\"client_id is empty.\"/>\n                                        </L7p:AuditDetailAssertion>\n                                        <L7p:FalseAssertion/>\n                                    </wsp:All>\n                                </wsp:OneOrMore>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                                        <L7p:Expression1 stringValue=\"${gateway.otk.health.apikey}\"/>\n                                        <L7p:Expression2 stringValue=\"${gateway.otk.health.apikey}\"/>\n                                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                        <L7p:Negate booleanValue=\"true\"/>\n                                        <L7p:Operator operator=\"EMPTY\"/>\n                                        <L7p:Predicates predicates=\"included\">\n                                            <L7p:item binary=\"included\">\n                                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                <L7p:Negated booleanValue=\"true\"/>\n                                                <L7p:Operator operator=\"EMPTY\"/>\n                                                <L7p:RightValue stringValue=\"${gateway.otk.health.apikey}\"/>\n                                            </L7p:item>\n                                        </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n                                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                        <L7p:Parameters mapValue=\"included\">\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"apiPrefix\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"custom\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                                <L7p:value stringValue=\"000\"/>\n                                            </L7p:entry>\n                                        </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                        <L7p:AuditDetailAssertion>\n                                            <L7p:Detail stringValue=\"API key has not been set\"/>\n                                        </L7p:AuditDetailAssertion>\n                                        <L7p:Regex>\n                                            <L7p:AutoTarget booleanValue=\"false\"/>\n                                            <L7p:OtherTargetMessageVariable stringValue=\"error.msg\"/>\n                                            <L7p:Regex stringValue=\"The request failed due to some unknown reason\"/>\n                                            <L7p:Replace booleanValue=\"true\"/>\n                                            <L7p:Replacement stringValue=\"The server configuration is invalid. Missing otk health api key. Contact the administrator\"/>\n                                            <L7p:Target target=\"OTHER\"/>\n                                        </L7p:Regex>\n                                        <L7p:FalseAssertion/>\n                                    </wsp:All>\n                                </wsp:OneOrMore>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <L7p:ComparisonAssertion>\n                                        <L7p:CaseSensitive booleanValue=\"false\"/>\n                                        <L7p:Expression1 stringValue=\"${api_key}\"/>\n                                        <L7p:Expression2 stringValue=\"${gateway.otk.health.apikey}\"/>\n                                        <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                        <L7p:Predicates predicates=\"included\">\n                                            <L7p:item binary=\"included\">\n                                                <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                <L7p:RightValue stringValue=\"${gateway.otk.health.apikey}\"/>\n                                            </L7p:item>\n                                        </L7p:Predicates>\n                                    </L7p:ComparisonAssertion>\n                                    <L7p:Encapsulated>\n                                        <L7p:EncapsulatedAssertionConfigGuid stringValue=\"56bd8147-3ab4-4d09-9460-8b2de02b7a9e\"/>\n                                        <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Fail with error message\"/>\n                                        <L7p:Parameters mapValue=\"included\">\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"apiPrefix\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"custom\"/>\n                                                <L7p:value stringValue=\"\"/>\n                                            </L7p:entry>\n                                            <L7p:entry>\n                                                <L7p:key stringValue=\"givenErrorCode\"/>\n                                                <L7p:value stringValue=\"103\"/>\n                                            </L7p:entry>\n                                        </L7p:Parameters>\n                                    </L7p:Encapsulated>\n                                    <wsp:All wsp:Usage=\"Required\">\n                                        <L7p:Regex>\n                                            <L7p:AutoTarget booleanValue=\"false\"/>\n                                            <L7p:OtherTargetMessageVariable stringValue=\"error.msg\"/>\n                                            <L7p:Regex stringValue=\"Missing or duplicate parameters\"/>\n                                            <L7p:Replace booleanValue=\"true\"/>\n                                            <L7p:Replacement stringValue=\"invalid parameters : api key\"/>\n                                            <L7p:Target target=\"OTHER\"/>\n                                        </L7p:Regex>\n                                        <L7p:AuditDetailAssertion>\n                                            <L7p:Detail stringValue=\"API key provided was invalid, given: '${api_key}'\"/>\n                                        </L7p:AuditDetailAssertion>\n                                        <L7p:FalseAssertion/>\n                                    </wsp:All>\n                                </wsp:OneOrMore>\n                                <L7p:Include>\n                                    <L7p:PolicyGuid stringValue=\"fd9342d8-5086-4758-8fd3-caa2df094448\"/>\n                                    <L7p:PolicyName stringValue=\"OTK Apply Ratelimit Extension\"/>\n                                </L7p:Include>\n                                <wsp:OneOrMore wsp:Usage=\"Required\">\n                                    <wsp:All wsp:Usage=\"Required\">\n                                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:Encapsulated>\n                                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"290511a8-b775-47a7-98ab-7be386da2105\"/>\n                                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client GET\"/>\n                                                    <L7p:Parameters mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_ident\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_key\"/>\n                                                    <L7p:value stringValue=\"${client_id}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"custom\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"environment\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"filterStatus\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"format\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"master\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"name\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"operation\"/>\n                                                    <L7p:value stringValue=\"getKey\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"org\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"queryOffset\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"registered_by\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Parameters>\n                                                </L7p:Encapsulated>\n                                                <L7p:ComparisonAssertion>\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Expression1 stringValue=\"${error.code}\"/>\n                                                    <L7p:Expression2 stringValue=\"\"/>\n                                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:RightValue stringValue=\"\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                </L7p:ComparisonAssertion>\n                                                <L7p:ResponseXpathAssertion>\n                                                    <L7p:VariablePrefix stringValue=\"xpathClientId\"/>\n                                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                                    <L7p:Expression stringValue=\"/ns:values/ns:value/ns:client_ident\"/>\n                                                    <L7p:Namespaces mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ns\"/>\n                                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-clientstore\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"s\"/>\n                                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Namespaces>\n                                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                                    </L7p:XpathExpression>\n                                                </L7p:ResponseXpathAssertion>\n                                                <L7p:ComparisonAssertion>\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Expression1 stringValue=\"${xpathClientId.found}\"/>\n                                                    <L7p:Expression2 stringValue=\"true\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:RightValue stringValue=\"true\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                </L7p:ComparisonAssertion>\n                                                <L7p:ResponseXpathAssertion>\n                                                    <L7p:VariablePrefix stringValue=\"xpathScope\"/>\n                                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                                    <L7p:Expression stringValue=\"/ns:values/ns:value/ns:scope\"/>\n                                                    <L7p:Namespaces mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ns\"/>\n                                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-clientstore\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"s\"/>\n                                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Namespaces>\n                                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                                    </L7p:XpathExpression>\n                                                </L7p:ResponseXpathAssertion>\n                                                <L7p:ResponseXpathAssertion>\n                                                    <L7p:VariablePrefix stringValue=\"xpathSecret\"/>\n                                                    <L7p:XmlMsgSrc stringValue=\"resp\"/>\n                                                    <L7p:XpathExpression xpathExpressionValue=\"included\">\n                                                    <L7p:Expression stringValue=\"/ns:values/ns:value/ns:secret\"/>\n                                                    <L7p:Namespaces mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ns\"/>\n                                                    <L7p:value stringValue=\"http://ns.l7tech.com/2012/11/otk-clientstore\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"s\"/>\n                                                    <L7p:value stringValue=\"http://schemas.xmlsoap.org/soap/envelope/\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Namespaces>\n                                                    <L7p:XpathVersion xpathVersion=\"XPATH_1_0\"/>\n                                                    </L7p:XpathExpression>\n                                                </L7p:ResponseXpathAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"JHt4cGF0aENsaWVudElkLnJlc3VsdH0=\"/>\n                                                    <L7p:VariableToSet stringValue=\"client_id\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"JHt4cGF0aFNlY3JldC5yZXN1bHR9\"/>\n                                                    <L7p:VariableToSet stringValue=\"client_secret\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"JHt4cGF0aFNjb3BlLnJlc3VsdH0=\"/>\n                                                    <L7p:VariableToSet stringValue=\"scope\"/>\n                                                </L7p:SetVariable>\n                                            </wsp:All>\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:Encapsulated>\n                                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"6dbc70f9-bb40-4a69-a0ec-88fae4f35300\"/>\n                                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Generate OAuth Token\"/>\n                                                    <L7p:Parameters mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ac\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"art\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"at\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"cid\"/>\n                                                    <L7p:value stringValue=\"true\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"cidm\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"custom\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ock\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"ot\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"rft\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"urt\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Parameters>\n                                                </L7p:Encapsulated>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"JHtnZW5TZWNyZXR9\"/>\n                                                    <L7p:VariableToSet stringValue=\"client_secret\"/>\n                                                </L7p:SetVariable>\n                                                <wsp:All wsp:Usage=\"Required\">\n                                                    <L7p:Encapsulated>\n\n                                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"71e2d996-cea5-4862-ad46-7b50c0d36c84\"/>\n\n                                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Client Persist\"/>\n                                                    <L7p:Parameters mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"account_plan_mapping_ids\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"callback\"/>\n                                                    <L7p:value stringValue=\"https://localhost\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_custom\"/>\n                                                    <L7p:value stringValue=\"{}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_ident\"/>\n                                                    <L7p:value stringValue=\"${client_id}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_key\"/>\n                                                    <L7p:value stringValue=\"${client_id}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_name\"/>\n                                                    <L7p:value stringValue=\"${client_name}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_secret\"/>\n                                                    <L7p:value stringValue=\"${client_secret}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_status\"/>\n                                                    <L7p:value stringValue=\"ENABLED\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"custom\"/>\n                                                    <L7p:value stringValue=\"{}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"description\"/>\n                                                    <L7p:value stringValue=\"Test client for automated healthcheck\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"environment\"/>\n                                                    <L7p:value stringValue=\"ALL\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"expiration\"/>\n                                                    <L7p:value stringValue=\"0\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"key_custom\"/>\n                                                    <L7p:value stringValue=\"{}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"org\"/>\n                                                    <L7p:value stringValue=\"CA Technologies\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"persist_client\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"persist_client_and_key\"/>\n                                                    <L7p:value stringValue=\"true\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"persist_client_key\"/>\n                                                    <L7p:value stringValue=\"false\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"registered_by\"/>\n                                                    <L7p:value stringValue=\"${resource_owner}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"scope\"/>\n                                                    <L7p:value stringValue=\"${scope}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"service_ids\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"type\"/>\n                                                    <L7p:value stringValue=\"confidential\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Parameters>\n                                                    </L7p:Encapsulated>\n                                                    <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"cGFzcw==\"/>\n                                                    <L7p:VariableToSet stringValue=\"clientCheck\"/>\n                                                    </L7p:SetVariable>\n                                                </wsp:All>\n                                            </wsp:All>\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:AuditDetailAssertion>\n                                                    <L7p:Detail stringValueReference=\"inline\"><![CDATA[Persisting client failed:\n                ${error.msg}]]></L7p:Detail>\n                                                    <L7p:LoggingOnly booleanValue=\"true\"/>\n                                                </L7p:AuditDetailAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                                                    <L7p:VariableToSet stringValue=\"healthCheckError\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:FalseAssertion/>\n                                            </wsp:All>\n                                        </wsp:OneOrMore>\n                                        <wsp:All wsp:Usage=\"Required\">\n                                            <L7p:Encapsulated>\n                                                <L7p:EncapsulatedAssertionConfigGuid stringValue=\"2e6e2ef3-a36f-4548-a2c4-7b369b7ae184\"/>\n                                                <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Variable Configuration\"/>\n                                                <L7p:Parameters mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"custom\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                </L7p:Parameters>\n                                            </L7p:Encapsulated>\n                                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                                <wsp:All wsp:Usage=\"Required\">\n                                                    <L7p:ComparisonAssertion>\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Expression1 stringValue=\"${gateway.otk.port.health}\"/>\n                                                    <L7p:Expression2 stringValue=\"\"/>\n                                                    <L7p:ExpressionIsVariable booleanValue=\"false\"/>\n                                                    <L7p:Negate booleanValue=\"true\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Negated booleanValue=\"true\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:RightValue stringValue=\"\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                    </L7p:ComparisonAssertion>\n                                                    <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06JHtnYXRld2F5Lm90ay5wb3J0LmhlYWx0aH0=\"/>\n                                                    <L7p:VariableToSet stringValue=\"url\"/>\n                                                    </L7p:SetVariable>\n                                                </wsp:All>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX0=\"/>\n                                                    <L7p:VariableToSet stringValue=\"url\"/>\n                                                </L7p:SetVariable>\n                                            </wsp:OneOrMore>\n                                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                                <L7p:ComparisonAssertion>\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Expression1 stringValue=\"${oauth2_server_url_prefix}\"/>\n                                                    <L7p:Expression2 stringValue=\"\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Operator operator=\"EMPTY\"/>\n                                                    <L7p:RightValue stringValue=\"\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                </L7p:ComparisonAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"JHt1cmx9LyR7b2F1dGgyX3NlcnZlcl91cmxfcHJlZml4fQ==\"/>\n                                                    <L7p:VariableToSet stringValue=\"url\"/>\n                                                </L7p:SetVariable>\n                                            </wsp:OneOrMore>\n                                        </wsp:All>\n                                        <L7p:CommentAssertion>\n                                            <L7p:Comment stringValue=\"Basic check: use grant_type=client_credentials\"/>\n                                        </L7p:CommentAssertion>\n                                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"Y2xpZW50X2lkPSR7Y2xpZW50X2lkfSZjbGllbnRfc2VjcmV0PSR7Y2xpZW50X3NlY3JldH0mZ3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHMmc2NvcGU9JHtzY29wZX0=\"/>\n                                                    <L7p:ContentType stringValue=\"application/x-www-form-urlencoded; charset=utf-8\"/>\n                                                    <L7p:DataType variableDataType=\"message\"/>\n                                                    <L7p:VariableToSet stringValue=\"msg\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:HttpRoutingAssertion>\n                                                    <L7p:CurrentSecurityHeaderHandling intValue=\"3\"/>\n                                                    <L7p:HttpMethod httpMethod=\"POST\"/>\n                                                    <L7p:ProtectedServiceUrl stringValue=\"${url}/auth/oauth/v2/token\"/>\n                                                    <L7p:ProxyPassword stringValueNull=\"null\"/>\n                                                    <L7p:ProxyUsername stringValueNull=\"null\"/>\n                                                    <L7p:RequestHeaderRules httpPassthroughRuleSet=\"included\">\n                                                    <L7p:ForwardAll booleanValue=\"true\"/>\n                                                    <L7p:Rules httpPassthroughRules=\"included\">\n                                                    <L7p:item httpPassthroughRule=\"included\">\n                                                    <L7p:Name stringValue=\"Cookie\"/>\n                                                    </L7p:item>\n                                                    <L7p:item httpPassthroughRule=\"included\">\n                                                    <L7p:Name stringValue=\"SOAPAction\"/>\n                                                    </L7p:item>\n                                                    </L7p:Rules>\n                                                    </L7p:RequestHeaderRules>\n                                                    <L7p:RequestMsgSrc stringValue=\"msg\"/>\n                                                    <L7p:RequestParamRules httpPassthroughRuleSet=\"included\">\n                                                    <L7p:ForwardAll booleanValue=\"true\"/>\n                                                    <L7p:Rules httpPassthroughRules=\"included\"/>\n                                                    </L7p:RequestParamRules>\n                                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet=\"included\">\n                                                    <L7p:ForwardAll booleanValue=\"true\"/>\n                                                    <L7p:Rules httpPassthroughRules=\"included\">\n                                                    <L7p:item httpPassthroughRule=\"included\">\n                                                    <L7p:Name stringValue=\"Set-Cookie\"/>\n                                                    </L7p:item>\n                                                    </L7p:Rules>\n                                                    </L7p:ResponseHeaderRules>\n                                                    <L7p:ResponseMsgDest stringValue=\"resp\"/>\n                                                    <L7p:SamlAssertionVersion intValue=\"2\"/>\n                                                </L7p:HttpRoutingAssertion>\n                                                <L7p:ComparisonAssertion>\n                                                    <L7p:Expression1 stringValue=\"${resp.mainpart}\"/>\n                                                    <L7p:Expression2 stringValue=\"access_token\"/>\n                                                    <L7p:Operator operator=\"CONTAINS\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:Operator operator=\"CONTAINS\"/>\n                                                    <L7p:RightValue stringValue=\"access_token\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                </L7p:ComparisonAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"cGFzcw==\"/>\n                                                    <L7p:VariableToSet stringValue=\"accessTokenCheck\"/>\n                                                </L7p:SetVariable>\n                                            </wsp:All>\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:AuditDetailAssertion>\n                                                    <L7p:Detail stringValueReference=\"inline\"><![CDATA[Basic check failed:\n                Token request to '${url}/auth/oauth/v2/token' using 'grant_type=client_credentials' failed!]]></L7p:Detail>\n                                                </L7p:AuditDetailAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                                                    <L7p:VariableToSet stringValue=\"healthCheckError\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:FalseAssertion/>\n                                            </wsp:All>\n                                        </wsp:OneOrMore>\n                                        <wsp:OneOrMore wsp:Usage=\"Required\">\n                                            <wsp:OneOrMore wsp:Usage=\"Required\">\n                                                <L7p:ComparisonAssertion>\n                                                    <L7p:CaseSensitive booleanValue=\"false\"/>\n                                                    <L7p:Expression1 stringValue=\"${accessTokenCheck}\"/>\n                                                    <L7p:Operator operatorNull=\"null\"/>\n                                                    <L7p:Predicates predicates=\"included\">\n                                                    <L7p:item dataType=\"included\">\n                                                    <L7p:Type variableDataType=\"string\"/>\n                                                    </L7p:item>\n                                                    <L7p:item binary=\"included\">\n                                                    <L7p:Operator operator=\"NE\"/>\n                                                    <L7p:RightValue stringValue=\"pass\"/>\n                                                    </L7p:item>\n                                                    </L7p:Predicates>\n                                                </L7p:ComparisonAssertion>\n                                                <L7p:Encapsulated>\n                                                    <L7p:AssertionComment assertionComment=\"included\">\n                                                    <L7p:Properties mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                                    <L7p:value stringValue=\"// access_token, refresh_token\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Properties>\n                                                    </L7p:AssertionComment>\n                                                    <L7p:EncapsulatedAssertionConfigGuid stringValue=\"ada963ed-0428-4ead-8576-9ef79193752c\"/>\n                                                    <L7p:EncapsulatedAssertionConfigName stringValue=\"OTK Token Delete\"/>\n                                                    <L7p:Parameters mapValue=\"included\">\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"access_token\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"client_key\"/>\n                                                    <L7p:value stringValue=\"${client_id}\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"custom\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"refresh_token\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    <L7p:entry>\n                                                    <L7p:key stringValue=\"temp_token\"/>\n                                                    <L7p:value stringValue=\"\"/>\n                                                    </L7p:entry>\n                                                    </L7p:Parameters>\n                                                </L7p:Encapsulated>\n                                            </wsp:OneOrMore>\n                                            <wsp:All wsp:Usage=\"Required\">\n                                                <L7p:AuditDetailAssertion>\n                                                    <L7p:Detail stringValueReference=\"inline\"><![CDATA[Clean up task failed:\n                ${error.msg}]]></L7p:Detail>\n                                                </L7p:AuditDetailAssertion>\n                                                <L7p:SetVariable>\n                                                    <L7p:Base64Expression stringValue=\"dHJ1ZQ==\"/>\n                                                    <L7p:VariableToSet stringValue=\"healthCheckError\"/>\n                                                </L7p:SetVariable>\n                                                <L7p:FalseAssertion/>\n                                            </wsp:All>\n                                        </wsp:OneOrMore>\n                                    </wsp:All>\n                                </wsp:OneOrMore>\n                            </wsp:All>\n                        </wsp:OneOrMore>\n                    </wsp:All>\n                </wsp:Policy>"
  }
}